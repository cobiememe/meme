<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhaleTracker Pro - PUMP.FUN EDITION üî•</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-fade-in { animation: fadeIn 0.5s ease-out; }
        .animate-spin { animation: spin 1s linear infinite; }
        .glass-card { 
            background: rgba(15, 23, 42, 0.7); 
            border: 1px solid rgba(124, 58, 237, 0.1); 
            backdrop-filter: blur(10px);
        }
        .tab-active { 
            border-bottom: 2px solid #8b5cf6;
            color: #8b5cf6;
        }
        tr:hover { 
            background-color: rgba(139, 92, 246, 0.1) !important; 
            transform: scale(1.01);
            transition: all 0.15s ease;
        }
        .tab-content.hidden { 
            opacity: 0; 
            pointer-events: none;
            position: absolute;
        }
        .tab-content:not(.hidden) {
            opacity: 1;
            position: relative;
        }
        .pulse-ring {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(0.95); opacity: 1; }
            50% { transform: scale(1); opacity: 0.7; }
            100% { transform: scale(0.95); opacity: 1; }
        }
        .chain-badge {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
        }
        .sol-badge { background: linear-gradient(45deg, #9945FF, #14F195); color: white; }
        .risk-high { background: #ef4444; color: white; }
        .risk-medium { background: #f59e0b; color: white; }
        .risk-low { background: #10b981; color: white; }
        .badge-new { background: #ec4899; color: white; }
        .badge-trending { background: #f59e0b; color: white; }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-indigo-950 to-slate-900 text-white min-h-screen">
    <div id="app" class="p-4">
        <!-- Header -->
        <header class="max-w-7xl mx-auto mb-8">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="relative">
                        <div class="w-12 h-12 bg-gradient-to-r from-purple-500 to-blue-500 rounded-xl flex items-center justify-center text-white font-bold text-lg pulse-ring">
                            üêã
                        </div>
                        <div class="absolute -top-1 -right-1 w-4 h-4 bg-green-400 rounded-full border-2 border-slate-900 animate-pulse"></div>
                    </div>
                    <div>
                        <h1 class="text-3xl font-bold bg-gradient-to-r from-purple-400 to-blue-400 bg-clip-text text-transparent">
                            WhaleTracker Pro üî•
                        </h1>
                        <p class="text-gray-400 mt-1">‚úÖ PUMP.FUN REST API + Dexscreener</p>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <div class="px-3 py-2 bg-green-900/20 border border-green-500/30 rounded-lg text-xs">
                        <span class="text-green-400">üü¢ Auto-Loading Active</span>
                    </div>
                </div>
            </div>
        </header>

        <div class="max-w-7xl mx-auto flex gap-6">
            <!-- Main Content -->
            <div class="flex-1">
                <!-- Status -->
                <div id="api-status" class="mb-6">
                    <div class="bg-yellow-900/20 border border-yellow-500/30 rounded-lg p-3">
                        <p class="text-yellow-400 text-sm flex items-center">
                            <i class="fas fa-info-circle mr-2"></i>
                            <span id="status-message">üöÄ Loading fresh tokens...</span>
                        </p>
                    </div>
                </div>

                <!-- Control Panel -->
                <div class="glass-card rounded-xl p-6 mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-2 text-gray-300">
                                <i class="fas fa-filter mr-2"></i>Min Liquidity
                            </label>
                            <select id="min-liquidity" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-white text-sm">
                                <option value="500">$500+</option>
                                <option value="1000">$1K+</option>
                                <option value="2000" selected>$2K+</option>
                                <option value="5000">$5K+</option>
                            </select>
                        </div>
                        <div class="flex items-end">
                            <button id="btn-fresh" class="w-full bg-purple-600 hover:bg-purple-700 py-2 px-4 rounded-lg font-medium transition flex items-center justify-center gap-2">
                                <i id="fresh-icon" class="fas fa-bolt"></i>
                                Refresh Tokens
                            </button>
                        </div>
                        <div class="flex items-end">
                            <button id="btn-clear" class="w-full bg-red-600 hover:bg-red-700 py-2 px-4 rounded-lg font-medium transition flex items-center justify-center gap-2">
                                <i class="fas fa-trash"></i>
                                Clear All
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Stats -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="glass-card rounded-xl p-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400 text-sm">üöÄ Fresh Tokens</p>
                                <p id="stat-fresh" class="text-2xl font-bold text-pink-400">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="glass-card rounded-xl p-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400 text-sm">üí∞ Total Volume</p>
                                <p id="stat-volume" class="text-2xl font-bold text-green-400">$0</p>
                            </div>
                        </div>
                    </div>
                    <div class="glass-card rounded-xl p-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400 text-sm">üî• Avg Risk</p>
                                <p id="stat-risk" class="text-2xl font-bold text-yellow-400">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="glass-card rounded-xl p-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400 text-sm">‚ö° Auto Refresh</p>
                                <p class="text-2xl font-bold text-blue-400">ON</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Fresh Tokens Table -->
                <div class="glass-card rounded-xl border border-pink-500/20 overflow-hidden">
                    <div class="p-4 border-b border-slate-700/50">
                        <h2 class="text-lg font-semibold flex items-center gap-2">
                            <i class="fas fa-bolt text-pink-400"></i>
                            üî• Fresh Token Launches
                        </h2>
                        <p class="text-xs text-gray-400 mt-1">From Pump.fun + Dexscreener</p>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-slate-800/50">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Token</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Age</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Volume</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Liquidity</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Price</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Change</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Risk</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="fresh-tbody" class="divide-y divide-slate-700/50">
                                <tr>
                                    <td colspan="8" class="px-4 py-8 text-center text-gray-400">
                                        <i class="fas fa-spinner fa-spin mb-2 text-2xl"></i>
                                        <p>Loading fresh tokens... üöÄ</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Activity Feed -->
            <div class="hidden lg:block w-80">
                <div class="sticky top-4 glass-card rounded-xl p-4 border border-slate-700/50">
                    <div class="flex items-center gap-2 mb-4">
                        <i class="fas fa-bolt text-yellow-400"></i>
                        <span class="font-semibold">Live Activity</span>
                        <div class="w-2 h-2 bg-green-400 rounded-full ml-auto animate-pulse"></div>
                    </div>
                    <div id="activity-feed" class="space-y-3 max-h-[600px] overflow-y-auto">
                        <div class="text-sm p-3 rounded-lg bg-slate-800/30 text-center text-gray-400">
                            <p>Loading activity...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        console.log('üêã WhaleTracker Pro - PUMP.FUN Edition starting...');

        // ‚úÖ CORRECTED API ENDPOINTS
        const DEXSCREENER_API = {
            NEWEST: 'https://api.dexscreener.com/latest/dex/search',
            TRENDING: 'https://api.dexscreener.com/latest/dex/tokens/trending',
            SEARCH: 'https://api.dexscreener.com/latest/dex/search',
            PAIRS: 'https://api.dexscreener.com/latest/dex/pairs'
        };

        // ‚úÖ PUMP.FUN REST API ENDPOINTS
        const PUMP_FUN_APIS = {
            NEW_TOKENS: 'https://pumpportal.fun/api/new',
            TRENDING: 'https://pumpportal.fun/api/trending'
        };

        // State
        let state = {
            freshTokens: [],
            isScanningFresh: false,
            minLiquidity: 2000
        };

        // Helper functions
        function formatAmount(amount) {
            if (!amount || isNaN(amount)) return '$0';
            if (amount >= 1e9) return '$' + (amount / 1e9).toFixed(2) + 'B';
            if (amount >= 1e6) return '$' + (amount / 1e6).toFixed(2) + 'M';
            if (amount >= 1e3) return '$' + (amount / 1e3).toFixed(1) + 'K';
            return '$' + amount.toFixed(2);
        }

        function formatAge(timestamp) {
            const ageMs = Date.now() - timestamp;
            const minutes = Math.floor(ageMs / 60000);
            if (minutes < 1) return 'Just now';
            if (minutes < 60) return `${minutes}m`;
            const hours = Math.floor(minutes / 60);
            if (hours < 24) return `${hours}h`;
            return `${Math.floor(hours / 24)}d`;
        }

        function formatAgeMinutes(timestamp) {
            return Math.floor((Date.now() - timestamp) / 60000);
        }

        function showApiStatus(message, type = 'info') {
            const colors = {
                error: { bg: 'bg-red-900/20', border: 'border-red-500/30', text: 'text-red-400', icon: 'exclamation-triangle' },
                success: { bg: 'bg-green-900/20', border: 'border-green-500/30', text: 'text-green-400', icon: 'check-circle' },
                info: { bg: 'bg-yellow-900/20', border: 'border-yellow-500/30', text: 'text-yellow-400', icon: 'info-circle' }
            };
            
            const color = colors[type];
            const statusDiv = document.getElementById('api-status');
            const messageEl = document.getElementById('status-message');
            
            statusDiv.className = `mb-6 rounded-lg p-3 border ${color.bg} ${color.border}`;
            messageEl.className = `text-sm flex items-center ${color.text}`;
            messageEl.innerHTML = `<i class="fas fa-${color.icon} mr-2"></i>${message}`;
        }

        function calculateRiskScore(token) {
            let score = 0;
            let reasons = [];
            
            const ageMinutes = token.ageMinutes || formatAgeMinutes(token.createdAt);
            if (ageMinutes < 10) {
                score += 30;
                reasons.push('Age <10m');
            } else if (ageMinutes < 30) {
                score += 20;
                reasons.push('Age <30m');
            }
            
            const liquidity = token.liquidity?.usd || token.liquidity || 0;
            if (liquidity < 5000) {
                score += 25;
                reasons.push('Low liquidity');
            } else if (liquidity < 20000) {
                score += 15;
                reasons.push('Moderate liquidity');
            }
            
            const priceChange1h = token.priceChange?.h1 || 0;
            if (Math.abs(priceChange1h) > 50) {
                score += 15;
                reasons.push('High volatility');
            }
            
            return {
                score: Math.min(100, score),
                level: score >= 70 ? 'HIGH' : score >= 40 ? 'MEDIUM' : 'LOW',
                reasons: reasons.slice(0, 3)
            };
        }

        function getChainBadge(chainId) {
            return `<span class="chain-badge sol-badge" title="${chainId}">S</span>`;
        }

        // ‚úÖ FETCH HELPER FUNCTIONS
        async function fetchNewestTokens() {
            try {
                const response = await fetch(`${DEXSCREENER_API.SEARCH}?q=solana`);
                const data = await response.json();
                return data.pairs || [];
            } catch (error) {
                console.error('Error fetching newest tokens:', error);
                return [];
            }
        }

        async function fetchTrendingTokens() {
            try {
                const response = await fetch(DEXSCREENER_API.TRENDING);
                const data = await response.json();
                return data.pairs || [];
            } catch (error) {
                console.error('Error fetching trending tokens:', error);
                return [];
            }
        }

        async function searchMemeTokens() {
            try {
                const memeTerms = ['pepe', 'bonk', 'wif', 'doge'];
                const randomTerm = memeTerms[Math.floor(Math.random() * memeTerms.length)];
                const response = await fetch(`${DEXSCREENER_API.SEARCH}?q=${randomTerm}`);
                const data = await response.json();
                return data.pairs || [];
            } catch (error) {
                console.error('Error searching meme tokens:', error);
                return [];
            }
        }

        // ‚úÖ MAIN FRESH LAUNCHES FUNCTION
        async function fetchFreshLaunches() {
            if (state.isScanningFresh) return;
            
            state.isScanningFresh = true;
            const freshIcon = document.getElementById('fresh-icon');
            freshIcon.className = 'fas fa-spinner fa-spin';
            document.getElementById('btn-fresh').disabled = true;
            
            showApiStatus('üöÄ Scanning for fresh launches...', 'info');
            
            try {
                // üü£ 1. PUMP.FUN LIVE LAUNCHES (Hauptquelle)
                try {
                    console.log('üîç Fetching from Pump.fun API...');
                    const pumpRes = await fetch(PUMP_FUN_APIS.NEW_TOKENS);
                    const pumpData = await pumpRes.json();

                    if (pumpData && pumpData.length) {
                        console.log(`‚úÖ Got ${pumpData.length} tokens from Pump.fun!`);
                        
                        const fresh = pumpData.slice(0, 30).map(t => ({
                            mint: t.mint || 'N/A',
                            symbol: t.symbol || 'NEW',
                            name: t.name || 'Pump Token',
                            createdAt: (t.created_timestamp || Date.now() / 1000) * 1000,
                            source: 'PUMP_FUN',
                            chainId: 'solana',
                            priceUsd: parseFloat(t.price || 0.0001),
                            volume: { 
                                h24: parseFloat(t.usd_volume_24h || t.volume_24h || 0), 
                                h1: parseFloat(t.usd_volume_1h || 0) 
                            },
                            liquidity: { usd: parseFloat(t.usd_liquidity || t.liquidity || 1000) },
                            priceChange: { h1: 0, h24: 0 },
                            dexId: 'pump.fun',
                            pairAddress: t.mint || 'N/A',
                            ageMinutes: Math.floor((Date.now() - ((t.created_timestamp || Date.now() / 1000) * 1000)) / 60000),
                            url: `https://pump.fun/${t.mint}`
                        }));

                        // Calculate risk scores
                        fresh.forEach(token => {
                            const riskData = calculateRiskScore(token);
                            token.riskScore = riskData.score;
                            token.riskLevel = riskData.level;
                            token.riskReasons = riskData.reasons;
                            token.tags = token.ageMinutes < 30 ? ['NEW<30m'] : [];
                        });

                        state.freshTokens = fresh;
                        updateFreshTokensTable();
                        updateActivityFeed();
                        updateStats();
                        
                        showApiStatus(`‚úÖ ${fresh.length} fresh Pump.fun tokens found!`, 'success');
                        return; // Stop here - Pump.fun is our main source
                    }
                } catch (pumpError) {
                    console.warn('‚ö†Ô∏è Pump.fun fetch error:', pumpError);
                    showApiStatus('‚ö†Ô∏è Pump.fun error, trying Dexscreener...', 'info');
                }

                // üîµ 2. FALLBACK: DexScreener New Pairs
                console.log('üîç Falling back to Dexscreener...');
                const newestPairs = await fetchNewestTokens();
                
                // üîµ 3. FALLBACK: DexScreener Trending
                const trendingPairs = await fetchTrendingTokens();
                
                // üîµ 4. FALLBACK: Meme Token Search
                const memePairs = await searchMemeTokens();
                
                // Alle kombinieren
                const allPairs = [...newestPairs, ...trendingPairs, ...memePairs];
                
                // Duplikate entfernen und nach Volumen sortieren
                const uniquePairs = Array.from(new Map(allPairs.map(p => [p.pairAddress, p])).values())
                    .filter(pair => {
                        const volume = parseFloat(pair.volume?.h24 || 0);
                        const liquidity = parseFloat(pair.liquidity?.usd || 0);
                        const age = Date.now() - (pair.pairCreatedAt || Date.now());
                        
                        return volume >= 10000 && // $10k+ Volume
                               liquidity >= 2000 && // $2k+ Liquidity  
                               age < (24 * 60 * 60 * 1000); // <24h old
                    })
                    .sort((a, b) => (b.pairCreatedAt || 0) - (a.pairCreatedAt || 0));
                
                // Enrich with risk scores
                const enrichedTokens = uniquePairs.map(pair => {
                    const ageMinutes = formatAgeMinutes(pair.pairCreatedAt);
                    const riskData = calculateRiskScore({
                        ...pair,
                        ageMinutes
                    });
                    
                    const tags = [];
                    if (ageMinutes < 30) tags.push('NEW<30m');
                    if (pair.volume?.h24 > 100000) tags.push('TRENDING');
                    
                    return {
                        mint: pair.baseToken?.address,
                        symbol: pair.baseToken?.symbol || 'UNKNOWN',
                        name: pair.baseToken?.name || 'Unknown Token',
                        createdAt: pair.pairCreatedAt,
                        source: 'DEXSCREENER',
                        dexId: pair.dexId,
                        pairAddress: pair.pairAddress,
                        chainId: pair.chainId,
                        priceUsd: parseFloat(pair.priceUsd || 0),
                        priceChange: {
                            h1: parseFloat(pair.priceChange?.h1 || 0),
                            h24: parseFloat(pair.priceChange?.h24 || 0)
                        },
                        volume: {
                            h1: parseFloat(pair.volume?.h1 || 0),
                            h24: parseFloat(pair.volume?.h24 || 0)
                        },
                        liquidity: {
                            usd: parseFloat(pair.liquidity?.usd || 0)
                        },
                        ageMinutes,
                        riskScore: riskData.score,
                        riskLevel: riskData.level,
                        riskReasons: riskData.reasons,
                        flags: ageMinutes < 10 ? ['NEW_LAUNCH'] : [],
                        tags,
                        url: pair.url
                    };
                });
                
                state.freshTokens = enrichedTokens.slice(0, 50);
                updateFreshTokensTable();
                updateStats();
                updateActivityFeed();
                
                if (enrichedTokens.length > 0) {
                    showApiStatus(`‚úÖ Found ${state.freshTokens.length} fresh tokens from Dexscreener!`, 'success');
                } else {
                    // üü† FALLBACK: Mock data
                    loadFallbackData();
                    showApiStatus('‚ö†Ô∏è Using demo data - APIs may be unavailable', 'error');
                }
                
            } catch (error) {
                console.error('‚ùå Fresh launches error:', error);
                loadFallbackData();
                showApiStatus('‚ùå Error fetching data, using demo data', 'error');
            } finally {
                state.isScanningFresh = false;
                freshIcon.className = 'fas fa-bolt';
                document.getElementById('btn-fresh').disabled = false;
            }
        }

        // üü† FALLBACK DATA
        function loadFallbackData() {
            console.log('üì¶ Loading fallback demo data...');
            
            const mockTokens = [
                {
                    mint: 'So11111111111111111111111111111111111111112',
                    symbol: 'DEMO1',
                    name: 'Demo Token 1',
                    createdAt: Date.now() - 15 * 60 * 1000,
                    source: 'FALLBACK',
                    chainId: 'solana',
                    priceUsd: 0.000456,
                    volume: { h24: 125000, h1: 15000 },
                    liquidity: { usd: 25000 },
                    priceChange: { h1: 15.5, h24: 45.2 },
                    ageMinutes: 15,
                    riskScore: 35,
                    riskLevel: 'LOW',
                    riskReasons: ['Good liquidity', 'Normal volatility'],
                    tags: ['NEW<30m'],
                    url: 'https://dexscreener.com'
                },
                {
                    mint: 'So11111111111111111111111111111111111111113',
                    symbol: 'DEMO2',
                    name: 'Demo Token 2',
                    createdAt: Date.now() - 5 * 60 * 1000,
                    source: 'FALLBACK', 
                    chainId: 'solana',
                    priceUsd: 0.000123,
                    volume: { h24: 85000, h1: 25000 },
                    liquidity: { usd: 8000 },
                    priceChange: { h1: 85.2, h24: 120.5 },
                    ageMinutes: 5,
                    riskScore: 75,
                    riskLevel: 'HIGH',
                    riskReasons: ['Age <10m', 'High volatility'],
                    tags: ['NEW<30m'],
                    url: 'https://dexscreener.com'
                }
            ];
            
            state.freshTokens = mockTokens;
            updateFreshTokensTable();
            updateStats();
            updateActivityFeed();
        }

        // ‚úÖ UPDATE TABLE
        function updateFreshTokensTable() {
            const tbody = document.getElementById('fresh-tbody');
            
            if (state.freshTokens.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="px-4 py-8 text-center text-gray-400">
                            <i class="fas fa-bolt mb-2 text-2xl"></i>
                            <p>No fresh tokens found.</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = state.freshTokens.map(token => {
                const riskBadgeClass = `risk-${token.riskLevel.toLowerCase()}`;
                const badges = [];
                
                if (token.ageMinutes < 30) badges.push('<span class="badge-new text-xs px-2 py-1 rounded">üÜï NEW</span>');
                if (token.source === 'PUMP_FUN') badges.push('<span class="bg-purple-600 text-xs px-2 py-1 rounded">‚ö° PUMP.FUN</span>');
                
                return `
                    <tr class="animate-fade-in">
                        <td class="px-4 py-3">
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 bg-gradient-to-r from-purple-500 to-blue-500 rounded-lg flex items-center justify-center text-white font-bold text-xs">
                                    ${token.symbol?.substring(0, 3) || '???'}
                                </div>
                                <div>
                                    <div class="font-medium flex items-center gap-2">
                                        ${token.symbol}
                                        ${getChainBadge(token.chainId)}
                                    </div>
                                    <div class="text-xs text-gray-400">${token.name}</div>
                                </div>
                            </div>
                            <div class="flex gap-1 mt-2">
                                ${badges.join('')}
                            </div>
                        </td>
                        <td class="px-4 py-3 text-sm">
                            <div class="font-medium">${formatAge(token.createdAt)}</div>
                            <div class="text-xs text-gray-400">${token.ageMinutes}m ago</div>
                        </td>
                        <td class="px-4 py-3 text-sm font-medium text-green-400">
                            ${formatAmount(token.volume.h24)}
                        </td>
                        <td class="px-4 py-3 text-sm">
                            ${formatAmount(token.liquidity.usd)}
                        </td>
                        <td class="px-4 py-3 text-sm font-medium">
                            $${token.priceUsd < 0.0001 ? token.priceUsd.toExponential(2) : token.priceUsd.toFixed(6)}
                        </td>
                        <td class="px-4 py-3 text-sm">
                            <span class="${token.priceChange.h1 >= 0 ? 'text-green-400' : 'text-red-400'} font-medium">
                                ${token.priceChange.h1 >= 0 ? '+' : ''}${token.priceChange.h1.toFixed(1)}%
                            </span>
                        </td>
                        <td class="px-4 py-3">
                            <span class="${riskBadgeClass} text-xs px-2 py-1 rounded">${token.riskLevel}</span>
                            <div class="text-xs text-gray-400 mt-1">${token.riskScore}/100</div>
                        </td>
                        <td class="px-4 py-3">
                            <button onclick="window.open('${token.url}', '_blank')" 
                                    class="text-xs px-2 py-1 bg-purple-600 hover:bg-purple-700 rounded">
                                View
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // ‚úÖ UPDATE ACTIVITY FEED
        function updateActivityFeed() {
            const feed = document.getElementById('activity-feed');
            feed.innerHTML = '';
            
            state.freshTokens.slice(0, 10).forEach(token => {
                const riskIcon = token.riskLevel === 'HIGH' ? 'üî¥' : token.riskLevel === 'MEDIUM' ? 'üü°' : 'üü¢';
                const sourceIcon = token.source === 'PUMP_FUN' ? '‚ö°' : 'üìà';
                
                const item = document.createElement('div');
                item.className = 'text-sm p-2 rounded-lg bg-slate-800/30 animate-fade-in';
                item.innerHTML = `
                    <div class="flex items-start gap-2">
                        <span class="text-lg">${sourceIcon}</span>
                        <div class="flex-1">
                            <div class="font-medium text-pink-400">${token.symbol}</div>
                            <div class="text-xs text-gray-400">${formatAmount(token.volume.h24)} vol ‚Ä¢ ${riskIcon}</div>
                        </div>
                        <div class="text-gray-500 text-xs">${formatAge(token.createdAt)}</div>
                    </div>
                `;
                feed.appendChild(item);
            });
        }

        // ‚úÖ UPDATE STATS
        function updateStats() {
            document.getElementById('stat-fresh').textContent = state.freshTokens.length;
            
            const totalVolume = state.freshTokens.reduce((sum, t) => sum + (t.volume.h24 || 0), 0);
            document.getElementById('stat-volume').textContent = formatAmount(totalVolume);
            
            const avgRisk = state.freshTokens.length > 0 
                ? Math.round(state.freshTokens.reduce((sum, t) => sum + t.riskScore, 0) / state.freshTokens.length)
                : 0;
            document.getElementById('stat-risk').textContent = avgRisk;
        }

        // ‚úÖ EVENT LISTENERS
        document.getElementById('btn-fresh').addEventListener('click', fetchFreshLaunches);
        
        document.getElementById('btn-clear').addEventListener('click', () => {
            state.freshTokens = [];
            updateFreshTokensTable();
            updateStats();
            updateActivityFeed();
            showApiStatus('üóëÔ∏è All data cleared!', 'info');
        });

        // ‚úÖ INITIALIZE APP
        function initApp() {
            console.log('üöÄ Initializing WhaleTracker Pro...');
            updateStats();
            showApiStatus('üöÄ Loading fresh tokens...', 'info');
        }

        // üü£ AUTO-LOAD ON START
        document.addEventListener('DOMContentLoaded', () => {
            initApp();
            // Auto-load fresh tokens on startup
            setTimeout(fetchFreshLaunches, 1000);
            
            // Auto-refresh every 60 seconds
            setInterval(() => {
                if (!state.isScanningFresh) {
                    console.log('üîÑ Auto-refreshing...');
                    fetchFreshLaunches();
                }
            }, 60000);
        });

        console.log('‚úÖ WhaleTracker Pro initialized!');
        console.log('üí° Data will auto-load in 1 second...');
    </script>
</body>
</html>
