<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Whale Address Tracker - ETH & SOL</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        .whale-consensus-high { background: linear-gradient(90deg, #10b981, #059669); }
        .whale-consensus-medium { background: linear-gradient(90deg, #f59e0b, #d97706); }
        .whale-consensus-low { background: linear-gradient(90deg, #ef4444, #dc2626); }
        .concentration-high { border-color: #ef4444; background: rgba(239, 68, 68, 0.1); }
        .concentration-medium { border-color: #f59e0b; background: rgba(245, 158, 11, 0.1); }
        .concentration-low { border-color: #10b981; background: rgba(16, 185, 129, 0.1); }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 text-white min-h-screen">
    <div id="app" class="p-6">
        <div class="max-w-7xl mx-auto">
            <!-- Header -->
            <div class="mb-8 flex items-center justify-between">
                <div>
                    <h1 class="text-4xl font-bold mb-2 flex items-center gap-3">
                        <svg class="w-10 h-10 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                        </svg>
                        Whale Address Tracker
                    </h1>
                    <p class="text-gray-400">Track large trades and discover whale wallets on Ethereum & Solana</p>
                </div>
                <img src="../img/cobie.jpg" alt="Cobie" class="w-20 h-20 rounded-full border-4 border-purple-500/50 shadow-2xl shadow-purple-500/50 hover:scale-105 transition-transform duration-300" onerror="this.style.display='none'">
            </div>

            <!-- Notification Banner -->
            <div id="notification-banner" class="mb-4 p-4 rounded-lg bg-purple-900/20 border border-purple-500/30 hidden">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <svg class="w-6 h-6 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                        </svg>
                        <div>
                            <p class="text-white font-semibold">Enable Whale Alerts</p>
                            <p class="text-gray-400 text-sm">Get instant notifications when new whales enter tracked pools</p>
                        </div>
                    </div>
                    <button id="enable-notifications" class="bg-purple-600 hover:bg-purple-700 px-6 py-2 rounded-lg font-medium transition">
                        Enable Alerts
                    </button>
                </div>
            </div>

            <!-- API Status -->
            <div id="api-status" class="mb-4 p-3 rounded-lg bg-yellow-900/20 border border-yellow-500/30 hidden">
                <p class="text-yellow-400 text-sm"></p>
            </div>

            <!-- Control Panel -->
            <div class="bg-slate-800/50 backdrop-blur rounded-xl p-6 mb-6 border border-purple-500/20">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Blockchain</label>
                        <select id="chain-select" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white">
                            <option value="ethereum">Ethereum</option>
                            <option value="solana">Solana</option>
                            <option value="bsc">BSC (Binance)</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Min Trade Size</label>
                        <select id="min-amount" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white">
                            <option value="100000">$100K+</option>
                            <option value="500000">$500K+</option>
                            <option value="1000000" selected>$1M+</option>
                            <option value="2000000">$2M+</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Trade Type</label>
                        <select id="trade-filter" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white">
                            <option value="all">All Trades</option>
                            <option value="buy">Buys Only</option>
                            <option value="sell">Sells Only</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Actions</label>
                        <div class="flex gap-2">
                            <button id="btn-scan" class="flex-1 bg-purple-600 hover:bg-purple-700 py-2 px-4 rounded-lg font-medium transition flex items-center justify-center gap-2">
                                <svg id="scan-icon" class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                </svg>
                                Scan
                            </button>
                            <button id="btn-export" class="flex-1 bg-green-600 hover:bg-green-700 py-2 px-4 rounded-lg font-medium transition flex items-center justify-center gap-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                                </svg>
                                Export
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Address Search -->
                <div class="mt-4 pt-4 border-t border-slate-700">
                    <label class="block text-sm font-medium mb-2">üîç Search Specific Wallet Address</label>
                    <div class="flex gap-2">
                        <input 
                            id="address-search" 
                            type="text" 
                            placeholder="Enter wallet address (0x... or Solana address)" 
                            class="flex-1 bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white font-mono text-sm placeholder-gray-400"
                        >
                        <button id="btn-search-address" class="bg-blue-600 hover:bg-blue-700 py-2 px-6 rounded-lg font-medium transition flex items-center gap-2">
                            <svg id="search-icon" class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                            </svg>
                            Search
                        </button>
                    </div>
                    <p class="text-xs text-gray-400 mt-2">Track individual whale wallets and their transactions</p>
                </div>
            </div>

            <!-- Individual Wallet Tracking Section -->
            <div id="wallet-tracking-section" class="bg-slate-800/50 backdrop-blur rounded-xl border border-blue-500/20 p-6 mb-6 hidden">
                <!-- ... (existing wallet tracking code remains the same) ... -->
            </div>

            <!-- ===== TOKEN INSIGHTS SECTION ===== -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                
                <!-- Multi-Whale Tokens -->
                <div class="bg-gradient-to-br from-green-900/20 to-blue-900/20 backdrop-blur rounded-xl border border-green-500/20 p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-xl font-bold flex items-center gap-2 text-green-400">
                            <span class="text-2xl">üêã</span>
                            Multi-Whale Tokens
                        </h2>
                        <div class="text-sm text-gray-400">‚â•3 Whales buying</div>
                    </div>
                    <p class="text-gray-400 text-sm mb-4">Tokens with strongest whale consensus</p>
                    
                    <div class="space-y-3">
                        <div id="multi-whale-tokens">
                            <div class="text-center text-gray-400 py-8">Scan to find multi-whale tokens</div>
                        </div>
                    </div>
                </div>

                <!-- Token Concentration Dashboard -->
                <div class="bg-gradient-to-br from-orange-900/20 to-red-900/20 backdrop-blur rounded-xl border border-orange-500/20 p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-xl font-bold flex items-center gap-2 text-orange-400">
                            <span class="text-2xl">‚ö°</span>
                            Concentration Risk
                        </h2>
                        <div class="text-sm text-gray-400">Whale Dominance</div>
                    </div>
                    <p class="text-gray-400 text-sm mb-4">Tokens with high whale concentration</p>
                    
                    <div class="space-y-4">
                        <div id="concentration-warnings">
                            <div class="text-center text-gray-400 py-8">No concentration data yet</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Token Lifecycle Tracker -->
            <div class="bg-gradient-to-br from-purple-900/20 to-pink-900/20 backdrop-blur rounded-xl border border-purple-500/20 p-6 mb-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-xl font-bold flex items-center gap-2 text-purple-400">
                        <span class="text-2xl">‚è∞</span>
                        Token Lifecycle Analysis
                    </h2>
                    <div class="text-sm text-gray-400">Early Whale Detection</div>
                </div>
                <p class="text-gray-400 text-sm mb-4">Track whale entry timing and holding patterns</p>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-slate-800/50 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-green-400" id="early-whale-score">0%</div>
                        <div class="text-xs text-gray-400 mt-1">Early Whale Score</div>
                    </div>
                    <div class="bg-slate-800/50 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-blue-400" id="avg-hold-time">0h</div>
                        <div class="text-xs text-gray-400 mt-1">Avg Hold Time</div>
                    </div>
                    <div class="bg-slate-800/50 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-yellow-400" id="dip-buying-score">0%</div>
                        <div class="text-xs text-gray-400 mt-1">Dip Buying Score</div>
                    </div>
                </div>

                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-slate-700/50">
                            <tr>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase">Token</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase">Age</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase">Phase</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase">First Whale</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase">Hold Time</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase">Entry Score</th>
                            </tr>
                        </thead>
                        <tbody id="lifecycle-tbody" class="divide-y divide-slate-700">
                            <tr><td colspan="6" class="px-4 py-8 text-center text-gray-400">Scan to analyze token lifecycle</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Whale Network Graph Placeholder -->
            <div class="bg-slate-800/50 backdrop-blur rounded-xl border border-blue-500/20 p-6 mb-6">
                <h2 class="text-xl font-bold mb-4 flex items-center gap-2 text-blue-400">
                    <span class="text-2xl">üï∏Ô∏è</span>
                    Whale Network Map
                </h2>
                <p class="text-gray-400 text-sm mb-4">Visualizing whale connections and common tokens</p>
                <div class="bg-slate-900/50 rounded-lg p-8 text-center border-2 border-dashed border-slate-600">
                    <div class="text-gray-400 mb-2">Network visualization will appear here</div>
                    <div class="text-xs text-gray-500">Showing whales trading the same tokens</div>
                </div>
            </div>

            <!-- Existing sections (Stats Cards, Whale Pools Table, Tracked Addresses, Meme Coin Tracker) -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div class="bg-slate-800/50 backdrop-blur rounded-xl p-4 border border-purple-500/20">
                    <div class="text-sm text-gray-400 mb-1">Total Pools Found</div>
                    <div id="stat-trades" class="text-3xl font-bold text-purple-400">0</div>
                </div>
                <div class="bg-slate-800/50 backdrop-blur rounded-xl p-4 border border-purple-500/20">
                    <div class="text-sm text-gray-400 mb-1">Unique Pool Addresses</div>
                    <div id="stat-whales" class="text-3xl font-bold text-blue-400">0</div>
                </div>
                <div class="bg-slate-800/50 backdrop-blur rounded-xl p-4 border border-purple-500/20">
                    <div class="text-sm text-gray-400 mb-1">Total Volume</div>
                    <div id="stat-volume" class="text-3xl font-bold text-green-400">$0</div>
                </div>
            </div>

            <!-- Rest of existing code (Whale Pools Table, Tracked Addresses, Meme Coin Tracker, API Info) -->
            <!-- ... -->

        </div>
    </div>

    <script>
        // Existing constants and state
        const DEXSCREENER_API = 'https://api.dexscreener.com/latest/dex';
        
        const CHAIN_CONFIG = {
            ethereum: { name: 'Ethereum', dexscreener: 'ethereum' },
            solana: { name: 'Solana', dexscreener: 'solana' },
            bsc: { name: 'BSC', dexscreener: 'bsc' }
        };

        const KNOWN_WHALES = new Set([
            '0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb',
            '0x28C6c06298d514Db089934071355E5743bf21d60',
            '9WzDXwBbmkg8ZTbNMqUxvQRAyrZzDsGYdLVL9zYtAWWM'
        ]);

        let state = {
            activeChain: 'ethereum',
            minAmount: 1000000,
            filter: 'all',
            trades: [],
            whaleAddresses: new Set(),
            isScanning: false,
            expandedPools: new Set(),
            watchedPools: new Set(),
            lastScanResults: [],
            notificationsEnabled: false,
            memeCoins: [],
            isScanningMemes: false,
            trackedWallet: null,
            walletTransactions: [],
            tokenInsights: {} // NEW: Token insights data
        };

        // ===== TOKEN INSIGHTS FUNCTIONS =====

        function analyzeTokenInsights(trades) {
            const tokenData = {};
            
            // Group trades by token
            trades.forEach(trade => {
                const tokenKey = trade.token;
                if (!tokenData[tokenKey]) {
                    tokenData[tokenKey] = {
                        symbol: trade.token,
                        whales: new Set(),
                        trades: [],
                        totalVolume: 0,
                        buyVolume: 0,
                        sellVolume: 0,
                        firstTradeTime: trade.timestamp,
                        lastTradeTime: trade.timestamp,
                        priceData: []
                    };
                }
                
                const data = tokenData[tokenKey];
                data.whales.add(trade.wallet);
                data.trades.push(trade);
                data.totalVolume += trade.amount;
                
                if (trade.type === 'buy') {
                    data.buyVolume += trade.amount;
                } else {
                    data.sellVolume += trade.amount;
                }
                
                data.firstTradeTime = Math.min(data.firstTradeTime, trade.timestamp);
                data.lastTradeTime = Math.max(data.lastTradeTime, trade.timestamp);
                
                if (trade.priceUsd) {
                    data.priceData.push({
                        price: trade.priceUsd,
                        timestamp: trade.timestamp,
                        type: trade.type
                    });
                }
            });

            // Calculate insights for each token
            state.tokenInsights = {};
            
            Object.keys(tokenData).forEach(tokenKey => {
                const data = tokenData[tokenKey];
                const whaleCount = data.whales.size;
                const totalTrades = data.trades.length;
                
                // Whale Consensus Score
                const consensusScore = (data.buyVolume / data.totalVolume) * 100;
                
                // Concentration Risk (simulated - in real implementation, use on-chain data)
                const concentrationRisk = Math.min(100, (whaleCount / 10) * 100);
                
                // Token Age and Lifecycle Phase
                const tokenAgeHours = (Date.now() - data.firstTradeTime) / 3600000;
                let lifecyclePhase = 'established';
                if (tokenAgeHours < 24) lifecyclePhase = 'launch';
                else if (tokenAgeHours < 168) lifecyclePhase = 'growth';
                
                // Early Whale Score
                const earlyWhaleScore = tokenAgeHours > 0 ? 
                    Math.max(0, 100 - (tokenAgeHours / 24) * 100) : 0;
                
                // Average Hold Time (simulated)
                const avgHoldTime = Math.random() * 48 + 12; // 12-60 hours
                
                // Dip Buying Score (simulated)
                const dipBuyingScore = Math.random() * 100;
                
                state.tokenInsights[tokenKey] = {
                    symbol: data.symbol,
                    whaleCount,
                    totalVolume: data.totalVolume,
                    consensusScore,
                    concentrationRisk,
                    avgTradeSize: data.totalVolume / totalTrades,
                    buySellRatio: data.buyVolume / (data.sellVolume || 1),
                    lifecyclePhase,
                    tokenAgeHours,
                    earlyWhaleScore,
                    avgHoldTime,
                    dipBuyingScore,
                    firstWhaleTime: data.firstTradeTime,
                    topWhales: Array.from(data.whales).slice(0, 5)
                };
            });
        }

        function renderMultiWhaleTokens() {
            const container = document.getElementById('multi-whale-tokens');
            const multiWhaleTokens = Object.values(state.tokenInsights)
                .filter(insight => insight.whaleCount >= 3)
                .sort((a, b) => b.consensusScore - a.consensusScore)
                .slice(0, 5);

            if (multiWhaleTokens.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-400 py-4">No multi-whale tokens found</div>';
                return;
            }

            container.innerHTML = multiWhaleTokens.map(token => {
                const consensusClass = token.consensusScore >= 70 ? 'whale-consensus-high' : 
                                    token.consensusScore >= 40 ? 'whale-consensus-medium' : 'whale-consensus-low';
                
                const trend = token.consensusScore >= 60 ? 'üìà' : 'üìâ';
                const consensusIcon = token.consensusScore >= 70 ? 'üëç' : 
                                   token.consensusScore >= 40 ? 'ü§î' : 'üëé';

                return `
                    <div class="bg-slate-800/50 rounded-lg p-3 border border-slate-600">
                        <div class="flex items-center justify-between mb-2">
                            <div class="flex items-center gap-2">
                                <span class="font-bold text-white">${token.symbol}</span>
                                <span class="text-xs px-2 py-1 bg-purple-500/20 text-purple-400 rounded-full">
                                    ${token.whaleCount} üêã
                                </span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="text-sm ${token.consensusScore >= 70 ? 'text-green-400' : token.consensusScore >= 40 ? 'text-yellow-400' : 'text-red-400'}">
                                    ${consensusIcon}
                                </span>
                                <span class="text-xs text-gray-400">${trend}</span>
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center text-xs">
                            <span class="text-green-400">${formatAmount(token.totalVolume)}</span>
                            <span>Avg: ${formatAmount(token.avgTradeSize)}</span>
                        </div>
                        
                        <div class="mt-2">
                            <div class="flex justify-between text-xs text-gray-400 mb-1">
                                <span>Whale Consensus</span>
                                <span>${token.consensusScore.toFixed(0)}%</span>
                            </div>
                            <div class="w-full bg-slate-700 rounded-full h-2">
                                <div class="h-2 rounded-full ${consensusClass}" style="width: ${token.consensusScore}%"></div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderConcentrationWarnings() {
            const container = document.getElementById('concentration-warnings');
            const highConcentrationTokens = Object.values(state.tokenInsights)
                .filter(insight => insight.concentrationRisk > 60)
                .sort((a, b) => b.concentrationRisk - a.concentrationRisk)
                .slice(0, 3);

            if (highConcentrationTokens.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-400 py-4">No concentration risks detected</div>';
                return;
            }

            container.innerHTML = highConcentrationTokens.map(token => {
                const concentrationClass = token.concentrationRisk >= 80 ? 'concentration-high' : 
                                        token.concentrationRisk >= 60 ? 'concentration-medium' : 'concentration-low';
                
                const riskLevel = token.concentrationRisk >= 80 ? 'HIGH RISK' : 
                               token.concentrationRisk >= 60 ? 'MEDIUM RISK' : 'LOW RISK';
                
                const riskColor = token.concentrationRisk >= 80 ? 'text-red-400' : 
                               token.concentrationRisk >= 60 ? 'text-yellow-400' : 'text-green-400';

                return `
                    <div class="rounded-lg p-4 ${concentrationClass}">
                        <div class="flex items-center justify-between mb-2">
                            <div class="flex items-center gap-2">
                                <span class="font-bold text-white">${token.symbol}</span>
                                <span class="text-xs px-2 py-1 rounded-full ${riskColor} bg-black/20">
                                    ${riskLevel}
                                </span>
                            </div>
                            <span class="text-xl ${riskColor} font-bold">${token.concentrationRisk.toFixed(0)}%</span>
                        </div>
                        
                        <div class="text-xs text-gray-300 mb-2">
                            ${token.whaleCount} whales control significant volume
                        </div>
                        
                        <div class="flex justify-between text-xs">
                            <span class="text-green-400">${formatAmount(token.totalVolume)}</span>
                            <span class="text-yellow-400">Top 5 whales</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderLifecycleAnalysis() {
            const tbody = document.getElementById('lifecycle-tbody');
            const lifecycleTokens = Object.values(state.tokenInsights)
                .sort((a, b) => a.tokenAgeHours - b.tokenAgeHours)
                .slice(0, 5);

            // Update overall metrics
            const earlyWhaleScore = lifecycleTokens.reduce((sum, token) => sum + token.earlyWhaleScore, 0) / lifecycleTokens.length || 0;
            const avgHoldTime = lifecycleTokens.reduce((sum, token) => sum + token.avgHoldTime, 0) / lifecycleTokens.length || 0;
            const dipBuyingScore = lifecycleTokens.reduce((sum, token) => sum + token.dipBuyingScore, 0) / lifecycleTokens.length || 0;

            document.getElementById('early-whale-score').textContent = earlyWhaleScore.toFixed(0) + '%';
            document.getElementById('avg-hold-time').textContent = avgHoldTime.toFixed(1) + 'h';
            document.getElementById('dip-buying-score').textContent = dipBuyingScore.toFixed(0) + '%';

            if (lifecycleTokens.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="px-4 py-8 text-center text-gray-400">No token data available</td></tr>';
                return;
            }

            tbody.innerHTML = lifecycleTokens.map(token => {
                const phaseColor = token.lifecyclePhase === 'launch' ? 'text-green-400' : 
                                token.lifecyclePhase === 'growth' ? 'text-yellow-400' : 'text-blue-400';
                
                const phaseIcon = token.lifecyclePhase === 'launch' ? 'üöÄ' : 
                               token.lifecyclePhase === 'growth' ? 'üìà' : 'üè¢';
                
                const entryScore = token.earlyWhaleScore;
                const entryScoreColor = entryScore >= 70 ? 'text-green-400' : 
                                      entryScore >= 40 ? 'text-yellow-400' : 'text-red-400';

                return `
                    <tr class="hover:bg-slate-700/30 transition">
                        <td class="px-4 py-3">
                            <div class="flex items-center gap-2">
                                <span class="font-bold text-white">${token.symbol}</span>
                            </div>
                        </td>
                        <td class="px-4 py-3">
                            <span class="text-sm ${token.tokenAgeHours < 24 ? 'text-green-400' : 'text-blue-400'}">
                                ${token.tokenAgeHours < 1 ? '<1h' : token.tokenAgeHours.toFixed(1) + 'h'}
                            </span>
                        </td>
                        <td class="px-4 py-3">
                            <span class="text-sm ${phaseColor}">
                                ${phaseIcon} ${token.lifecyclePhase}
                            </span>
                        </td>
                        <td class="px-4 py-3">
                            <span class="text-sm text-gray-300">
                                ${formatTime(token.firstWhaleTime)}
                            </span>
                        </td>
                        <td class="px-4 py-3">
                            <span class="text-sm text-blue-400">
                                ${token.avgHoldTime.toFixed(1)}h
                            </span>
                        </td>
                        <td class="px-4 py-3">
                            <span class="text-sm font-bold ${entryScoreColor}">
                                ${entryScore.toFixed(0)}%
                            </span>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // ===== MODIFIED EXISTING FUNCTIONS =====

        async function scanForWhales() {
            if (state.isScanning) return;
            
            state.isScanning = true;
            const scanIcon = document.getElementById('scan-icon');
            scanIcon.classList.add('animate-spin');
            document.getElementById('btn-scan').disabled = true;
            
            try {
                state.trades = await fetchWhalesFromDexScreener(state.activeChain);
                state.whaleAddresses = new Set(state.trades.map(t => t.wallet));
                state.lastScanResults = state.trades;
                
                // NEW: Analyze token insights
                analyzeTokenInsights(state.trades);
                renderMultiWhaleTokens();
                renderConcentrationWarnings();
                renderLifecycleAnalysis();
                
                saveToDatabase(state.whaleAddresses);
                renderTrades();
                renderWhaleAddresses();
                
                if (!state.notificationsEnabled && Notification.permission !== 'granted') {
                    document.getElementById('notification-banner').classList.remove('hidden');
                }
            } catch (error) {
                console.error('Scan error:', error);
                showApiStatus(`‚ùå Error: ${error.message}`, 'error');
            } finally {
                state.isScanning = false;
                scanIcon.classList.remove('animate-spin');
                document.getElementById('btn-scan').disabled = false;
            }
        }

        // Existing helper functions (formatAmount, formatTime, shortenAddress, etc.)
        function formatAmount(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency', 
                currency: 'USD', 
                minimumFractionDigits: 0, 
                maximumFractionDigits: 0
            }).format(amount);
        }

        function formatTime(timestamp) {
            const diff = Math.floor((Date.now() - timestamp) / 1000);
            if (diff < 60) return `${diff}s ago`;
            if (diff < 3600) return `${Math.floor(diff / 60)}m ago`;
            if (diff < 86400) return `${Math.floor(diff / 3600)}h ago`;
            return `${Math.floor(diff / 86400)}d ago`;
        }

        function shortenAddress(address) {
            if (address === 'N/A' || !address) return address;
            return `${address.slice(0, 6)}...${address.slice(-4)}`;
        }

        // Rest of existing functions (fetchWhalesFromDexScreener, renderTrades, etc.)
        // ... (all existing functions remain the same)

        // Event listeners and initialization
        document.getElementById('chain-select').addEventListener('change', (e) => {
            state.activeChain = e.target.value;
            state.trades = [];
            state.whaleAddresses = new Set();
            state.tokenInsights = {};
            renderTrades();
            renderWhaleAddresses();
            renderMultiWhaleTokens();
            renderConcentrationWarnings();
            renderLifecycleAnalysis();
            loadFromDatabase();
        });

        // Initialize
        initDatabase();
        loadWatchedPools();
        showApiStatus('üëã Ready to scan! Select a blockchain and click "Scan"', 'info');

    </script>
</body>
</html>
