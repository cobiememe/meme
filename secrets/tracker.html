<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhaleTracker Pro - Real-time Crypto Whale Analytics</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-fade-in { animation: fadeIn 0.5s ease-out; }
        .animate-spin { animation: spin 1s linear infinite; }
        .glass-card { 
            background: rgba(15, 23, 42, 0.7); 
            border: 1px solid rgba(124, 58, 237, 0.1); 
            backdrop-filter: blur(10px);
        }
        .tab-active { 
            border-bottom: 2px solid #8b5cf6;
            color: #8b5cf6;
        }
        .sparkline {
            width: 60px;
            height: 20px;
        }
        tr:hover { 
            background-color: rgba(139, 92, 246, 0.1) !important; 
            transform: scale(1.01);
            transition: all 0.15s ease;
        }
        .tab-content {
            transition: opacity 0.3s ease;
        }
        .tab-content.hidden { 
            opacity: 0; 
            pointer-events: none;
            position: absolute;
        }
        .tab-content:not(.hidden) {
            opacity: 1;
            position: relative;
        }
        .pulse-ring {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(0.95); opacity: 1; }
            50% { transform: scale(1); opacity: 0.7; }
            100% { transform: scale(0.95); opacity: 1; }
        }
        .chain-badge {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
        }
        .eth-badge { background: #627eea; color: white; }
        .sol-badge { background: linear-gradient(45deg, #9945FF, #14F195); color: white; }
        .bsc-badge { background: #f0b90b; color: black; }
        .base-badge { background: #0052FF; color: white; }
        .risk-high { background: #ef4444; color: white; }
        .risk-medium { background: #f59e0b; color: white; }
        .risk-low { background: #10b981; color: white; }
        .badge-new { background: #ec4899; color: white; }
        .badge-trending { background: #f59e0b; color: white; }
        .badge-whale { background: #8b5cf6; color: white; }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-indigo-950 to-slate-900 text-white min-h-screen">
    <div id="app" class="p-4">
        <!-- Header -->
        <header class="max-w-7xl mx-auto mb-8">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="relative">
                        <div class="w-12 h-12 bg-gradient-to-r from-purple-500 to-blue-500 rounded-xl flex items-center justify-center text-white font-bold text-lg pulse-ring">
                            üêã
                        </div>
                        <div class="absolute -top-1 -right-1 w-4 h-4 bg-green-400 rounded-full border-2 border-slate-900"></div>
                    </div>
                    <div>
                        <h1 class="text-3xl font-bold bg-gradient-to-r from-purple-400 to-blue-400 bg-clip-text text-transparent">
                            WhaleTracker Pro
                        </h1>
                        <p class="text-gray-400 mt-1">Live whale tracking & new meme coin discovery</p>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <button id="theme-toggle" class="p-2 rounded-lg bg-slate-800 hover:bg-slate-700 transition">
                        <i class="fas fa-moon"></i>
                    </button>
                    <button class="px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg transition flex items-center gap-2">
                        <i class="fas fa-bolt"></i>
                        <span>Live</span>
                        <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                    </button>
                </div>
            </div>
        </header>

        <div class="max-w-7xl mx-auto flex gap-6">
            <!-- Main Content -->
            <div class="flex-1">
                <!-- Tabs Navigation -->
                <div class="mb-6">
                    <div class="flex border-b border-slate-700 gap-6 overflow-x-auto">
                        <button class="tab-btn py-3 px-1 font-medium text-gray-400 hover:text-white transition tab-active" data-tab="fresh">
                            <i class="fas fa-bolt mr-2"></i>Fresh Launches
                        </button>
                        <button class="tab-btn py-3 px-1 font-medium text-gray-400 hover:text-white transition" data-tab="pools">
                            <i class="fas fa-water mr-2"></i>Hot Pools
                        </button>
                        <button class="tab-btn py-3 px-1 font-medium text-gray-400 hover:text-white transition" data-tab="memes">
                            <i class="fas fa-rocket mr-2"></i>Live Memes
                        </button>
                        <button class="tab-btn py-3 px-1 font-medium text-gray-400 hover:text-white transition" data-tab="wallet">
                            <i class="fas fa-wallet mr-2"></i>Wallet Tracker
                        </button>
                        <button class="tab-btn py-3 px-1 font-medium text-gray-400 hover:text-white transition" data-tab="wallets">
                            <i class="fas fa-fish mr-2"></i>Watched Wallets
                        </button>
                    </div>
                </div>

                <!-- API Status -->
                <div id="api-status" class="mb-6">
                    <div class="bg-yellow-900/20 border border-yellow-500/30 rounded-lg p-3">
                        <p class="text-yellow-400 text-sm flex items-center">
                            <i class="fas fa-info-circle mr-2"></i>
                            <span id="status-message">üöÄ Ready! Click "Fresh Launches" for real-time data</span>
                        </p>
                    </div>
                </div>

                <!-- Control Panel -->
                <div class="glass-card rounded-xl p-6 mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-2 text-gray-300">
                                <i class="fas fa-link mr-2"></i>Blockchain
                            </label>
                            <select id="chain-select" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-white text-sm">
                                <option value="all">All Chains</option>
                                <option value="solana" selected>Solana</option>
                                <option value="ethereum">Ethereum</option>
                                <option value="base">Base</option>
                                <option value="bsc">BSC</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2 text-gray-300">
                                <i class="fas fa-filter mr-2"></i>Min Volume
                            </label>
                            <select id="min-amount" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-white text-sm">
                                <option value="1000">$1K+</option>
                                <option value="10000">$10K+</option>
                                <option value="50000" selected>$50K+</option>
                                <option value="100000">$100K+</option>
                            </select>
                        </div>
                        <div class="flex items-end gap-2">
                            <button id="btn-fresh" class="flex-1 bg-green-600 hover:bg-green-700 py-2 px-4 rounded-lg font-medium transition flex items-center justify-center gap-2">
                                <i id="fresh-icon" class="fas fa-bolt"></i>
                                Fresh Launches
                            </button>
                            <button id="btn-scan" class="flex-1 bg-purple-600 hover:bg-purple-700 py-2 px-4 rounded-lg font-medium transition flex items-center justify-center gap-2">
                                <i id="scan-icon" class="fas fa-search"></i>
                                Scan Pools
                            </button>
                        </div>
                        <div class="flex items-end">
                            <button id="btn-export" class="w-full bg-blue-600 hover:bg-blue-700 py-2 px-4 rounded-lg font-medium transition flex items-center justify-center gap-2">
                                <i class="fas fa-download"></i>
                                Export Data
                            </button>
                        </div>
                    </div>

                    <!-- Advanced Filters -->
                    <div class="mt-6 pt-6 border-t border-slate-700/50">
                        <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-2 text-gray-300">Age</label>
                                <select id="filter-age" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-white text-sm">
                                    <option value="30m"><30m</option>
                                    <option value="1h"><1h</option>
                                    <option value="6h"><6h</option>
                                    <option value="24h"><24h</option>
                                    <option value="all">All</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2 text-gray-300">Liquidity</label>
                                <select id="filter-liquidity" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-white text-sm">
                                    <option value="1000">>1k</option>
                                    <option value="5000">>5k</option>
                                    <option value="10000">>10k</option>
                                    <option value="50000">>50k</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2 text-gray-300">Volume</label>
                                <select id="filter-volume" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-white text-sm">
                                    <option value="1000">>1k</option>
                                    <option value="10000">>10k</option>
                                    <option value="50000">>50k</option>
                                    <option value="100000">>100k</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2 text-gray-300">Risk</label>
                                <select id="filter-risk" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-white text-sm">
                                    <option value="all">All</option>
                                    <option value="LOW">Low</option>
                                    <option value="MEDIUM">Medium</option>
                                    <option value="HIGH">High</option>
                                </select>
                            </div>
                            <div class="flex items-end">
                                <button id="btn-apply-filters" class="w-full bg-indigo-600 hover:bg-indigo-700 py-2 px-4 rounded-lg font-medium transition">
                                    Apply Filters
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Wallet Search -->
                    <div class="mt-6 pt-6 border-t border-slate-700/50">
                        <label class="block text-sm font-medium mb-2 text-gray-300">
                            <i class="fas fa-search mr-2"></i>Track Specific Wallet
                        </label>
                        <div class="flex gap-2">
                            <input 
                                id="wallet-search" 
                                type="text" 
                                placeholder="Enter Ethereum (0x...) or Solana wallet address" 
                                class="flex-1 bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-white text-sm placeholder-gray-500 font-mono"
                            >
                            <button id="btn-search-wallet" class="bg-blue-600 hover:bg-blue-700 px-6 py-2 rounded-lg transition flex items-center gap-2">
                                <i id="wallet-search-icon" class="fas fa-search"></i>
                                Analyze
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="glass-card rounded-xl p-4 animate-fade-in hover:transform hover:scale-105 transition-all duration-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400 text-sm">Fresh Launches</p>
                                <p id="stat-fresh" class="text-2xl font-bold text-green-400">0</p>
                            </div>
                            <div class="w-10 h-10 bg-green-500/20 rounded-lg flex items-center justify-center">
                                <i class="fas fa-bolt text-green-400"></i>
                            </div>
                        </div>
                    </div>
                    <div class="glass-card rounded-xl p-4 animate-fade-in hover:transform hover:scale-105 transition-all duration-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400 text-sm">Hot Pools</p>
                                <p id="stat-pools" class="text-2xl font-bold text-purple-400">0</p>
                            </div>
                            <div class="w-10 h-10 bg-purple-500/20 rounded-lg flex items-center justify-center">
                                <i class="fas fa-water text-purple-400"></i>
                            </div>
                        </div>
                    </div>
                    <div class="glass-card rounded-xl p-4 animate-fade-in hover:transform hover:scale-105 transition-all duration-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400 text-sm">Watched Wallets</p>
                                <p id="stat-wallets" class="text-2xl font-bold text-blue-400">0</p>
                            </div>
                            <div class="w-10 h-10 bg-blue-500/20 rounded-lg flex items-center justify-center">
                                <i class="fas fa-eye text-blue-400"></i>
                            </div>
                        </div>
                    </div>
                    <div class="glass-card rounded-xl p-4 animate-fade-in hover:transform hover:scale-105 transition-all duration-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400 text-sm">Total Volume</p>
                                <p id="stat-volume" class="text-2xl font-bold text-orange-400">$0</p>
                            </div>
                            <div class="w-10 h-10 bg-orange-500/20 rounded-lg flex items-center justify-center">
                                <i class="fas fa-chart-bar text-orange-400"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab Content -->
                <div class="relative">
                    <!-- Fresh Launches Tab -->
                    <div id="fresh-tab" class="tab-content">
                        <div class="glass-card rounded-xl border border-green-500/20 overflow-hidden">
                            <div class="p-4 border-b border-slate-700/50 flex items-center justify-between">
                                <h2 class="text-lg font-semibold flex items-center gap-2">
                                    <i class="fas fa-bolt text-green-400"></i>
                                    Fresh Token Launches (Last 24h)
                                </h2>
                                <div class="flex items-center gap-2">
                                    <div class="text-sm text-gray-400">
                                        <span id="fresh-count">0</span> new tokens
                                    </div>
                                    <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                                </div>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-slate-800/50">
                                        <tr>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Token</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Age</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Volume 24h</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Liquidity</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Price</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Change 1h</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Risk</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="fresh-tbody" class="divide-y divide-slate-700/50">
                                        <tr>
                                            <td colspan="8" class="px-4 py-8 text-center text-gray-400">
                                                <i class="fas fa-bolt mb-2 text-2xl"></i>
                                                <p>Click "Fresh Launches" for real-time new tokens! ‚ö°</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Pools Tab -->
                    <div id="pools-tab" class="tab-content hidden">
                        <div class="glass-card rounded-xl border border-slate-700/50 overflow-hidden">
                            <div class="p-4 border-b border-slate-700/50 flex items-center justify-between">
                                <h2 class="text-lg font-semibold flex items-center gap-2">
                                    <i class="fas fa-water"></i>
                                    Live Trading Pools
                                </h2>
                                <div class="text-sm text-gray-400">
                                    <span id="pools-count">0</span> active pools
                                </div>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-slate-800/50">
                                        <tr>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Token</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Chain</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">24h Volume</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Liquidity</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Price</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">24h %</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">DEX</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="pools-tbody" class="divide-y divide-slate-700/50">
                                        <tr>
                                            <td colspan="8" class="px-4 py-8 text-center text-gray-400">
                                                <i class="fas fa-search mb-2 text-2xl"></i>
                                                <p>Click "Scan Pools" for live data! üêã</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Memes Tab -->
                    <div id="memes-tab" class="tab-content hidden">
                        <div class="glass-card rounded-xl border border-pink-500/20 overflow-hidden">
                            <div class="p-4 border-b border-slate-700/50 flex items-center justify-between">
                                <h2 class="text-lg font-semibold flex items-center gap-2">
                                    <i class="fas fa-rocket text-pink-400"></i>
                                    Live Meme Coins (Last 2 Hours)
                                </h2>
                                <div class="flex items-center gap-2">
                                    <div class="text-sm text-gray-400">
                                        <span id="memes-count">0</span> new tokens
                                    </div>
                                    <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                                </div>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-slate-800/50">
                                        <tr>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Token</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Age</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Volume</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Liquidity</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Price</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Change</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Risk</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="memes-tbody" class="divide-y divide-slate-700/50">
                                        <tr>
                                            <td colspan="8" class="px-4 py-8 text-center text-gray-400">
                                                <i class="fas fa-rocket mb-2 text-2xl"></i>
                                                <p>Click "Live Memes" for real-time launches! üöÄ</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Wallet Tracker Tab -->
                    <div id="wallet-tab" class="tab-content hidden">
                        <div class="glass-card rounded-xl border border-blue-500/20 overflow-hidden">
                            <div class="p-4 border-b border-slate-700/50">
                                <h2 class="text-lg font-semibold flex items-center gap-2">
                                    <i class="fas fa-wallet text-blue-400"></i>
                                    Wallet Analysis
                                </h2>
                                <p class="text-sm text-gray-400 mt-1">Enter a wallet address to analyze interesting movements and large trades</p>
                            </div>
                            <div class="p-6">
                                <div id="wallet-analysis" class="text-center py-8 text-gray-400">
                                    <i class="fas fa-search mb-4 text-4xl"></i>
                                    <p>Enter a wallet address above and click "Analyze" to see trading activity</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Watched Wallets Tab -->
                    <div id="wallets-tab" class="tab-content hidden">
                        <div class="glass-card rounded-xl border border-green-500/20 overflow-hidden">
                            <div class="p-4 border-b border-slate-700/50">
                                <h2 class="text-lg font-semibold flex items-center gap-2">
                                    <i class="fas fa-eye text-green-400"></i>
                                    Watched Whale Wallets
                                </h2>
                            </div>
                            <div class="p-4">
                                <div id="wallets-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    <p class="text-gray-400 text-center col-span-3 py-8">
                                        <i class="fas fa-fish mb-2 text-2xl"></i>
                                        <p>No wallets being watched yet. Analyze a wallet and click "Watch Wallet"!</p>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Live Activity Feed (Fixed Sidebar) -->
            <div class="hidden lg:block w-80">
                <div class="sticky top-28 glass-card rounded-xl p-4 border border-slate-700/50">
                    <div class="flex items-center gap-2 mb-4">
                        <i class="fas fa-bolt text-yellow-400"></i>
                        <span class="font-semibold">Live Launches</span>
                        <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse ml-auto"></div>
                    </div>
                    <div id="activity-feed" class="space-y-3 max-h-[600px] overflow-y-auto">
                        <div class="text-sm p-2 rounded-lg bg-slate-800/30">
                            <div class="flex items-start gap-2">
                                <span class="text-lg">üöÄ</span>
                                <div class="flex-1">
                                    <div class="font-medium text-green-400">New Launch</div>
                                    <div class="text-gray-400 text-xs">Token ‚Ä¢ Raydium</div>
                                </div>
                                <div class="text-gray-500 text-xs">Just now</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // üî• VERCEL API INTEGRATION - Nutzt deine eigenen Vercel Functions!
        // WICHTIG: API Keys sind jetzt sicher server-seitig in Vercel Environment Variables!
        const API_BASE = window.location.origin; // Automatisch: https://cobie.uk

        const CHAIN_CONFIG = {
            all: { name: 'All Chains', id: 'all' },
            solana: { name: 'Solana', id: 'solana' },
            ethereum: { name: 'Ethereum', id: 'eth' },
            base: { name: 'Base', id: 'base' },
            bsc: { name: 'BSC', id: 'bsc' }
        };

        // Extended Data Model
        let state = {
            activeChain: 'solana',
            minAmount: 50000,
            pools: [],
            memes: [],
            freshTokens: [],
            watchedWallets: new Set(JSON.parse(localStorage.getItem('watchedWallets') || '[]')),
            isScanning: false,
            isScanningFresh: false,
            theme: 'dark',
            filters: {
                age: '30m',
                liquidity: '1000',
                volume: '1000',
                risk: 'all'
            }
        };

        // Helper functions
        function formatAmount(amount) {
            if (!amount || isNaN(amount)) return '$0';
            if (amount >= 1000000000) return '$' + (amount / 1000000000).toFixed(2) + 'B';
            if (amount >= 1000000) return '$' + (amount / 1000000).toFixed(2) + 'M';
            if (amount >= 1000) return '$' + (amount / 1000).toFixed(1) + 'K';
            return '$' + amount.toFixed(0);
        }

        function shortenAddress(address) {
            if (!address || address === 'N/A') return 'N/A';
            return `${address.slice(0, 6)}...${address.slice(-4)}`;
        }

        function formatAge(timestamp) {
            if (!timestamp) return 'Unknown';
            const ageMs = Date.now() - timestamp;
            const minutes = Math.floor(ageMs / (1000 * 60));
            const hours = Math.floor(minutes / 60);
            
            if (minutes < 1) return 'Just now';
            if (minutes < 60) return `${minutes}m`;
            if (hours < 24) return `${hours}h`;
            return `${Math.floor(hours / 24)}d`;
        }

        function formatAgeMinutes(timestamp) {
            if (!timestamp) return 1440; // Default to 1 day if unknown
            const ageMs = Date.now() - timestamp;
            return Math.floor(ageMs / (1000 * 60));
        }

        function showApiStatus(message, type = 'info') {
            const statusDiv = document.getElementById('api-status');
            const messageEl = document.getElementById('status-message');
            
            statusDiv.className = `mb-6 rounded-lg p-3 ${
                type === 'error' ? 'bg-red-900/20 border-red-500/30' :
                type === 'success' ? 'bg-green-900/20 border-green-500/30' :
                'bg-yellow-900/20 border-yellow-500/30'
            }`;
            
            messageEl.className = `text-sm flex items-center ${
                type === 'error' ? 'text-red-400' :
                type === 'success' ? 'text-green-400' :
                'text-yellow-400'
            }`;
            
            messageEl.innerHTML = `<i class="fas fa-${type === 'error' ? 'exclamation-triangle' : type === 'success' ? 'check-circle' : 'info-circle'} mr-2"></i>${message}`;
        }

        // ‚úÖ RISK SCORE Calculation mit echten Daten
        function calculateRiskScore(token) {
            let score = 0;
            let reasons = [];
            
            const ageMinutes = token.ageMinutes || 1440;
            const liquidity = token.liquidity?.usd || token.liquidity || 0;
            const priceChange1h = token.priceChange?.h1 || 0;
            const volume24h = token.volume?.h24 || 0;
            
            // Age scoring - echte Daten!
            if (ageMinutes < 10) {
                score += 30;
                reasons.push('Age <10m');
            } else if (ageMinutes < 30) {
                score += 20;
                reasons.push('Age <30m');
            } else if (ageMinutes < 60) {
                score += 10;
                reasons.push('Age <1h');
            }
            
            // Liquidity scoring - echte Daten!
            if (liquidity < 1000) {
                score += 30;
                reasons.push('Very low liquidity');
            } else if (liquidity < 5000) {
                score += 20;
                reasons.push('Low liquidity');
            } else if (liquidity < 20000) {
                score += 10;
                reasons.push('Moderate liquidity');
            }
            
            // Volatility scoring - echte Daten!
            if (Math.abs(priceChange1h) > 100) {
                score += 25;
                reasons.push('Extreme volatility');
            } else if (Math.abs(priceChange1h) > 50) {
                score += 15;
                reasons.push('High volatility');
            } else if (Math.abs(priceChange1h) > 20) {
                score += 10;
                reasons.push('Moderate volatility');
            }
            
            return {
                score: Math.min(100, score),
                level: score >= 60 ? 'HIGH' : score >= 30 ? 'MEDIUM' : 'LOW',
                reasons: reasons.slice(0, 3)
            };
        }

        // Get chain badge
        function getChainBadge(chainId) {
            const badges = {
                'ethereum': { class: 'eth-badge', text: 'E' },
                'solana': { class: 'sol-badge', text: 'S' },
                'bsc': { class: 'bsc-badge', text: 'B' },
                'base': { class: 'base-badge', text: 'B' },
                'arbitrum': { class: 'bg-blue-500', text: 'A' },
                'polygon': { class: 'bg-purple-500', text: 'P' }
            };
            const badge = badges[chainId] || { class: 'bg-gray-500', text: '?' };
            return `<span class="chain-badge ${badge.class}" title="${chainId}">${badge.text}</span>`;
        }

        // ‚úÖ ECHTE API FUNKTIONEN - KEINE MOCK DATEN!

        // üî• DEXSCREENER TRENDING TOKENS - √ºber Vercel API!
        async function fetchDexScreenerTrending() {
            try {
                // Nutzt deine Vercel Function: /api/dex-proxy.js
                const response = await fetch(`${API_BASE}/api/dex-proxy?type=trending&limit=25`);
                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || 'DexScreener API failed');
                }
                
                const pairs = result.data || [];
                return pairs.map(pair => ({
                    symbol: pair.baseToken?.symbol || 'UNKNOWN',
                    name: pair.baseToken?.name || 'Unknown Token',
                    address: pair.baseToken?.address,
                    mint: pair.baseToken?.address,
                    priceUsd: parseFloat(pair.priceUsd || 0),
                    volume: { 
                        h24: parseFloat(pair.volume?.h24 || 0),
                        h1: parseFloat(pair.volume?.h1 || 0)
                    },
                    liquidity: { usd: parseFloat(pair.liquidity?.usd || 0) },
                    priceChange: { 
                        h1: parseFloat(pair.priceChange?.h1 || 0),
                        h24: parseFloat(pair.priceChange?.h24 || 0)
                    },
                    chainId: pair.chainId || 'solana',
                    dexId: pair.dexId || 'Unknown DEX',
                    createdAt: pair.pairCreatedAt ? new Date(pair.pairCreatedAt).getTime() : Date.now(),
                    url: `https://dexscreener.com/${pair.chainId}/${pair.pairAddress}`,
                    tags: []
                }));
            } catch (error) {
                console.error('‚ùå DexScreener Vercel API error:', error);
                showApiStatus('‚ö†Ô∏è DexScreener API failed: ' + error.message, 'error');
                return [];
            }
        }

        // üî• PUMP.FUN - DEAKTIVIERT (Keine API vorhanden)
        // Wenn du Pump.fun nutzen willst, erstelle /api/pump-proxy.js
        async function fetchPumpFunTokens() {
            console.log('‚ö†Ô∏è Pump.fun API not configured');
            return [];
        }

        // üî• DEXSCREENER NEW PAIRS - √ºber Vercel API!
        async function fetchNewPairs() {
            try {
                // Nutzt deine Vercel Function: /api/dex-proxy.js
                const response = await fetch(`${API_BASE}/api/dex-proxy?type=new&limit=20`);
                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || 'New pairs API failed');
                }
                
                const pairs = result.data || [];
                return pairs.map(pair => ({
                    symbol: pair.baseToken?.symbol || 'NEW',
                    name: pair.baseToken?.name || 'New Token',
                    address: pair.baseToken?.address,
                    mint: pair.baseToken?.address,
                    priceUsd: parseFloat(pair.priceUsd || 0),
                    volume: { 
                        h24: parseFloat(pair.volume?.h24 || 0),
                        h1: parseFloat(pair.volume?.h1 || 0)
                    },
                    liquidity: { usd: parseFloat(pair.liquidity?.usd || 0) },
                    priceChange: { 
                        h1: parseFloat(pair.priceChange?.h1 || 0),
                        h24: parseFloat(pair.priceChange?.h24 || 0)
                    },
                    chainId: pair.chainId || 'solana',
                    dexId: pair.dexId || 'Raydium',
                    createdAt: pair.pairCreatedAt ? new Date(pair.pairCreatedAt).getTime() : Date.now(),
                    url: `https://dexscreener.com/${pair.chainId}/${pair.pairAddress}`,
                    tags: ['NEW']
                }));
            } catch (error) {
                console.error('‚ùå New pairs error:', error);
                return [];
            }
        }

        // üî• SOLANA TOKENS - √ºber Moralis Vercel API!
        async function fetchSolanaTokens() {
            try {
                // Nutzt deine Vercel Function: /api/solana.js
                const response = await fetch(`${API_BASE}/api/solana`);
                const data = await response.json();
                
                // Moralis Daten verarbeiten (Struktur kann variieren)
                const tokens = Array.isArray(data) ? data : (data.tokens || []);
                
                return tokens.slice(0, 15).map(token => ({
                    symbol: token.symbol || 'SOL',
                    name: token.name || 'Solana Token',
                    address: token.mint || token.address,
                    mint: token.mint || token.address,
                    priceUsd: parseFloat(token.price || 0),
                    volume: { h24: parseFloat(token.volume || 0), h1: 0 },
                    liquidity: { usd: parseFloat(token.liquidity || 0) },
                    priceChange: { h1: 0, h24: 0 },
                    chainId: 'solana',
                    dexId: 'Moralis',
                    createdAt: Date.now() - Math.random() * 3600000,
                    url: `https://solscan.io/token/${token.mint || token.address}`,
                    tags: []
                }));
            } catch (error) {
                console.error('‚ùå Moralis Solana API error:', error);
                return [];
            }
        }

        // ‚úÖ MAIN FRESH LAUNCHES FUNCTION - NUR ECHTE DATEN!
        async function fetchFreshLaunches() {
            if (state.isScanningFresh) return;
            
            state.isScanningFresh = true;
            const freshIcon = document.getElementById('fresh-icon');
            freshIcon.className = 'fas fa-spinner fa-spin';
            document.getElementById('btn-fresh').disabled = true;
            
            showApiStatus('üöÄ Scanning via Vercel APIs (DexScreener + Moralis)...', 'info');
            
            try {
                let allTokens = [];
                
                // üî• 1. DEXSCREENER TRENDING - √ºber Vercel API
                try {
                    const dexTokens = await fetchDexScreenerTrending();
                    allTokens = [...allTokens, ...dexTokens];
                    console.log(`üìä DexScreener: ${dexTokens.length} tokens`);
                } catch (e) {
                    console.warn('DexScreener failed:', e);
                }
                
                // üî• 2. NEW SOLANA PAIRS - √ºber Vercel API
                try {
                    const newPairs = await fetchNewPairs();
                    allTokens = [...allTokens, ...newPairs];
                    console.log(`üÜï New Pairs: ${newPairs.length} tokens`);
                } catch (e) {
                    console.warn('New pairs failed:', e);
                }
                
                // üî• 3. MORALIS SOLANA TOKENS - √ºber Vercel API
                try {
                    const solTokens = await fetchSolanaTokens();
                    allTokens = [...allTokens, ...solTokens];
                    console.log(`‚ö° Moralis: ${solTokens.length} tokens`);
                } catch (e) {
                    console.warn('Moralis failed:', e);
                }
                
                // üî• PROCESS AND ENRICH TOKENS
                const enrichedTokens = allTokens
                    .filter(token => {
                        const volume = token.volume?.h24 || 0;
                        const liquidity = token.liquidity?.usd || 0;
                        const minVolume = parseInt(document.getElementById('min-amount').value);
                        
                        // Filter by chain
                        if (state.activeChain !== 'all' && token.chainId !== state.activeChain) {
                            return false;
                        }
                        
                        return volume >= minVolume && liquidity >= 100;
                    })
                    .map(token => {
                        const ageMinutes = formatAgeMinutes(token.createdAt);
                        const riskData = calculateRiskScore({
                            ...token,
                            ageMinutes
                        });
                        
                        const tags = [];
                        if (ageMinutes < 60) tags.push('NEW<1h');
                        if (token.volume?.h24 > 100000) tags.push('TRENDING');
                        if (token.priceChange?.h1 > 50) tags.push('PUMPING');
                        if (token.priceChange?.h1 < -30) tags.push('DUMPING');
                        
                        // Meme detection
                        const isMeme = /pepe|bonk|wif|floki|doge|shib|baby|meme|cat|dog|hamster|hamster|coin/i.test(
                            (token.symbol + token.name).toLowerCase()
                        );
                        if (isMeme) tags.push('MEME');
                        
                        return {
                            ...token,
                            mint: token.address,
                            source: 'LIVE_API',
                            ageMinutes,
                            riskScore: riskData.score,
                            riskLevel: riskData.level,
                            riskReasons: riskData.reasons,
                            tags,
                            url: token.url || `https://dexscreener.com/${token.chainId}/${token.address}`
                        };
                    })
                    // Remove duplicates based on address
                    .filter((token, index, self) => 
                        index === self.findIndex(t => t.address === token.address)
                    )
                    .slice(0, 30); // Top 30 tokens
                
                state.freshTokens = enrichedTokens;
                updateFreshTokensTable();
                updateStats();
                updateActivityFeed();
                
                if (enrichedTokens.length > 0) {
                    showApiStatus(`‚úÖ Found ${enrichedTokens.length} REAL tokens from live APIs!`, 'success');
                } else {
                    showApiStatus('‚ö†Ô∏è No tokens found - try different filters', 'info');
                }
                
            } catch (error) {
                console.error('Fresh launches error:', error);
                showApiStatus('‚ùå Network error - check console', 'error');
            } finally {
                state.isScanningFresh = false;
                freshIcon.className = 'fas fa-bolt';
                document.getElementById('btn-fresh').disabled = false;
            }
        }

        // ‚úÖ UPDATE FRESH TOKENS TABLE
        function updateFreshTokensTable() {
            const tbody = document.getElementById('fresh-tbody');
            const countEl = document.getElementById('fresh-count');
            
            if (state.freshTokens.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="px-4 py-8 text-center text-gray-400">
                            <i class="fas fa-bolt mb-2 text-2xl"></i>
                            <p>No tokens found. Click "Fresh Launches" to scan!</p>
                        </td>
                    </tr>
                `;
                countEl.textContent = '0';
                return;
            }
            
            const filteredTokens = state.freshTokens.filter(token => {
                const ageMinutes = token.ageMinutes;
                const liquidity = token.liquidity.usd;
                const volume = token.volume.h24;
                const riskLevel = token.riskLevel;
                
                if (state.filters.age === '30m' && ageMinutes >= 30) return false;
                if (state.filters.age === '1h' && ageMinutes >= 60) return false;
                if (state.filters.age === '6h' && ageMinutes >= 360) return false;
                if (state.filters.age === '24h' && ageMinutes >= 1440) return false;
                if (liquidity < parseInt(state.filters.liquidity)) return false;
                if (volume < parseInt(state.filters.volume)) return false;
                if (state.filters.risk !== 'all' && riskLevel !== state.filters.risk) return false;
                
                return true;
            });
            
            countEl.textContent = filteredTokens.length;
            
            tbody.innerHTML = filteredTokens.map(token => {
                const riskBadgeClass = `risk-${token.riskLevel.toLowerCase()}`;
                
                const badges = [];
                if (token.ageMinutes < 30) badges.push('<span class="badge-new text-xs px-2 py-1 rounded">üÜï NEW</span>');
                if (token.riskLevel === 'HIGH') badges.push(`<span class="${riskBadgeClass} text-xs px-2 py-1 rounded">üî¥ HIGH</span>`);
                else if (token.riskLevel === 'MEDIUM') badges.push(`<span class="${riskBadgeClass} text-xs px-2 py-1 rounded">üü° MEDIUM</span>`);
                if (token.tags.includes('TRENDING')) badges.push('<span class="badge-trending text-xs px-2 py-1 rounded">üìà TRENDING</span>');
                if (token.tags.includes('MEME')) badges.push('<span class="bg-pink-600 text-xs px-2 py-1 rounded">üé≠ MEME</span>');
                if (token.tags.includes('PUMPING')) badges.push('<span class="bg-green-600 text-xs px-2 py-1 rounded">üöÄ PUMPING</span>');
                
                return `
                    <tr class="animate-fade-in">
                        <td class="px-4 py-3">
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 bg-gradient-to-r from-purple-500 to-blue-500 rounded-lg flex items-center justify-center text-white font-bold text-xs">
                                    ${token.symbol?.substring(0, 3) || '???'}
                                </div>
                                <div>
                                    <div class="font-medium flex items-center gap-2">
                                        ${token.symbol}
                                        ${getChainBadge(token.chainId)}
                                    </div>
                                    <div class="text-xs text-gray-400">${token.name}</div>
                                    <div class="text-xs text-gray-500">${token.dexId}</div>
                                </div>
                            </div>
                            <div class="flex gap-1 mt-2">
                                ${badges.join('')}
                            </div>
                        </td>
                        <td class="px-4 py-3 text-sm">
                            <div class="font-medium">${formatAge(token.createdAt)}</div>
                            <div class="text-xs text-gray-400">${token.ageMinutes}m ago</div>
                        </td>
                        <td class="px-4 py-3 text-sm font-medium">
                            ${formatAmount(token.volume.h24)}
                        </td>
                        <td class="px-4 py-3 text-sm">
                            ${formatAmount(token.liquidity.usd)}
                        </td>
                        <td class="px-4 py-3 text-sm font-medium">
                            $${token.priceUsd < 0.0001 ? token.priceUsd.toExponential(2) : token.priceUsd.toFixed(6)}
                        </td>
                        <td class="px-4 py-3 text-sm">
                            <span class="${token.priceChange.h1 >= 0 ? 'text-green-400' : 'text-red-400'} font-medium">
                                ${token.priceChange.h1 >= 0 ? '+' : ''}${token.priceChange.h1.toFixed(1)}%
                            </span>
                        </td>
                        <td class="px-4 py-3">
                            <div class="flex flex-col gap-1">
                                <span class="${riskBadgeClass} text-xs px-2 py-1 rounded text-center">${token.riskLevel}</span>
                                <div class="text-xs text-gray-400 text-center">${token.riskScore}/100</div>
                            </div>
                        </td>
                        <td class="px-4 py-3">
                            <div class="flex gap-2">
                                <button onclick="window.open('${token.url}', '_blank')" class="p-2 bg-blue-600 hover:bg-blue-700 rounded-lg transition" title="View Chart">
                                    <i class="fas fa-chart-line text-xs"></i>
                                </button>
                                <button onclick="copyToClipboard('${token.mint}')" class="p-2 bg-green-600 hover:bg-green-700 rounded-lg transition" title="Copy Address">
                                    <i class="fas fa-copy text-xs"></i>
                                </button>
                                <button onclick="addToWatchlist('${token.symbol}')" class="p-2 bg-purple-600 hover:bg-purple-700 rounded-lg transition" title="Watch Token">
                                    <i class="fas fa-eye text-xs"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // ‚úÖ UPDATE ACTIVITY FEED
        function updateActivityFeed() {
            const feed = document.getElementById('activity-feed');
            feed.innerHTML = '';
            
            state.freshTokens.slice(0, 8).forEach(token => {
                const riskIcon = token.riskLevel === 'HIGH' ? 'üî¥' : token.riskLevel === 'MEDIUM' ? 'üü°' : 'üü¢';
                const age = formatAge(token.createdAt);
                
                const activityItem = document.createElement('div');
                activityItem.className = 'text-sm p-2 rounded-lg bg-slate-800/30 animate-fade-in cursor-pointer hover:bg-slate-700/30';
                activityItem.innerHTML = `
                    <div class="flex items-start gap-2">
                        <span class="text-lg">${token.tags.includes('MEME') ? 'üé≠' : 'üìà'}</span>
                        <div class="flex-1">
                            <div class="font-medium">${token.symbol}</div>
                            <div class="text-gray-400 text-xs">${age} ‚Ä¢ ${formatAmount(token.liquidity.usd)} LQ</div>
                            <div class="flex gap-1 mt-1">
                                <span class="text-xs ${token.priceChange.h1 >= 0 ? 'text-green-400' : 'text-red-400'}">
                                    ${token.priceChange.h1 >= 0 ? '+' : ''}${token.priceChange.h1.toFixed(1)}%
                                </span>
                                <span class="text-xs text-gray-400">‚Ä¢</span>
                                <span class="text-xs text-gray-400">${formatAmount(token.volume.h24)} vol</span>
                                <span class="text-xs text-gray-400">‚Ä¢</span>
                                <span class="text-xs">${riskIcon}</span>
                            </div>
                        </div>
                        <div class="text-gray-500 text-xs">${age}</div>
                    </div>
                `;
                
                activityItem.addEventListener('click', () => {
                    if (token.url) window.open(token.url, '_blank');
                });
                
                feed.prepend(activityItem);
            });
        }

        // ‚úÖ UTILITY FUNCTIONS
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showApiStatus('‚úì Copied to clipboard!', 'success');
            });
        }

        function addToWatchlist(symbol) {
            showApiStatus(`‚úì ${symbol} added to watchlist!`, 'success');
        }

        function updateStats() {
            document.getElementById('stat-fresh').textContent = state.freshTokens.length;
            document.getElementById('stat-pools').textContent = state.pools.length;
            document.getElementById('stat-wallets').textContent = state.watchedWallets.size;
            
            const totalVolume = state.freshTokens.reduce((sum, token) => sum + (token.volume?.h24 || 0), 0);
            document.getElementById('stat-volume').textContent = formatAmount(totalVolume);
        }

        // ‚úÖ INITIALIZE APP
        function initApp() {
            document.getElementById('btn-fresh').addEventListener('click', fetchFreshLaunches);
            document.getElementById('btn-apply-filters').addEventListener('click', updateFreshTokensTable);
            
            document.getElementById('chain-select').addEventListener('change', (e) => {
                state.activeChain = e.target.value;
                showApiStatus(`üîÑ Switched to ${CHAIN_CONFIG[state.activeChain].name}`, 'info');
            });
            
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const tab = btn.getAttribute('data-tab');
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('tab-active'));
                    document.querySelectorAll('.tab-content').forEach(content => content.classList.add('hidden'));
                    btn.classList.add('tab-active');
                    document.getElementById(`${tab}-tab`).classList.remove('hidden');
                });
            });
            
            // Auto-refresh every 60 seconds
            setInterval(() => {
                if (!state.isScanningFresh && state.freshTokens.length > 0) {
                    fetchFreshLaunches();
                }
            }, 60000);
            
            showApiStatus('üöÄ Ready! Powered by Vercel APIs - Click "Scan Fresh Launches"!', 'success');
        }

        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
