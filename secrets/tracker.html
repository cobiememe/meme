<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhaleTracker Pro - Real-time Crypto Whale Analytics</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in { animation: fadeIn 0.5s ease-out; }
        .glass-card { 
            background: rgba(15, 23, 42, 0.7); 
            border: 1px solid rgba(124, 58, 237, 0.1); 
            backdrop-filter: blur(10px);
        }
        .tab-active { 
            border-bottom: 2px solid #8b5cf6;
            color: #8b5cf6;
        }
        .sparkline {
            width: 60px;
            height: 20px;
        }
        tr:hover { 
            background-color: rgba(139, 92, 246, 0.1) !important; 
            transform: scale(1.01);
            transition: all 0.15s ease;
        }
        .tab-content {
            transition: opacity 0.3s ease;
        }
        .tab-content.hidden { 
            opacity: 0; 
            pointer-events: none;
            position: absolute;
        }
        .tab-content:not(.hidden) {
            opacity: 1;
            position: relative;
        }
        .pulse-ring {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(0.95); opacity: 1; }
            50% { transform: scale(1); opacity: 0.7; }
            100% { transform: scale(0.95); opacity: 1; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-indigo-950 to-slate-900 text-white min-h-screen">
    <div id="app" class="p-4">
        <!-- Header -->
        <header class="max-w-7xl mx-auto mb-8">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="relative">
                        <div class="w-12 h-12 bg-gradient-to-r from-purple-500 to-blue-500 rounded-xl flex items-center justify-center text-white font-bold text-lg pulse-ring">
                            üêã
                        </div>
                        <div class="absolute -top-1 -right-1 w-4 h-4 bg-green-400 rounded-full border-2 border-slate-900"></div>
                    </div>
                    <div>
                        <h1 class="text-3xl font-bold bg-gradient-to-r from-purple-400 to-blue-400 bg-clip-text text-transparent">
                            WhaleTracker Pro
                        </h1>
                        <p class="text-gray-400 mt-1">Track real-time whale activity across multiple chains</p>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <button id="theme-toggle" class="p-2 rounded-lg bg-slate-800 hover:bg-slate-700 transition">
                        <i class="fas fa-moon"></i>
                    </button>
                    <button class="px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg transition flex items-center gap-2">
                        <i class="fas fa-bolt"></i>
                        <span>Live</span>
                        <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                    </button>
                </div>
            </div>
        </header>

        <div class="max-w-7xl mx-auto flex gap-6">
            <!-- Main Content -->
            <div class="flex-1">
                <!-- Tabs Navigation -->
                <div class="mb-6">
                    <div class="flex border-b border-slate-700 gap-6">
                        <button class="tab-btn py-3 px-1 font-medium text-gray-400 hover:text-white transition tab-active" data-tab="overview">
                            <i class="fas fa-chart-line mr-2"></i>Overview
                        </button>
                        <button class="tab-btn py-3 px-1 font-medium text-gray-400 hover:text-white transition" data-tab="wallet">
                            <i class="fas fa-wallet mr-2"></i>Wallet Tracker
                        </button>
                        <button class="tab-btn py-3 px-1 font-medium text-gray-400 hover:text-white transition" data-tab="memes">
                            <i class="fas fa-rocket mr-2"></i>Meme Coins
                        </button>
                        <button class="tab-btn py-3 px-1 font-medium text-gray-400 hover:text-white transition" data-tab="alerts">
                            <i class="fas fa-bell mr-2"></i>Alerts
                        </button>
                    </div>
                </div>

                <!-- API Status -->
                <div id="api-status" class="mb-6">
                    <div class="bg-yellow-900/20 border border-yellow-500/30 rounded-lg p-3">
                        <p class="text-yellow-400 text-sm flex items-center">
                            <i class="fas fa-info-circle mr-2"></i>
                            <span id="status-message">Ready to track whale activity. Select chain and click Scan.</span>
                        </p>
                    </div>
                </div>

                <!-- Control Panel -->
                <div class="glass-card rounded-xl p-6 mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-2 text-gray-300">
                                <i class="fas fa-link mr-2"></i>Blockchain
                            </label>
                            <select id="chain-select" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-white text-sm">
                                <option value="ethereum">Ethereum</option>
                                <option value="solana">Solana</option>
                                <option value="bsc">BSC</option>
                                <option value="arbitrum">Arbitrum</option>
                                <option value="base">Base</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2 text-gray-300">
                                <i class="fas fa-filter mr-2"></i>Min Volume
                            </label>
                            <select id="min-amount" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-white text-sm">
                                <option value="100000">$100K+</option>
                                <option value="500000">$500K+</option>
                                <option value="1000000" selected>$1M+</option>
                                <option value="2000000">$2M+</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2 text-gray-300">
                                <i class="fas fa-exchange-alt mr-2"></i>Trade Type
                            </label>
                            <select id="trade-filter" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-white text-sm">
                                <option value="all">All Trades</option>
                                <option value="buy">Buys Only</option>
                                <option value="sell">Sells Only</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2 text-gray-300">
                                <i class="fas fa-search mr-2"></i>Search Token
                            </label>
                            <input 
                                id="token-search" 
                                type="text" 
                                placeholder="PEPE, BONK, WETH..." 
                                class="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-white text-sm placeholder-gray-500"
                            >
                        </div>
                        <div class="flex items-end gap-2">
                            <button id="btn-scan" class="flex-1 bg-purple-600 hover:bg-purple-700 py-2 px-4 rounded-lg font-medium transition flex items-center justify-center gap-2">
                                <i id="scan-icon" class="fas fa-search"></i>
                                Scan
                            </button>
                            <button id="btn-export" class="flex-1 bg-green-600 hover:bg-green-700 py-2 px-4 rounded-lg font-medium transition flex items-center justify-center gap-2">
                                <i class="fas fa-download"></i>
                                Export
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="glass-card rounded-xl p-4 animate-fade-in hover:transform hover:scale-105 transition-all duration-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400 text-sm">Total Pools</p>
                                <p id="stat-trades" class="text-2xl font-bold text-purple-400">0</p>
                            </div>
                            <div class="w-10 h-10 bg-purple-500/20 rounded-lg flex items-center justify-center">
                                <i class="fas fa-water text-purple-400"></i>
                            </div>
                        </div>
                    </div>
                    <div class="glass-card rounded-xl p-4 animate-fade-in hover:transform hover:scale-105 transition-all duration-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400 text-sm">24h Volume</p>
                                <p id="stat-volume" class="text-2xl font-bold text-green-400">$0</p>
                            </div>
                            <div class="w-10 h-10 bg-green-500/20 rounded-lg flex items-center justify-center">
                                <i class="fas fa-chart-bar text-green-400"></i>
                            </div>
                        </div>
                    </div>
                    <div class="glass-card rounded-xl p-4 animate-fade-in hover:transform hover:scale-105 transition-all duration-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400 text-sm">Whale Addresses</p>
                                <p id="stat-whales" class="text-2xl font-bold text-blue-400">0</p>
                            </div>
                            <div class="w-10 h-10 bg-blue-500/20 rounded-lg flex items-center justify-center">
                                <i class="fas fa-fish text-blue-400"></i>
                            </div>
                        </div>
                    </div>
                    <div class="glass-card rounded-xl p-4 animate-fade-in hover:transform hover:scale-105 transition-all duration-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400 text-sm">Active Chains</p>
                                <p class="text-2xl font-bold text-orange-400">5</p>
                            </div>
                            <div class="w-10 h-10 bg-orange-500/20 rounded-lg flex items-center justify-center">
                                <i class="fas fa-link text-orange-400"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab Content -->
                <div class="relative">
                    <!-- Overview Tab -->
                    <div id="overview-tab" class="tab-content">
                        <div class="glass-card rounded-xl border border-slate-700/50 overflow-hidden">
                            <div class="p-4 border-b border-slate-700/50 flex items-center justify-between">
                                <h2 class="text-lg font-semibold flex items-center gap-2">
                                    <i class="fas fa-list"></i>
                                    Whale Pools
                                </h2>
                                <div class="text-sm text-gray-400">
                                    <span id="pools-count">0</span> pools found
                                </div>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-slate-800/50">
                                        <tr>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Pool</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Volume 24h</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Price</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">DEX</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Risk</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="pools-tbody" class="divide-y divide-slate-700/50">
                                        <tr>
                                            <td colspan="6" class="px-4 py-8 text-center text-gray-400">
                                                <i class="fas fa-search mb-2 text-2xl"></i>
                                                <p>Click "Scan" to find whale pools</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Wallet Tracker Tab -->
                    <div id="wallet-tab" class="tab-content hidden">
                        <div class="glass-card rounded-xl p-6 text-center">
                            <i class="fas fa-wallet text-4xl text-gray-600 mb-4"></i>
                            <h3 class="text-lg font-semibold mb-2">Wallet Tracking</h3>
                            <p class="text-gray-400 mb-4">Track individual whale wallets and their transactions</p>
                            <div class="max-w-md mx-auto">
                                <div class="flex gap-2">
                                    <input 
                                        type="text" 
                                        placeholder="Enter wallet address (0x...)" 
                                        class="flex-1 bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-white text-sm"
                                    >
                                    <button class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg transition">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Meme Coins Tab -->
                    <div id="memes-tab" class="tab-content hidden">
                        <div class="glass-card rounded-xl border border-orange-500/20 overflow-hidden">
                            <div class="p-4 border-b border-slate-700/50 flex items-center justify-between">
                                <h2 class="text-lg font-semibold flex items-center gap-2">
                                    <i class="fas fa-rocket text-orange-400"></i>
                                    Trending Meme Coins
                                </h2>
                                <button id="btn-scan-memes" class="bg-orange-600 hover:bg-orange-700 px-4 py-2 rounded-lg transition flex items-center gap-2">
                                    <i id="meme-scan-icon" class="fas fa-search"></i>
                                    Scan Memes
                                </button>
                            </div>
                            <div class="p-4">
                                <div id="memes-tbody">
                                    <div class="text-center py-8 text-gray-400">
                                        <i class="fas fa-rocket text-2xl mb-2"></i>
                                        <p>Click "Scan Memes" to discover trending tokens</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Alerts Tab -->
                    <div id="alerts-tab" class="tab-content hidden">
                        <div class="glass-card rounded-xl p-6 text-center">
                            <i class="fas fa-bell text-4xl text-gray-600 mb-4"></i>
                            <h3 class="text-lg font-semibold mb-2">Whale Alerts</h3>
                            <p class="text-gray-400 mb-4">Set up notifications for large trades</p>
                            <button class="bg-purple-600 hover:bg-purple-700 px-6 py-2 rounded-lg transition">
                                Enable Notifications
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Live Activity Feed (Fixed Sidebar) -->
            <div class="hidden lg:block w-80">
                <div class="sticky top-28 glass-card rounded-xl p-4 border border-slate-700/50">
                    <div class="flex items-center gap-2 mb-4">
                        <i class="fas fa-bolt text-yellow-400"></i>
                        <span class="font-semibold">Live Whale Activity</span>
                        <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse ml-auto"></div>
                    </div>
                    <div id="activity-feed" class="space-y-3 max-h-[600px] overflow-y-auto">
                        <!-- Activity items will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Korrekte DexScreener API gem√§√ü Dokumentation
        const DEXSCREENER_API = 'https://api.dexscreener.com/latest/dex';
        
        const CHAIN_CONFIG = {
            ethereum: { name: 'Ethereum', popularTokens: ['WETH', 'USDC', 'PEPE', 'SHIB'] },
            solana: { name: 'Solana', popularTokens: ['SOL', 'BONK', 'WIF'] },
            bsc: { name: 'BSC', popularTokens: ['WBNB', 'CAKE', 'FLOKI'] },
            arbitrum: { name: 'Arbitrum', popularTokens: ['ETH', 'ARB'] },
            base: { name: 'Base', popularTokens: ['ETH', 'DEGEN'] }
        };

        let state = {
            activeChain: 'ethereum',
            minAmount: 1000000,
            filter: 'all',
            pools: [],
            isScanning: false,
            isScanningMemes: false,
            theme: 'dark'
        };

        // Load saved filters from localStorage
        function loadSavedFilters() {
            const savedChain = localStorage.getItem('whaleTracker-chain');
            const savedMinAmount = localStorage.getItem('whaleTracker-minAmount');
            const savedFilter = localStorage.getItem('whaleTracker-filter');
            
            if (savedChain) {
                state.activeChain = savedChain;
                document.getElementById('chain-select').value = savedChain;
            }
            if (savedMinAmount) {
                state.minAmount = parseInt(savedMinAmount);
                document.getElementById('min-amount').value = savedMinAmount;
            }
            if (savedFilter) {
                state.filter = savedFilter;
                document.getElementById('trade-filter').value = savedFilter;
            }
        }

        // Save filters to localStorage
        function saveFilters() {
            localStorage.setItem('whaleTracker-chain', state.activeChain);
            localStorage.setItem('whaleTracker-minAmount', state.minAmount.toString());
            localStorage.setItem('whaleTracker-filter', state.filter);
        }

        // Utility Functions
        function formatAmount(amount) {
            if (amount >= 1000000) {
                return '$' + (amount / 1000000).toFixed(1) + 'M';
            } else if (amount >= 1000) {
                return '$' + (amount / 1000).toFixed(1) + 'K';
            }
            return '$' + amount.toString();
        }

        function shortenAddress(address) {
            if (!address || address === 'N/A') return 'N/A';
            return `${address.slice(0, 6)}...${address.slice(-4)}`;
        }

        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('api-status');
            const messageEl = document.getElementById('status-message');
            
            statusDiv.className = `mb-6 rounded-lg p-3 ${
                type === 'error' ? 'bg-red-900/20 border-red-500/30' :
                type === 'success' ? 'bg-green-900/20 border-green-500/30' :
                'bg-yellow-900/20 border-yellow-500/30'
            }`;
            
            messageEl.className = `text-sm flex items-center ${
                type === 'error' ? 'text-red-400' :
                type === 'success' ? 'text-green-400' :
                'text-yellow-400'
            }`;
            
            messageEl.innerHTML = `<i class="fas fa-${type === 'error' ? 'exclamation-triangle' : type === 'success' ? 'check-circle' : 'info-circle'} mr-2"></i>${message}`;
        }

        // Generate sparkline data
        function generateSparkline(canvas, isPositive) {
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.clearRect(0, 0, width, height);
            ctx.strokeStyle = isPositive ? '#22c55e' : '#ef4444';
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            const points = 8;
            const baseLine = height * 0.7;
            const amplitude = height * 0.3;
            
            for (let i = 0; i < points; i++) {
                const x = (i / (points - 1)) * width;
                const variation = Math.sin((i / points) * Math.PI) * amplitude;
                const y = isPositive ? baseLine - variation : baseLine + variation * 0.5;
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            
            ctx.stroke();
        }

        // Korrekte API Calls
        async function fetchPools() {
            if (state.isScanning) return;
            
            state.isScanning = true;
            const scanIcon = document.getElementById('scan-icon');
            scanIcon.className = 'fas fa-spinner fa-spin';
            document.getElementById('btn-scan').disabled = true;
            
            showStatus(`üîç Scanning ${CHAIN_CONFIG[state.activeChain].name} for whale pools...`, 'info');
            
            try {
                const searchQuery = document.getElementById('token-search').value.trim();
                let url;
                
                if (searchQuery) {
                    // Search for specific token
                    url = `${DEXSCREENER_API}/search/?q=${encodeURIComponent(searchQuery)}`;
                } else {
                    // Use popular tokens for the chain
                    const popularTokens = CHAIN_CONFIG[state.activeChain].popularTokens;
                    const randomToken = popularTokens[Math.floor(Math.random() * popularTokens.length)];
                    url = `${DEXSCREENER_API}/search/?q=${randomToken}`;
                }
                
                console.log('Fetching from:', url);
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`API request failed: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('API Response:', data);
                
                if (!data.pairs || data.pairs.length === 0) {
                    throw new Error('No trading pairs found for this search');
                }
                
                // Filter and process pools
                const filteredPools = data.pairs
                    .filter(pair => {
                        const volume = parseFloat(pair.volume?.h24 || 0);
                        const isRightChain = pair.chainId === state.activeChain;
                        return volume >= state.minAmount && isRightChain;
                    })
                    .sort((a, b) => parseFloat(b.volume?.h24 || 0) - parseFloat(a.volume?.h24 || 0))
                    .slice(0, 25);
                
                state.pools = filteredPools.map(pair => ({
                    pairAddress: pair.pairAddress,
                    baseToken: pair.baseToken,
                    quoteToken: pair.quoteToken,
                    priceUsd: parseFloat(pair.priceUsd || 0),
                    priceChange: parseFloat(pair.priceChange?.h24 || 0),
                    volume24h: parseFloat(pair.volume?.h24 || 0),
                    liquidity: parseFloat(pair.liquidity?.usd || 0),
                    dex: pair.dexId,
                    url: pair.url,
                    chainId: pair.chainId
                }));
                
                renderPools();
                updateStats();
                generateActivityFeed();
                
                showStatus(`‚úÖ Found ${state.pools.length} whale pools on ${CHAIN_CONFIG[state.activeChain].name}`, 'success');
                
            } catch (error) {
                console.error('Scan error:', error);
                showStatus(`‚ùå ${error.message}`, 'error');
            } finally {
                state.isScanning = false;
                scanIcon.className = 'fas fa-search';
                document.getElementById('btn-scan').disabled = false;
                saveFilters();
            }
        }

        async function scanMemeCoins() {
            if (state.isScanningMemes) return;
            
            state.isScanningMemes = true;
            const scanIcon = document.getElementById('meme-scan-icon');
            scanIcon.className = 'fas fa-spinner fa-spin';
            document.getElementById('btn-scan-memes').disabled = true;
            
            showStatus('üîç Scanning for trending meme coins...', 'info');
            
            try {
                // Search for popular meme coins
                const memeTokens = ['PEPE', 'BONK', 'FLOKI', 'SHIB', 'DOGE', 'WIF'];
                let allPairs = [];
                
                for (const token of memeTokens) {
                    try {
                        const response = await fetch(`${DEXSCREENER_API}/search/?q=${token}`);
                        if (response.ok) {
                            const data = await response.json();
                            if (data.pairs) {
                                allPairs.push(...data.pairs);
                            }
                        }
                        await new Promise(resolve => setTimeout(resolve, 100)); // Rate limiting
                    } catch (err) {
                        console.log(`Error fetching ${token}:`, err);
                    }
                }
                
                // Filter for high volume and price change
                const memeCoins = allPairs
                    .filter(pair => {
                        const volume = parseFloat(pair.volume?.h24 || 0);
                        const priceChange = parseFloat(pair.priceChange?.h24 || 0);
                        return volume >= 50000 && Math.abs(priceChange) > 5;
                    })
                    .sort((a, b) => parseFloat(b.volume?.h24 || 0) - parseFloat(a.volume?.h24 || 0))
                    .slice(0, 15)
                    .map(pair => ({
                        symbol: pair.baseToken?.symbol,
                        name: pair.baseToken?.name,
                        price: parseFloat(pair.priceUsd || 0),
                        priceChange: parseFloat(pair.priceChange?.h24 || 0),
                        volume: parseFloat(pair.volume?.h24 || 0),
                        liquidity: parseFloat(pair.liquidity?.usd || 0),
                        dex: pair.dexId,
                        url: pair.url
                    }));
                
                renderMemeCoins(memeCoins);
                showStatus(`‚úÖ Found ${memeCoins.length} trending meme coins`, 'success');
                
            } catch (error) {
                console.error('Meme scan error:', error);
                showStatus(`‚ùå ${error.message}`, 'error');
            } finally {
                state.isScanningMemes = false;
                scanIcon.className = 'fas fa-search';
                document.getElementById('btn-scan-memes').disabled = false;
            }
        }

        function renderPools() {
            const tbody = document.getElementById('pools-tbody');
            const countEl = document.getElementById('pools-count');
            
            if (state.pools.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-4 py-8 text-center text-gray-400">
                            <i class="fas fa-search mb-2 text-2xl"></i>
                            <p>No pools found. Try adjusting filters or search term.</p>
                        </td>
                    </tr>
                `;
                countEl.textContent = '0';
                return;
            }
            
            countEl.textContent = state.pools.length;
            
            tbody.innerHTML = state.pools.map(pool => {
                const isPriceUp = pool.priceChange >= 0;
                const riskLevel = pool.liquidity > 0 && pool.volume24h / pool.liquidity > 10 ? 'HIGH' : 
                                pool.liquidity > 0 && pool.volume24h / pool.liquidity > 5 ? 'MEDIUM' : 'LOW';
                const riskColor = riskLevel === 'HIGH' ? 'text-red-400' : 
                                riskLevel === 'MEDIUM' ? 'text-yellow-400' : 'text-green-400';
                
                return `
                    <tr class="transition-all duration-150 cursor-pointer">
                        <td class="px-4 py-3">
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 bg-gradient-to-r from-purple-500 to-blue-500 rounded-lg flex items-center justify-center text-xs font-bold">
                                    ${pool.baseToken?.symbol?.substring(0, 2) || '??'}
                                </div>
                                <div>
                                    <div class="font-medium">${pool.baseToken?.symbol || 'Unknown'}</div>
                                    <div class="text-xs text-gray-400">${shortenAddress(pool.pairAddress)}</div>
                                </div>
                            </div>
                        </td>
                        <td class="px-4 py-3">
                            <div class="font-semibold text-green-400">${formatAmount(pool.volume24h)}</div>
                        </td>
                        <td class="px-4 py-3">
                            <div class="flex items-center gap-2">
                                <div>
                                    <div class="font-mono text-sm">$${pool.priceUsd < 0.001 ? pool.priceUsd.toExponential(2) : pool.priceUsd.toFixed(6)}</div>
                                    <div class="text-xs ${isPriceUp ? 'text-green-400' : 'text-red-400'}">
                                        ${isPriceUp ? '+' : ''}${pool.priceChange.toFixed(1)}%
                                    </div>
                                </div>
                                <canvas class="sparkline" width="60" height="20"></canvas>
                            </div>
                        </td>
                        <td class="px-4 py-3">
                            <span class="text-xs bg-slate-700 px-2 py-1 rounded">${pool.dex}</span>
                        </td>
                        <td class="px-4 py-3">
                            <span class="text-xs ${riskColor} font-semibold">${riskLevel}</span>
                        </td>
                        <td class="px-4 py-3">
                            <a href="${pool.url}" target="_blank" class="text-purple-400 hover:text-purple-300 text-sm">
                                <i class="fas fa-external-link-alt"></i>
                            </a>
                        </td>
                    </tr>
                `;
            }).join('');
            
            // Generate sparklines after DOM update
            setTimeout(() => {
                document.querySelectorAll('.sparkline').forEach((canvas, index) => {
                    if (state.pools[index]) {
                        generateSparkline(canvas, state.pools[index].priceChange >= 0);
                    }
                });
            }, 100);
        }

        function renderMemeCoins(memeCoins) {
            const container = document.getElementById('memes-tbody');
            
            if (!memeCoins || memeCoins.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-400">
                        <i class="fas fa-search mb-2 text-2xl"></i>
                        <p>No meme coins found. Try again later.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = memeCoins.map(coin => {
                const isPriceUp = coin.priceChange >= 0;
                
                return `
                    <div class="flex items-center justify-between p-3 hover:bg-slate-800/30 rounded-lg transition-colors mb-2">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-gradient-to-r from-orange-500 to-pink-500 rounded-lg flex items-center justify-center font-bold">
                                ${coin.symbol?.substring(0, 2) || '??'}
                            </div>
                            <div>
                                <div class="font-semibold">${coin.symbol}</div>
                                <div class="text-xs text-gray-400">${coin.name}</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="font-mono text-sm">$${coin.price < 0.001 ? coin.price.toExponential(2) : coin.price.toFixed(8)}</div>
                            <div class="text-xs ${isPriceUp ? 'text-green-400' : 'text-red-400'}">
                                ${isPriceUp ? '+' : ''}${coin.priceChange.toFixed(1)}%
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-sm font-semibold">${formatAmount(coin.volume)}</div>
                            <div class="text-xs text-gray-400">${coin.dex}</div>
                        </div>
                        <a href="${coin.url}" target="_blank" class="text-orange-400 hover:text-orange-300">
                            <i class="fas fa-chart-line"></i>
                        </a>
                    </div>
                `;
            }).join('');
        }

        function generateActivityFeed() {
            const feed = document.getElementById('activity-feed');
            if (!feed) return;
            
            const activities = state.pools.slice(0, 8).map(pool => {
                const isBuy = pool.priceChange >= 0;
                const amount = pool.volume24h * 0.1 + Math.random() * pool.volume24h * 0.9;
                const timeAgo = Math.floor(Math.random() * 60) + 1;
                
                return `
                    <div class="text-sm p-2 rounded-lg bg-slate-800/30 hover:bg-slate-700/30 transition-colors">
                        <div class="flex items-start gap-2">
                            <span class="text-lg">${isBuy ? 'üêã' : 'üìâ'}</span>
                            <div class="flex-1">
                                <div class="font-medium ${isBuy ? 'text-green-400' : 'text-red-400'}">
                                    ${isBuy ? 'Buy' : 'Sell'} ${formatAmount(amount)}
                                </div>
                                <div class="text-gray-400 text-xs">${pool.baseToken?.symbol} ‚Ä¢ ${pool.dex}</div>
                            </div>
                            <div class="text-gray-500 text-xs">${timeAgo}m ago</div>
                        </div>
                    </div>
                `;
            }).join('');
            
            feed.innerHTML = activities;
        }

        function updateStats() {
            const totalPools = state.pools.length;
            const totalVolume = state.pools.reduce((sum, pool) => sum + pool.volume24h, 0);
            const uniqueTokens = new Set(state.pools.map(pool => pool.baseToken?.address)).size;
            
            document.getElementById('stat-trades').textContent = totalPools;
            document.getElementById('stat-volume').textContent = formatAmount(totalVolume);
            document.getElementById('stat-whales').textContent = uniqueTokens;
        }

        // Theme Toggle
        function toggleTheme() {
            state.theme = state.theme === 'dark' ? 'light' : 'dark';
            document.documentElement.classList.toggle('light');
            localStorage.setItem('whaleTracker-theme', state.theme);
            updateThemeIcon();
        }

        function updateThemeIcon() {
            const icon = document.querySelector('#theme-toggle i');
            icon.className = state.theme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
        }

        // Tab Navigation
        function setupTabs() {
            const tabBtns = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const tabId = btn.getAttribute('data-tab');
                    
                    // Update active tab
                    tabBtns.forEach(b => b.classList.remove('tab-active'));
                    btn.classList.add('tab-active');
                    
                    // Show active content with fade transition
                    tabContents.forEach(content => {
                        content.classList.add('hidden');
                        setTimeout(() => {
                            if (content.id === `${tabId}-tab`) {
                                content.classList.remove('hidden');
                            }
                        }, 50);
                    });
                });
            });
        }

        // Auto-refresh
        function startAutoRefresh() {
            setInterval(() => {
                if (state.pools.length > 0 && !state.isScanning) {
                    fetchPools();
                }
            }, 30000); // Refresh every 30 seconds
        }

        // Event Listeners
        document.getElementById('btn-scan').addEventListener('click', fetchPools);
        document.getElementById('btn-scan-memes').addEventListener('click', scanMemeCoins);
        document.getElementById('token-search').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                fetchPools();
            }
        });

        document.getElementById('chain-select').addEventListener('change', (e) => {
            state.activeChain = e.target.value;
            showStatus(`Switched to ${CHAIN_CONFIG[state.activeChain].name}`, 'info');
            saveFilters();
        });

        document.getElementById('min-amount').addEventListener('change', (e) => {
            state.minAmount = parseInt(e.target.value);
            saveFilters();
        });

        document.getElementById('trade-filter').addEventListener('change', (e) => {
            state.filter = e.target.value;
            saveFilters();
        });

        document.getElementById('theme-toggle').addEventListener('click', toggleTheme);

        // Initialize
        function init() {
            loadSavedFilters();
            setupTabs();
            updateThemeIcon();
            startAutoRefresh();
            showStatus('Ready to track whale activity. Select chain and click Scan.', 'info');
            
            // Generate initial activity feed
            generateActivityFeed();
        }

        init();
    </script>
</body>
</html>
