<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhaleTracker Pro v2 - Live Meme Coin Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-fade-in { animation: fadeIn 0.5s ease-out; }
        .animate-spin { animation: spin 1s linear infinite; }
        .glass-card { 
            background: rgba(15, 23, 42, 0.7); 
            border: 1px solid rgba(124, 58, 237, 0.1); 
            backdrop-filter: blur(10px);
        }
        .tab-active { 
            border-bottom: 2px solid #8b5cf6;
            color: #8b5cf6;
        }
        tr:hover { 
            background-color: rgba(139, 92, 246, 0.1) !important; 
            transform: scale(1.01);
            transition: all 0.15s ease;
        }
        .tab-content {
            transition: opacity 0.3s ease;
        }
        .tab-content.hidden { 
            opacity: 0; 
            pointer-events: none;
            position: absolute;
        }
        .tab-content:not(.hidden) {
            opacity: 1;
            position: relative;
        }
        .pulse-ring {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(0.95); opacity: 1; }
            50% { transform: scale(1); opacity: 0.7; }
            100% { transform: scale(0.95); opacity: 1; }
        }
        .risk-badge {
            display: inline-flex;
            align-items: center;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }
        .risk-low { background: rgba(34, 197, 94, 0.2); color: #22c55e; }
        .risk-medium { background: rgba(251, 191, 36, 0.2); color: #fbbf24; }
        .risk-high { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
        
        .new-token-notification {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-indigo-950 to-slate-900 text-white min-h-screen">
    <div id="app" class="p-4">
        <!-- Header -->
        <header class="max-w-7xl mx-auto mb-8">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="relative">
                        <div class="w-12 h-12 bg-gradient-to-r from-purple-500 to-blue-500 rounded-xl flex items-center justify-center text-white font-bold text-lg pulse-ring">
                            üêã
                        </div>
                        <div id="live-indicator" class="absolute -top-1 -right-1 w-4 h-4 bg-gray-400 rounded-full border-2 border-slate-900"></div>
                    </div>
                    <div>
                        <h1 class="text-3xl font-bold bg-gradient-to-r from-purple-400 to-blue-400 bg-clip-text text-transparent">
                            WhaleTracker Pro v2
                        </h1>
                        <p class="text-gray-400 mt-1">üî• LIVE Pump.fun + Dexscreener Integration</p>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <button id="toggle-pumpfun" class="px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg transition flex items-center gap-2">
                        <i class="fas fa-power-off"></i>
                        <span id="pumpfun-status">Start Pump.fun Live</span>
                    </button>
                </div>
            </div>
        </header>

        <div class="max-w-7xl mx-auto flex gap-6">
            <!-- Main Content -->
            <div class="flex-1">
                <!-- Tabs Navigation -->
                <div class="mb-6">
                    <div class="flex border-b border-slate-700 gap-6">
                        <button class="tab-btn py-3 px-1 font-medium text-gray-400 hover:text-white transition tab-active" data-tab="memes">
                            <i class="fas fa-rocket mr-2"></i>üî• Live Meme Launches
                        </button>
                        <button class="tab-btn py-3 px-1 font-medium text-gray-400 hover:text-white transition" data-tab="pools">
                            <i class="fas fa-water mr-2"></i>Hot Pools (Dexscreener)
                        </button>
                    </div>
                </div>

                <!-- API Status -->
                <div id="api-status" class="mb-6">
                    <div class="bg-yellow-900/20 border border-yellow-500/30 rounded-lg p-3">
                        <p class="text-yellow-400 text-sm flex items-center">
                            <i class="fas fa-info-circle mr-2"></i>
                            <span id="status-message">üëã Ready! Click "Start Pump.fun Live" to see new token launches!</span>
                        </p>
                    </div>
                </div>

                <!-- Control Panel -->
                <div class="glass-card rounded-xl p-6 mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-2 text-gray-300">
                                <i class="fas fa-filter mr-2"></i>Min Liquidity (Pump.fun)
                            </label>
                            <select id="min-liquidity" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-white text-sm">
                                <option value="1000">$1K+</option>
                                <option value="2000" selected>$2K+</option>
                                <option value="5000">$5K+</option>
                                <option value="10000">$10K+</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2 text-gray-300">
                                <i class="fas fa-clock mr-2"></i>Max Token Age
                            </label>
                            <select id="max-age" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-white text-sm">
                                <option value="5">5 min</option>
                                <option value="15">15 min</option>
                                <option value="30" selected>30 min</option>
                                <option value="60">1 hour</option>
                            </select>
                        </div>
                        <div class="flex items-end">
                            <button id="btn-scan-pools" class="w-full bg-purple-600 hover:bg-purple-700 py-2 px-4 rounded-lg font-medium transition flex items-center justify-center gap-2">
                                <i id="scan-icon" class="fas fa-search"></i>
                                Scan Dexscreener
                            </button>
                        </div>
                        <div class="flex items-end">
                            <button id="btn-clear" class="w-full bg-red-600 hover:bg-red-700 py-2 px-4 rounded-lg font-medium transition flex items-center justify-center gap-2">
                                <i class="fas fa-trash"></i>
                                Clear All
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="glass-card rounded-xl p-4 animate-fade-in">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400 text-sm">üöÄ New Launches</p>
                                <p id="stat-memes" class="text-2xl font-bold text-pink-400">0</p>
                            </div>
                            <div class="w-10 h-10 bg-pink-500/20 rounded-lg flex items-center justify-center">
                                <i class="fas fa-rocket text-pink-400"></i>
                            </div>
                        </div>
                    </div>
                    <div class="glass-card rounded-xl p-4 animate-fade-in">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400 text-sm">üí∞ Total Volume</p>
                                <p id="stat-volume" class="text-2xl font-bold text-green-400">$0</p>
                            </div>
                            <div class="w-10 h-10 bg-green-500/20 rounded-lg flex items-center justify-center">
                                <i class="fas fa-chart-line text-green-400"></i>
                            </div>
                        </div>
                    </div>
                    <div class="glass-card rounded-xl p-4 animate-fade-in">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400 text-sm">‚ö° Live Updates</p>
                                <p id="stat-updates" class="text-2xl font-bold text-blue-400">0</p>
                            </div>
                            <div class="w-10 h-10 bg-blue-500/20 rounded-lg flex items-center justify-center">
                                <i class="fas fa-sync text-blue-400"></i>
                            </div>
                        </div>
                    </div>
                    <div class="glass-card rounded-xl p-4 animate-fade-in">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400 text-sm">üî• Hot Pools</p>
                                <p id="stat-pools" class="text-2xl font-bold text-purple-400">0</p>
                            </div>
                            <div class="w-10 h-10 bg-purple-500/20 rounded-lg flex items-center justify-center">
                                <i class="fas fa-fire text-purple-400"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab Content -->
                <div class="relative">
                    <!-- Memes Tab (Pump.fun LIVE) -->
                    <div id="memes-tab" class="tab-content">
                        <div class="glass-card rounded-xl border border-pink-500/20 overflow-hidden">
                            <div class="p-4 border-b border-slate-700/50 flex items-center justify-between">
                                <h2 class="text-lg font-semibold flex items-center gap-2">
                                    <i class="fas fa-rocket text-pink-400"></i>
                                    üî• LIVE New Token Launches (Pump.fun)
                                </h2>
                                <div class="text-sm text-gray-400">
                                    <span id="memes-count">0</span> tokens found
                                </div>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-slate-800/50">
                                        <tr>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Token</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Age</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Market Cap</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Price</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Liquidity</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Risk</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="memes-tbody" class="divide-y divide-slate-700/50">
                                        <tr>
                                            <td colspan="7" class="px-4 py-8 text-center text-gray-400">
                                                <i class="fas fa-rocket mb-2 text-2xl"></i>
                                                <p>Click "Start Pump.fun Live" to see new token launches in real-time! üöÄ</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Pools Tab (Dexscreener) -->
                    <div id="pools-tab" class="tab-content hidden">
                        <div class="glass-card rounded-xl border border-purple-500/20 overflow-hidden">
                            <div class="p-4 border-b border-slate-700/50 flex items-center justify-between">
                                <h2 class="text-lg font-semibold flex items-center gap-2">
                                    <i class="fas fa-water text-purple-400"></i>
                                    Hot Trading Pools (Dexscreener)
                                </h2>
                                <div class="text-sm text-gray-400">
                                    <span id="pools-count">0</span> pools found
                                </div>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-slate-800/50">
                                        <tr>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Token</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Chain</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">24h Volume</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Liquidity</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Price</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">24h %</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">DEX</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="pools-tbody" class="divide-y divide-slate-700/50">
                                        <tr>
                                            <td colspan="8" class="px-4 py-8 text-center text-gray-400">
                                                <i class="fas fa-search mb-2 text-2xl"></i>
                                                <p>Click "Scan Dexscreener" to find hot pools! üî•</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Live Activity Feed -->
            <div class="hidden lg:block w-80">
                <div class="sticky top-4 glass-card rounded-xl p-4 border border-slate-700/50">
                    <div class="flex items-center gap-2 mb-4">
                        <i class="fas fa-bolt text-yellow-400"></i>
                        <span class="font-semibold">Live Activity Feed</span>
                        <div id="activity-indicator" class="w-2 h-2 bg-gray-400 rounded-full ml-auto"></div>
                    </div>
                    <div id="activity-feed" class="space-y-3 max-h-[600px] overflow-y-auto">
                        <div class="text-sm p-3 rounded-lg bg-slate-800/30 text-center text-gray-400">
                            <p>Waiting for live data...</p>
                            <p class="text-xs mt-1">Start Pump.fun to see updates!</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // üî• WHALETRACKER PRO V2 - LIVE EDITION
        // ============================================
        
        const DEXSCREENER_API = 'https://api.dexscreener.com/latest/dex';
        const PUMPFUN_WS = 'wss://pumpportal.fun/api/data';

        // State Management
        let state = {
            pumpfunConnected: false,
            pumpfunSocket: null,
            memes: [],
            pools: [],
            activityFeed: [],
            minLiquidity: 2000,
            maxAge: 30, // minutes
            liveUpdates: 0,
            isScanning: false
        };

        // ============================================
        // HELPER FUNCTIONS
        // ============================================

        function formatAmount(amount) {
            if (!amount || isNaN(amount)) return '$0';
            if (amount >= 1000000000) return '$' + (amount / 1000000000).toFixed(2) + 'B';
            if (amount >= 1000000) return '$' + (amount / 1000000).toFixed(2) + 'M';
            if (amount >= 1000) return '$' + (amount / 1000).toFixed(1) + 'K';
            return '$' + amount.toFixed(2);
        }

        function shortenAddress(address) {
            if (!address) return 'N/A';
            return `${address.slice(0, 6)}...${address.slice(-4)}`;
        }

        function calculateAge(timestamp) {
            const now = Date.now();
            const ageMs = now - timestamp;
            const minutes = Math.floor(ageMs / 60000);
            
            if (minutes < 1) return '<1m';
            if (minutes < 60) return minutes + 'm';
            const hours = Math.floor(minutes / 60);
            if (hours < 24) return hours + 'h';
            return Math.floor(hours / 24) + 'd';
        }

        function calculateRisk(token) {
            let riskScore = 0;
            
            // Check liquidity
            const liquidity = parseFloat(token.liquidity || 0);
            if (liquidity < 1000) riskScore += 3;
            else if (liquidity < 5000) riskScore += 2;
            else if (liquidity < 10000) riskScore += 1;
            
            // Check age
            const ageMinutes = (Date.now() - token.timestamp) / 60000;
            if (ageMinutes < 5) riskScore += 2;
            else if (ageMinutes < 15) riskScore += 1;
            
            // Risk level
            if (riskScore >= 4) return { level: 'high', label: 'üî¥ HIGH RISK', class: 'risk-high' };
            if (riskScore >= 2) return { level: 'medium', label: 'üü° MEDIUM', class: 'risk-medium' };
            return { level: 'low', label: 'üü¢ LOW RISK', class: 'risk-low' };
        }

        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('api-status');
            const messageEl = document.getElementById('status-message');
            
            const colors = {
                error: { bg: 'bg-red-900/20', border: 'border-red-500/30', text: 'text-red-400', icon: 'exclamation-triangle' },
                success: { bg: 'bg-green-900/20', border: 'border-green-500/30', text: 'text-green-400', icon: 'check-circle' },
                info: { bg: 'bg-yellow-900/20', border: 'border-yellow-500/30', text: 'text-yellow-400', icon: 'info-circle' }
            };
            
            const color = colors[type];
            statusDiv.className = `mb-6 rounded-lg p-3 border ${color.bg} ${color.border}`;
            messageEl.className = `text-sm flex items-center ${color.text}`;
            messageEl.innerHTML = `<i class="fas fa-${color.icon} mr-2"></i>${message}`;
        }

        // ============================================
        // PUMP.FUN WEBSOCKET INTEGRATION
        // ============================================

        function connectPumpfun() {
            if (state.pumpfunConnected) {
                disconnectPumpfun();
                return;
            }

            showStatus('üîå Connecting to Pump.fun WebSocket...', 'info');
            
            try {
                state.pumpfunSocket = new WebSocket(PUMPFUN_WS);
                
                state.pumpfunSocket.onopen = () => {
                    console.log('‚úÖ Pump.fun WebSocket connected!');
                    state.pumpfunConnected = true;
                    
                    // Subscribe to new token creations
                    state.pumpfunSocket.send(JSON.stringify({
                        method: "subscribeNewToken"
                    }));
                    
                    updatePumpfunUI(true);
                    showStatus('‚úÖ Connected to Pump.fun! Watching for new token launches...', 'success');
                };
                
                state.pumpfunSocket.onmessage = (event) => {
                    try {
                        const data = JSON.parse(event.data);
                        handlePumpfunMessage(data);
                    } catch (err) {
                        console.error('Error parsing Pump.fun message:', err);
                    }
                };
                
                state.pumpfunSocket.onerror = (error) => {
                    console.error('Pump.fun WebSocket error:', error);
                    showStatus('‚ùå Pump.fun connection error!', 'error');
                };
                
                state.pumpfunSocket.onclose = () => {
                    console.log('Pump.fun WebSocket closed');
                    state.pumpfunConnected = false;
                    updatePumpfunUI(false);
                    showStatus('‚ö†Ô∏è Pump.fun disconnected', 'info');
                };
                
            } catch (err) {
                console.error('Failed to connect to Pump.fun:', err);
                showStatus('‚ùå Failed to connect to Pump.fun!', 'error');
            }
        }

        function disconnectPumpfun() {
            if (state.pumpfunSocket) {
                state.pumpfunSocket.close();
                state.pumpfunSocket = null;
            }
            state.pumpfunConnected = false;
            updatePumpfunUI(false);
            showStatus('‚ö†Ô∏è Pump.fun disconnected', 'info');
        }

        function updatePumpfunUI(connected) {
            const button = document.getElementById('toggle-pumpfun');
            const status = document.getElementById('pumpfun-status');
            const liveIndicator = document.getElementById('live-indicator');
            const activityIndicator = document.getElementById('activity-indicator');
            
            if (connected) {
                button.className = 'px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg transition flex items-center gap-2';
                status.textContent = 'Stop Live Feed';
                liveIndicator.className = 'absolute -top-1 -right-1 w-4 h-4 bg-green-400 rounded-full border-2 border-slate-900 animate-pulse';
                activityIndicator.className = 'w-2 h-2 bg-green-400 rounded-full ml-auto animate-pulse';
            } else {
                button.className = 'px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg transition flex items-center gap-2';
                status.textContent = 'Start Pump.fun Live';
                liveIndicator.className = 'absolute -top-1 -right-1 w-4 h-4 bg-gray-400 rounded-full border-2 border-slate-900';
                activityIndicator.className = 'w-2 h-2 bg-gray-400 rounded-full ml-auto';
            }
        }

        function handlePumpfunMessage(data) {
            // Handle new token creation
            if (data.mint || data.signature) {
                state.liveUpdates++;
                
                const token = {
                    name: data.name || 'Unknown',
                    symbol: data.symbol || 'UNKNOWN',
                    mint: data.mint || data.signature || 'N/A',
                    timestamp: data.timestamp || Date.now(),
                    tradeType: data.tradeType || 'create',
                    marketCapSol: data.marketCapSol || 0,
                    priceNative: data.priceNative || 0,
                    liquidity: (data.marketCapSol || 0) * 100, // Estimate
                    description: data.description || '',
                    image: data.image || '',
                    twitter: data.twitter || '',
                    telegram: data.telegram || '',
                    website: data.website || ''
                };
                
                // Apply filters
                const ageMinutes = (Date.now() - token.timestamp) / 60000;
                if (ageMinutes > state.maxAge) return;
                if (token.liquidity < state.minLiquidity) return;
                
                // Add to state
                state.memes.unshift(token);
                
                // Keep only last 100
                if (state.memes.length > 100) {
                    state.memes = state.memes.slice(0, 100);
                }
                
                // Add to activity feed
                addToActivityFeed({
                    type: 'new_token',
                    token: token.symbol,
                    message: `üöÄ NEW: ${token.symbol}`,
                    timestamp: Date.now()
                });
                
                // Update UI
                renderMemes();
                updateStats();
                
                // Show notification
                showStatus(`üöÄ NEW TOKEN: ${token.symbol} - ${formatAmount(token.marketCapSol * 100)} MC`, 'success');
            }
        }

        // ============================================
        // DEXSCREENER INTEGRATION
        // ============================================

        async function scanDexscreener() {
            if (state.isScanning) return;
            
            state.isScanning = true;
            const scanBtn = document.getElementById('btn-scan-pools');
            const scanIcon = document.getElementById('scan-icon');
            
            scanBtn.disabled = true;
            scanIcon.className = 'fas fa-spinner fa-spin';
            
            showStatus('üîç Scanning Dexscreener for hot pools...', 'info');
            
            try {
                // Search for popular tokens across chains
                const popularTokens = ['PEPE', 'BONK', 'WIF', 'DOGE', 'SHIB'];
                const allPairs = [];
                
                for (const token of popularTokens) {
                    try {
                        const url = `${DEXSCREENER_API}/search?q=${token}`;
                        const response = await fetch(url);
                        
                        if (response.ok) {
                            const data = await response.json();
                            if (data.pairs) {
                                // Filter high volume pairs
                                const filtered = data.pairs.filter(p => 
                                    parseFloat(p.volume?.h24 || 0) > 50000
                                );
                                allPairs.push(...filtered);
                            }
                        }
                        
                        // Rate limit delay
                        await new Promise(r => setTimeout(r, 300));
                    } catch (err) {
                        console.error(`Error fetching ${token}:`, err);
                    }
                }
                
                if (allPairs.length === 0) {
                    showStatus('‚ùå No pools found!', 'error');
                    return;
                }
                
                // Remove duplicates and sort
                const uniquePairs = Array.from(
                    new Map(allPairs.map(p => [p.pairAddress, p])).values()
                ).sort((a, b) => 
                    parseFloat(b.volume?.h24 || 0) - parseFloat(a.volume?.h24 || 0)
                ).slice(0, 50);
                
                state.pools = uniquePairs;
                renderPools();
                updateStats();
                
                showStatus(`‚úÖ Found ${uniquePairs.length} hot pools!`, 'success');
                
            } catch (err) {
                console.error('Dexscreener scan error:', err);
                showStatus('‚ùå Error scanning Dexscreener!', 'error');
            } finally {
                state.isScanning = false;
                scanBtn.disabled = false;
                scanIcon.className = 'fas fa-search';
            }
        }

        // ============================================
        // RENDERING FUNCTIONS
        // ============================================

        function renderMemes() {
            const tbody = document.getElementById('memes-tbody');
            const count = document.getElementById('memes-count');
            
            count.textContent = state.memes.length;
            
            if (state.memes.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="px-4 py-8 text-center text-gray-400">
                            <i class="fas fa-rocket mb-2 text-2xl"></i>
                            <p>Waiting for new token launches... üöÄ</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = state.memes.map(token => {
                const age = calculateAge(token.timestamp);
                const risk = calculateRisk(token);
                const mcap = formatAmount(token.marketCapSol * 100);
                const price = token.priceNative ? `$${token.priceNative.toFixed(8)}` : 'N/A';
                const liq = formatAmount(token.liquidity);
                
                return `
                    <tr class="animate-fade-in">
                        <td class="px-4 py-3">
                            <div class="font-medium">${token.symbol}</div>
                            <div class="text-xs text-gray-400">${token.name}</div>
                        </td>
                        <td class="px-4 py-3">
                            <span class="px-2 py-1 bg-blue-500/20 text-blue-400 rounded text-xs font-medium">
                                ${age}
                            </span>
                        </td>
                        <td class="px-4 py-3 font-medium text-green-400">${mcap}</td>
                        <td class="px-4 py-3 text-sm">${price}</td>
                        <td class="px-4 py-3 text-sm">${liq}</td>
                        <td class="px-4 py-3">
                            <span class="risk-badge ${risk.class}">${risk.label}</span>
                        </td>
                        <td class="px-4 py-3">
                            <button onclick="copyToClipboard('${token.mint}')" 
                                    class="text-xs px-2 py-1 bg-purple-600 hover:bg-purple-700 rounded">
                                Copy CA
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function renderPools() {
            const tbody = document.getElementById('pools-tbody');
            const count = document.getElementById('pools-count');
            
            count.textContent = state.pools.length;
            
            if (state.pools.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="px-4 py-8 text-center text-gray-400">
                            <i class="fas fa-search mb-2 text-2xl"></i>
                            <p>Click "Scan Dexscreener" to find pools! üî•</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = state.pools.map(pair => {
                const vol = formatAmount(parseFloat(pair.volume?.h24 || 0));
                const liq = formatAmount(parseFloat(pair.liquidity?.usd || 0));
                const price = pair.priceUsd || '0';
                const change = parseFloat(pair.priceChange?.h24 || 0);
                const changeColor = change >= 0 ? 'text-green-400' : 'text-red-400';
                const changeIcon = change >= 0 ? '‚Üë' : '‚Üì';
                
                return `
                    <tr class="animate-fade-in">
                        <td class="px-4 py-3">
                            <div class="font-medium">${pair.baseToken?.symbol || 'N/A'}</div>
                            <div class="text-xs text-gray-400">${pair.baseToken?.name || 'Unknown'}</div>
                        </td>
                        <td class="px-4 py-3">
                            <span class="px-2 py-1 bg-slate-700 rounded text-xs">${pair.chainId || 'N/A'}</span>
                        </td>
                        <td class="px-4 py-3 font-medium text-green-400">${vol}</td>
                        <td class="px-4 py-3">${liq}</td>
                        <td class="px-4 py-3 text-sm">$${parseFloat(price).toFixed(6)}</td>
                        <td class="px-4 py-3 ${changeColor} font-medium">${changeIcon} ${Math.abs(change).toFixed(2)}%</td>
                        <td class="px-4 py-3 text-xs">${pair.dexId || 'DEX'}</td>
                        <td class="px-4 py-3">
                            <a href="${pair.url}" target="_blank" 
                               class="text-xs px-2 py-1 bg-purple-600 hover:bg-purple-700 rounded">
                                View
                            </a>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function addToActivityFeed(activity) {
            state.activityFeed.unshift(activity);
            
            // Keep only last 50
            if (state.activityFeed.length > 50) {
                state.activityFeed = state.activityFeed.slice(0, 50);
            }
            
            renderActivityFeed();
        }

        function renderActivityFeed() {
            const feed = document.getElementById('activity-feed');
            
            if (state.activityFeed.length === 0) {
                feed.innerHTML = `
                    <div class="text-sm p-3 rounded-lg bg-slate-800/30 text-center text-gray-400">
                        <p>No activity yet...</p>
                    </div>
                `;
                return;
            }
            
            feed.innerHTML = state.activityFeed.slice(0, 20).map(activity => {
                const timeAgo = Math.floor((Date.now() - activity.timestamp) / 1000);
                const timeStr = timeAgo < 60 ? `${timeAgo}s ago` : `${Math.floor(timeAgo / 60)}m ago`;
                
                return `
                    <div class="text-sm p-2 rounded-lg bg-slate-800/30 new-token-notification">
                        <div class="flex items-start gap-2">
                            <span class="text-lg">üöÄ</span>
                            <div class="flex-1">
                                <div class="font-medium text-pink-400">${activity.message}</div>
                                <div class="text-gray-500 text-xs">${timeStr}</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateStats() {
            document.getElementById('stat-memes').textContent = state.memes.length;
            document.getElementById('stat-pools').textContent = state.pools.length;
            document.getElementById('stat-updates').textContent = state.liveUpdates;
            
            const totalVolume = state.pools.reduce((sum, p) => 
                sum + parseFloat(p.volume?.h24 || 0), 0
            );
            document.getElementById('stat-volume').textContent = formatAmount(totalVolume);
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showStatus('‚úÖ Copied to clipboard!', 'success');
                setTimeout(() => {
                    showStatus('üëã Ready!', 'info');
                }, 2000);
            });
        }

        // ============================================
        // TAB NAVIGATION
        // ============================================

        function setupTabs() {
            const tabBtns = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const tabId = btn.getAttribute('data-tab');
                    
                    tabBtns.forEach(b => b.classList.remove('tab-active'));
                    btn.classList.add('tab-active');
                    
                    tabContents.forEach(content => {
                        if (content.id === `${tabId}-tab`) {
                            content.classList.remove('hidden');
                        } else {
                            content.classList.add('hidden');
                        }
                    });
                });
            });
        }

        // ============================================
        // EVENT LISTENERS
        // ============================================

        document.getElementById('toggle-pumpfun').addEventListener('click', connectPumpfun);
        document.getElementById('btn-scan-pools').addEventListener('click', scanDexscreener);
        
        document.getElementById('btn-clear').addEventListener('click', () => {
            state.memes = [];
            state.pools = [];
            state.activityFeed = [];
            state.liveUpdates = 0;
            
            renderMemes();
            renderPools();
            renderActivityFeed();
            updateStats();
            
            showStatus('üóëÔ∏è Cleared all data!', 'info');
        });
        
        document.getElementById('min-liquidity').addEventListener('change', (e) => {
            state.minLiquidity = parseFloat(e.target.value);
            showStatus(`üìä Min liquidity set to ${formatAmount(state.minLiquidity)}`, 'info');
        });
        
        document.getElementById('max-age').addEventListener('change', (e) => {
            state.maxAge = parseInt(e.target.value);
            showStatus(`‚è±Ô∏è Max age set to ${state.maxAge} minutes`, 'info');
        });

        // ============================================
        // INITIALIZATION
        // ============================================

        function init() {
            setupTabs();
            updateStats();
            renderActivityFeed();
            
            console.log('üêã WhaleTracker Pro v2 initialized!');
            console.log('üí° Click "Start Pump.fun Live" to begin!');
        }

        // Start app
        init();
    </script>
</body>
</html>
