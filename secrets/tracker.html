<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hyperliquid Whale Tracker - Real-time Whale Analytics</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-fade-in { animation: fadeIn 0.5s ease-out; }
        .animate-spin { animation: spin 1s linear infinite; }
        .glass-card { 
            background: rgba(15, 23, 42, 0.7); 
            border: 1px solid rgba(124, 58, 237, 0.1); 
            backdrop-filter: blur(10px);
        }
        .tab-active { 
            border-bottom: 2px solid #8b5cf6;
            color: #8b5cf6;
        }
        tr:hover { 
            background-color: rgba(139, 92, 246, 0.1) !important; 
            transform: scale(1.01);
            transition: all 0.15s ease;
        }
        .tab-content {
            transition: opacity 0.3s ease;
        }
        .tab-content.hidden { 
            opacity: 0; 
            pointer-events: none;
            position: absolute;
        }
        .tab-content:not(.hidden) {
            opacity: 1;
            position: relative;
        }
        .pulse-ring {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(0.95); opacity: 1; }
            50% { transform: scale(1); opacity: 0.7; }
            100% { transform: scale(0.95); opacity: 1; }
        }
        .whale-badge {
            background: linear-gradient(45deg, #8b5cf6, #3b82f6);
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: bold;
        }
        .size-large { background: #ef4444; }
        .size-medium { background: #f59e0b; }
        .size-small { background: #10b981; }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-indigo-950 to-slate-900 text-white min-h-screen">
    <div id="app" class="p-4">
        <!-- Header -->
        <header class="max-w-7xl mx-auto mb-8">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="relative">
                        <div class="w-12 h-12 bg-gradient-to-r from-purple-500 to-blue-500 rounded-xl flex items-center justify-center text-white font-bold text-lg pulse-ring">
                            üêã
                        </div>
                        <div class="absolute -top-1 -right-1 w-4 h-4 bg-green-400 rounded-full border-2 border-slate-900"></div>
                    </div>
                    <div>
                        <h1 class="text-3xl font-bold bg-gradient-to-r from-purple-400 to-blue-400 bg-clip-text text-transparent">
                            Hyperliquid Whale Tracker
                        </h1>
                        <p class="text-gray-400 mt-1">Track large traders & wallet activity on Hyperliquid</p>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <button id="theme-toggle" class="p-2 rounded-lg bg-slate-800 hover:bg-slate-700 transition">
                        <i class="fas fa-moon"></i>
                    </button>
                    <button class="px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg transition flex items-center gap-2">
                        <i class="fas fa-bolt"></i>
                        <span>Live</span>
                        <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                    </button>
                </div>
            </div>
        </header>

        <div class="max-w-7xl mx-auto flex gap-6">
            <!-- Main Content -->
            <div class="flex-1">
                <!-- Tabs Navigation -->
                <div class="mb-6">
                    <div class="flex border-b border-slate-700 gap-6 overflow-x-auto">
                        <button class="tab-btn py-3 px-1 font-medium text-gray-400 hover:text-white transition tab-active" data-tab="fresh">
                            <i class="fas fa-bolt mr-2"></i>Fresh Trades
                        </button>
                        <button class="tab-btn py-3 px-1 font-medium text-gray-400 hover:text-white transition" data-tab="tracker">
                            <i class="fas fa-search mr-2"></i>Wallet Tracker
                        </button>
                        <button class="tab-btn py-3 px-1 font-medium text-gray-400 hover:text-white transition" data-tab="wallets">
                            <i class="fas fa-fish mr-2"></i>Watched Wallets
                        </button>
                    </div>
                </div>

                <!-- API Status -->
                <div id="api-status" class="mb-6">
                    <div class="bg-yellow-900/20 border border-yellow-500/30 rounded-lg p-3">
                        <p class="text-yellow-400 text-sm flex items-center">
                            <i class="fas fa-info-circle mr-2"></i>
                            <span id="status-message">üêã Ready! Track whale trades on Hyperliquid</span>
                        </p>
                    </div>
                </div>

                <!-- Control Panel -->
                <div class="glass-card rounded-xl p-6 mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-2 text-gray-300">
                                <i class="fas fa-filter mr-2"></i>Min Trade Size
                            </label>
                            <select id="min-trade-size" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-white text-sm">
                                <option value="10000">$10K+</option>
                                <option value="50000">$50K+</option>
                                <option value="100000" selected>$100K+</option>
                                <option value="500000">$500K+</option>
                                <option value="1000000">$1M+</option>
                                <option value="10000000">$10M+</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2 text-gray-300">
                                <i class="fas fa-clock mr-2"></i>Time Range
                            </label>
                            <select id="time-range" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-white text-sm">
                                <option value="1h">Last 1 Hour</option>
                                <option value="6h" selected>Last 6 Hours</option>
                                <option value="24h">Last 24 Hours</option>
                                <option value="7d">Last 7 Days</option>
                            </select>
                        </div>
                        <div class="flex items-end gap-2">
                            <button id="btn-scan-whales" class="flex-1 bg-purple-600 hover:bg-purple-700 py-2 px-4 rounded-lg font-medium transition flex items-center justify-center gap-2">
                                <i id="scan-icon" class="fas fa-search"></i>
                                Scan Whales
                            </button>
                            <button id="btn-refresh" class="flex-1 bg-green-600 hover:bg-green-700 py-2 px-4 rounded-lg font-medium transition flex items-center justify-center gap-2">
                                <i id="refresh-icon" class="fas fa-sync"></i>
                                Refresh
                            </button>
                        </div>
                        <div class="flex items-end">
                            <button id="btn-export" class="w-full bg-blue-600 hover:bg-blue-700 py-2 px-4 rounded-lg font-medium transition flex items-center justify-center gap-2">
                                <i class="fas fa-download"></i>
                                Export Data
                            </button>
                        </div>
                    </div>

                    <!-- Wallet Search -->
                    <div class="mt-6 pt-6 border-t border-slate-700/50">
                        <label class="block text-sm font-medium mb-2 text-gray-300">
                            <i class="fas fa-search mr-2"></i>Track Specific Wallet
                        </label>
                        <div class="flex gap-2">
                            <input 
                                id="wallet-search" 
                                type="text" 
                                placeholder="Enter Hyperliquid wallet address (0x...)" 
                                class="flex-1 bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-white text-sm placeholder-gray-500 font-mono"
                            >
                            <button id="btn-search-wallet" class="bg-blue-600 hover:bg-blue-700 px-6 py-2 rounded-lg transition flex items-center gap-2">
                                <i id="wallet-search-icon" class="fas fa-search"></i>
                                Analyze
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="glass-card rounded-xl p-4 animate-fade-in hover:transform hover:scale-105 transition-all duration-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400 text-sm">Whale Trades</p>
                                <p id="stat-trades" class="text-2xl font-bold text-green-400">0</p>
                            </div>
                            <div class="w-10 h-10 bg-green-500/20 rounded-lg flex items-center justify-center">
                                <i class="fas fa-chart-line text-green-400"></i>
                            </div>
                        </div>
                    </div>
                    <div class="glass-card rounded-xl p-4 animate-fade-in hover:transform hover:scale-105 transition-all duration-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400 text-sm">Active Whales</p>
                                <p id="stat-whales" class="text-2xl font-bold text-purple-400">0</p>
                            </div>
                            <div class="w-10 h-10 bg-purple-500/20 rounded-lg flex items-center justify-center">
                                <i class="fas fa-fish text-purple-400"></i>
                            </div>
                        </div>
                    </div>
                    <div class="glass-card rounded-xl p-4 animate-fade-in hover:transform hover:scale-105 transition-all duration-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400 text-sm">Watched Wallets</p>
                                <p id="stat-watched" class="text-2xl font-bold text-blue-400">0</p>
                            </div>
                            <div class="w-10 h-10 bg-blue-500/20 rounded-lg flex items-center justify-center">
                                <i class="fas fa-eye text-blue-400"></i>
                            </div>
                        </div>
                    </div>
                    <div class="glass-card rounded-xl p-4 animate-fade-in hover:transform hover:scale-105 transition-all duration-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-400 text-sm">Total Volume</p>
                                <p id="stat-volume" class="text-2xl font-bold text-orange-400">$0</p>
                            </div>
                            <div class="w-10 h-10 bg-orange-500/20 rounded-lg flex items-center justify-center">
                                <i class="fas fa-dollar-sign text-orange-400"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab Content -->
                <div class="relative">
                    <!-- Fresh Trades Tab -->
                    <div id="fresh-tab" class="tab-content">
                        <div class="glass-card rounded-xl border border-green-500/20 overflow-hidden">
                            <div class="p-4 border-b border-slate-700/50 flex items-center justify-between">
                                <h2 class="text-lg font-semibold flex items-center gap-2">
                                    <i class="fas fa-bolt text-green-400"></i>
                                    Fresh Whale Trades
                                </h2>
                                <div class="flex items-center gap-2">
                                    <div class="text-sm text-gray-400">
                                        <span id="fresh-count">0</span> trades
                                    </div>
                                    <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                                </div>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-slate-800/50">
                                        <tr>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Wallet</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Asset</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Side</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Size</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Price</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Value</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Time</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="fresh-tbody" class="divide-y divide-slate-700/50">
                                        <tr>
                                            <td colspan="8" class="px-4 py-8 text-center text-gray-400">
                                                <i class="fas fa-search mb-2 text-2xl"></i>
                                                <p>Click "Scan Whales" to find large traders! üêã</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Wallet Tracker Tab -->
                    <div id="tracker-tab" class="tab-content hidden">
                        <div class="glass-card rounded-xl border border-blue-500/20 overflow-hidden">
                            <div class="p-4 border-b border-slate-700/50">
                                <h2 class="text-lg font-semibold flex items-center gap-2">
                                    <i class="fas fa-wallet text-blue-400"></i>
                                    Wallet Analysis
                                </h2>
                                <p class="text-sm text-gray-400 mt-1">Analyze whale wallet activity and trading patterns</p>
                            </div>
                            <div class="p-6">
                                <div id="wallet-analysis" class="text-center py-8 text-gray-400">
                                    <i class="fas fa-search mb-4 text-4xl"></i>
                                    <p>Enter a wallet address above and click "Analyze" to see trading activity</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Watched Wallets Tab -->
                    <div id="wallets-tab" class="tab-content hidden">
                        <div class="glass-card rounded-xl border border-green-500/20 overflow-hidden">
                            <div class="p-4 border-b border-slate-700/50">
                                <h2 class="text-lg font-semibold flex items-center gap-2">
                                    <i class="fas fa-eye text-green-400"></i>
                                    Watched Whale Wallets
                                </h2>
                            </div>
                            <div class="p-4">
                                <div id="wallets-grid" class="grid grid-cols-1 gap-4">
                                    <p class="text-gray-400 text-center col-span-3 py-8">
                                        <i class="fas fa-fish mb-2 text-2xl"></i>
                                        <p>No wallets being watched yet. Analyze a wallet and click "Watch Wallet"!</p>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Live Activity Feed (Fixed Sidebar) -->
            <div class="hidden lg:block w-80">
                <div class="sticky top-28 glass-card rounded-xl p-4 border border-slate-700/50">
                    <div class="flex items-center gap-2 mb-4">
                        <i class="fas fa-bolt text-yellow-400"></i>
                        <span class="font-semibold">Live Tracker</span>
                        <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse ml-auto"></div>
                    </div>
                    <div id="activity-feed" class="space-y-3 max-h-[600px] overflow-y-auto">
                        <div class="text-sm p-2 rounded-lg bg-slate-800/30">
                            <div class="flex items-start gap-2">
                                <span class="text-lg">üêã</span>
                                <div class="flex-1">
                                    <div class="font-medium text-green-400">Whale Trade</div>
                                    <div class="text-gray-400 text-xs">Waiting for data...</div>
                                </div>
                                <div class="text-gray-500 text-xs">‚Äî</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // üêã HYPERLIQUID API CONFIGURATION
        const HYPERLIQUID_API = {
            BASE: 'https://api.hyperliquid.xyz',
            INFO: '/info',
            EXCHANGE: '/exchange'
        };

        // State Management
        let state = {
            minTradeSize: 100000,
            timeRange: '6h',
            trades: [],
            wallets: new Map(),
            watchedWallets: new Set(JSON.parse(localStorage.getItem('hyperliquid_watched') || '[]')),
            isScanning: false,
            activeTab: 'fresh'
        };

        // Sample whale wallets to track (replace with real whale addresses)
        const WHALE_WALLETS = [
            '0xcd5051944f780a621ee62e39e493c489668acf4d',
            '0x8c967e73e6b15087c42a10d344cff4c96d877f1d',
            // Add more known whale addresses here
        ];

        // Helper Functions
        function formatAmount(amount) {
            if (!amount || isNaN(amount)) return '$0';
            if (amount >= 1000000000) return '$' + (amount / 1000000000).toFixed(2) + 'B';
            if (amount >= 1000000) return '$' + (amount / 1000000).toFixed(2) + 'M';
            if (amount >= 1000) return '$' + (amount / 1000).toFixed(1) + 'K';
            return '$' + amount.toFixed(2);
        }

        function shortenAddress(address) {
            if (!address || address === 'N/A') return 'N/A';
            return `${address.slice(0, 6)}...${address.slice(-4)}`;
        }

        function formatTime(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diff = now - date;
            
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);
            
            if (minutes < 1) return 'Just now';
            if (minutes < 60) return `${minutes}m ago`;
            if (hours < 24) return `${hours}h ago`;
            return `${days}d ago`;
        }

        function showApiStatus(message, type = 'info') {
            const statusDiv = document.getElementById('api-status');
            const messageEl = document.getElementById('status-message');
            
            statusDiv.className = `mb-6 rounded-lg p-3 ${
                type === 'error' ? 'bg-red-900/20 border border-red-500/30' :
                type === 'success' ? 'bg-green-900/20 border border-green-500/30' :
                'bg-yellow-900/20 border border-yellow-500/30'
            }`;
            
            messageEl.className = `text-sm flex items-center ${
                type === 'error' ? 'text-red-400' :
                type === 'success' ? 'text-green-400' :
                'text-yellow-400'
            }`;
            
            messageEl.innerHTML = `<i class="fas fa-${type === 'error' ? 'exclamation-triangle' : type === 'success' ? 'check-circle' : 'info-circle'} mr-2"></i>${message}`;
        }

        function getTradeSize(value) {
            if (value >= 10000000) return { class: 'size-large', label: 'üê≥ MEGA' };
            if (value >= 1000000) return { class: 'size-large', label: 'üêã HUGE' };
            if (value >= 100000) return { class: 'size-medium', label: 'ü¶à LARGE' };
            return { class: 'size-small', label: 'üêü MEDIUM' };
        }

        // üêã HYPERLIQUID API FUNCTIONS

        // Get user fills (trades) for a wallet
        async function getUserFills(walletAddress) {
            try {
                const response = await fetch(HYPERLIQUID_API.BASE + HYPERLIQUID_API.INFO, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        type: 'userFills',
                        user: walletAddress
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const fills = await response.json();
                return fills || [];
            } catch (error) {
                console.error('Error fetching user fills:', error);
                return [];
            }
        }

        // Get user state (account value, positions)
        async function getUserState(walletAddress) {
            try {
                const response = await fetch(HYPERLIQUID_API.BASE + HYPERLIQUID_API.INFO, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        type: 'clearinghouseState',
                        user: walletAddress
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const userState = await response.json();
                return userState;
            } catch (error) {
                console.error('Error fetching user state:', error);
                return null;
            }
        }

        // Scan for whale trades
        async function scanWhaleTrades() {
            if (state.isScanning) return;
            
            state.isScanning = true;
            const scanBtn = document.getElementById('btn-scan-whales');
            const icon = document.getElementById('scan-icon');
            
            scanBtn.disabled = true;
            icon.classList.add('animate-spin');
            showApiStatus('üîç Scanning for whale trades...', 'info');

            try {
                state.trades = [];
                const allTrades = [];

                // Scan predefined whale wallets
                for (const walletAddress of WHALE_WALLETS) {
                    const fills = await getUserFills(walletAddress);
                    
                    if (fills && fills.length > 0) {
                        // Filter trades by size and time
                        const filteredFills = fills.filter(fill => {
                            const tradeValue = parseFloat(fill.sz) * parseFloat(fill.px);
                            const tradeTime = fill.time;
                            
                            // Check if trade meets minimum size
                            if (tradeValue < state.minTradeSize) return false;
                            
                            // Check time range
                            const hoursAgo = (Date.now() - tradeTime) / (1000 * 60 * 60);
                            const rangeHours = state.timeRange === '1h' ? 1 : 
                                             state.timeRange === '6h' ? 6 : 
                                             state.timeRange === '24h' ? 24 : 168;
                            
                            return hoursAgo <= rangeHours;
                        });

                        // Add wallet address to each trade
                        filteredFills.forEach(fill => {
                            fill.walletAddress = walletAddress;
                            allTrades.push(fill);
                        });
                    }

                    // Small delay to avoid rate limiting
                    await new Promise(resolve => setTimeout(resolve, 100));
                }

                // Sort by time (most recent first)
                allTrades.sort((a, b) => b.time - a.time);
                state.trades = allTrades;

                // Update UI
                updateTradesTable();
                updateActivityFeed();
                updateStats();

                showApiStatus(`‚úÖ Found ${state.trades.length} whale trades!`, 'success');
            } catch (error) {
                console.error('Scan error:', error);
                showApiStatus('‚ùå Error scanning trades: ' + error.message, 'error');
            } finally {
                state.isScanning = false;
                scanBtn.disabled = false;
                icon.classList.remove('animate-spin');
            }
        }

        // Analyze specific wallet
        async function analyzeWallet() {
            const walletInput = document.getElementById('wallet-search');
            const walletAddress = walletInput.value.trim();
            
            if (!walletAddress || !walletAddress.startsWith('0x') || walletAddress.length !== 42) {
                showApiStatus('‚ùå Please enter a valid Hyperliquid wallet address (0x...)', 'error');
                return;
            }

            const btn = document.getElementById('btn-search-wallet');
            const icon = document.getElementById('wallet-search-icon');
            
            btn.disabled = true;
            icon.classList.add('animate-spin');
            showApiStatus('üîç Analyzing wallet...', 'info');

            try {
                // Get wallet state
                const userState = await getUserState(walletAddress);
                
                if (!userState) {
                    throw new Error('Unable to fetch wallet data');
                }

                // Get recent fills
                const fills = await getUserFills(walletAddress);

                // Display results
                const analysisDiv = document.getElementById('wallet-analysis');
                const accountValue = userState.marginSummary?.accountValue || '0';
                const totalPnL = fills.reduce((sum, fill) => sum + parseFloat(fill.closedPnl || 0), 0);
                
                analysisDiv.innerHTML = `
                    <div class="space-y-4">
                        <div class="glass-card p-4 rounded-lg">
                            <h3 class="font-semibold mb-3 flex items-center gap-2">
                                <i class="fas fa-wallet text-blue-400"></i>
                                Wallet Overview
                            </h3>
                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div>
                                    <p class="text-gray-400">Address</p>
                                    <p class="font-mono text-xs">${walletAddress}</p>
                                </div>
                                <div>
                                    <p class="text-gray-400">Account Value</p>
                                    <p class="font-semibold text-green-400">${formatAmount(parseFloat(accountValue))}</p>
                                </div>
                                <div>
                                    <p class="text-gray-400">Total Trades</p>
                                    <p class="font-semibold">${fills.length}</p>
                                </div>
                                <div>
                                    <p class="text-gray-400">Total PnL</p>
                                    <p class="font-semibold ${totalPnL >= 0 ? 'text-green-400' : 'text-red-400'}">
                                        ${totalPnL >= 0 ? '+' : ''}${formatAmount(totalPnL)}
                                    </p>
                                </div>
                            </div>
                            <button onclick="watchWallet('${walletAddress}')" class="mt-4 w-full bg-purple-600 hover:bg-purple-700 py-2 rounded-lg transition flex items-center justify-center gap-2">
                                <i class="fas fa-eye"></i>
                                Watch This Wallet
                            </button>
                        </div>

                        <div class="glass-card p-4 rounded-lg">
                            <h3 class="font-semibold mb-3 flex items-center gap-2">
                                <i class="fas fa-chart-line text-green-400"></i>
                                Recent Trades
                            </h3>
                            <div class="space-y-2 max-h-96 overflow-y-auto">
                                ${fills.slice(0, 20).map(fill => {
                                    const value = parseFloat(fill.sz) * parseFloat(fill.px);
                                    const sizeInfo = getTradeSize(value);
                                    return `
                                        <div class="p-3 bg-slate-800/30 rounded-lg text-sm">
                                            <div class="flex items-center justify-between mb-1">
                                                <div class="flex items-center gap-2">
                                                    <span class="${sizeInfo.class} text-xs px-2 py-1 rounded">${sizeInfo.label}</span>
                                                    <span class="font-semibold">${fill.coin}</span>
                                                    <span class="${fill.side === 'B' ? 'text-green-400' : 'text-red-400'}">
                                                        ${fill.side === 'B' ? 'BUY' : 'SELL'}
                                                    </span>
                                                </div>
                                                <span class="text-gray-400">${formatTime(fill.time)}</span>
                                            </div>
                                            <div class="flex items-center justify-between text-xs text-gray-400">
                                                <span>Size: ${parseFloat(fill.sz).toFixed(4)}</span>
                                                <span>Price: $${parseFloat(fill.px).toFixed(2)}</span>
                                                <span class="font-semibold text-white">${formatAmount(value)}</span>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    </div>
                `;

                // Switch to tracker tab
                document.querySelector('[data-tab="tracker"]').click();
                showApiStatus('‚úÖ Wallet analyzed successfully!', 'success');

            } catch (error) {
                console.error('Wallet analysis error:', error);
                showApiStatus('‚ùå Error analyzing wallet: ' + error.message, 'error');
            } finally {
                btn.disabled = false;
                icon.classList.remove('animate-spin');
            }
        }

        // Update trades table
        function updateTradesTable() {
            const tbody = document.getElementById('fresh-tbody');
            const countEl = document.getElementById('fresh-count');
            
            countEl.textContent = state.trades.length;

            if (state.trades.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="px-4 py-8 text-center text-gray-400">
                            <i class="fas fa-search mb-2 text-2xl"></i>
                            <p>No whale trades found. Try adjusting the filters!</p>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = state.trades.map(trade => {
                const value = parseFloat(trade.sz) * parseFloat(trade.px);
                const sizeInfo = getTradeSize(value);
                
                return `
                    <tr class="animate-fade-in">
                        <td class="px-4 py-3">
                            <div class="font-mono text-xs">${shortenAddress(trade.walletAddress)}</div>
                            <div class="text-xs text-gray-400 mt-1">
                                <span class="${sizeInfo.class} px-2 py-0.5 rounded text-xs">${sizeInfo.label}</span>
                            </div>
                        </td>
                        <td class="px-4 py-3">
                            <div class="font-semibold">${trade.coin}</div>
                        </td>
                        <td class="px-4 py-3">
                            <span class="${trade.side === 'B' ? 'text-green-400' : 'text-red-400'} font-semibold">
                                ${trade.side === 'B' ? 'üìà BUY' : 'üìâ SELL'}
                            </span>
                        </td>
                        <td class="px-4 py-3 font-medium">
                            ${parseFloat(trade.sz).toFixed(4)}
                        </td>
                        <td class="px-4 py-3">
                            $${parseFloat(trade.px).toFixed(2)}
                        </td>
                        <td class="px-4 py-3 font-semibold text-white">
                            ${formatAmount(value)}
                        </td>
                        <td class="px-4 py-3 text-sm text-gray-400">
                            ${formatTime(trade.time)}
                        </td>
                        <td class="px-4 py-3">
                            <div class="flex gap-2">
                                <button onclick="copyToClipboard('${trade.walletAddress}')" class="p-2 bg-blue-600 hover:bg-blue-700 rounded-lg transition" title="Copy Address">
                                    <i class="fas fa-copy text-xs"></i>
                                </button>
                                <button onclick="watchWallet('${trade.walletAddress}')" class="p-2 bg-purple-600 hover:bg-purple-700 rounded-lg transition" title="Watch Wallet">
                                    <i class="fas fa-eye text-xs"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Update activity feed
        function updateActivityFeed() {
            const feed = document.getElementById('activity-feed');
            feed.innerHTML = '';
            
            state.trades.slice(0, 10).forEach(trade => {
                const value = parseFloat(trade.sz) * parseFloat(trade.px);
                const sizeInfo = getTradeSize(value);
                
                const activityItem = document.createElement('div');
                activityItem.className = 'text-sm p-2 rounded-lg bg-slate-800/30 animate-fade-in cursor-pointer hover:bg-slate-700/30';
                activityItem.innerHTML = `
                    <div class="flex items-start gap-2">
                        <span class="text-lg">${trade.side === 'B' ? 'üìà' : 'üìâ'}</span>
                        <div class="flex-1">
                            <div class="font-medium">${trade.coin}</div>
                            <div class="text-gray-400 text-xs">${shortenAddress(trade.walletAddress)}</div>
                            <div class="flex gap-1 mt-1">
                                <span class="text-xs ${trade.side === 'B' ? 'text-green-400' : 'text-red-400'}">
                                    ${trade.side === 'B' ? 'BUY' : 'SELL'}
                                </span>
                                <span class="text-xs text-gray-400">‚Ä¢</span>
                                <span class="text-xs font-semibold">${formatAmount(value)}</span>
                            </div>
                        </div>
                        <div class="text-gray-500 text-xs">${formatTime(trade.time)}</div>
                    </div>
                `;
                
                feed.prepend(activityItem);
            });
        }

        // Update stats
        function updateStats() {
            document.getElementById('stat-trades').textContent = state.trades.length;
            
            const uniqueWallets = new Set(state.trades.map(t => t.walletAddress));
            document.getElementById('stat-whales').textContent = uniqueWallets.size;
            
            document.getElementById('stat-watched').textContent = state.watchedWallets.size;
            
            const totalVolume = state.trades.reduce((sum, trade) => {
                return sum + (parseFloat(trade.sz) * parseFloat(trade.px));
            }, 0);
            document.getElementById('stat-volume').textContent = formatAmount(totalVolume);
        }

        // Watch wallet
        function watchWallet(address) {
            state.watchedWallets.add(address);
            localStorage.setItem('hyperliquid_watched', JSON.stringify([...state.watchedWallets]));
            updateWatchedWallets();
            showApiStatus(`‚úÖ Wallet ${shortenAddress(address)} added to watchlist!`, 'success');
            updateStats();
        }

        // Update watched wallets display
        function updateWatchedWallets() {
            const grid = document.getElementById('wallets-grid');
            
            if (state.watchedWallets.size === 0) {
                grid.innerHTML = `
                    <p class="text-gray-400 text-center col-span-3 py-8">
                        <i class="fas fa-fish mb-2 text-2xl"></i>
                        <p>No wallets being watched yet. Analyze a wallet and click "Watch Wallet"!</p>
                    </p>
                `;
                return;
            }

            grid.innerHTML = Array.from(state.watchedWallets).map(address => `
                <div class="glass-card p-4 rounded-lg">
                    <div class="flex items-center justify-between mb-2">
                        <span class="font-mono text-sm">${address}</span>
                        <button onclick="removeWallet('${address}')" class="text-red-400 hover:text-red-300">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <button onclick="document.getElementById('wallet-search').value='${address}'; analyzeWallet();" 
                            class="w-full bg-blue-600 hover:bg-blue-700 py-2 rounded-lg transition text-sm">
                        <i class="fas fa-search mr-2"></i>
                        Analyze
                    </button>
                </div>
            `).join('');
        }

        // Remove watched wallet
        function removeWallet(address) {
            state.watchedWallets.delete(address);
            localStorage.setItem('hyperliquid_watched', JSON.stringify([...state.watchedWallets]));
            updateWatchedWallets();
            updateStats();
            showApiStatus(`‚úÖ Wallet removed from watchlist`, 'success');
        }

        // Copy to clipboard
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showApiStatus('‚úÖ Address copied to clipboard!', 'success');
            });
        }

        // Export data
        function exportData() {
            const data = {
                trades: state.trades,
                watchedWallets: Array.from(state.watchedWallets),
                exportDate: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `hyperliquid-whale-data-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            showApiStatus('‚úÖ Data exported successfully!', 'success');
        }

        // Initialize app
        function initApp() {
            // Event listeners
            document.getElementById('btn-scan-whales').addEventListener('click', scanWhaleTrades);
            document.getElementById('btn-refresh').addEventListener('click', scanWhaleTrades);
            document.getElementById('btn-search-wallet').addEventListener('click', analyzeWallet);
            document.getElementById('btn-export').addEventListener('click', exportData);
            
            document.getElementById('min-trade-size').addEventListener('change', (e) => {
                state.minTradeSize = parseInt(e.target.value);
            });
            
            document.getElementById('time-range').addEventListener('change', (e) => {
                state.timeRange = e.target.value;
            });

            // Wallet search on Enter key
            document.getElementById('wallet-search').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    analyzeWallet();
                }
            });
            
            // Tab switching
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const tab = btn.getAttribute('data-tab');
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('tab-active'));
                    document.querySelectorAll('.tab-content').forEach(content => content.classList.add('hidden'));
                    btn.classList.add('tab-active');
                    document.getElementById(`${tab}-tab`).classList.remove('hidden');
                    state.activeTab = tab;
                });
            });
            
            // Load watched wallets
            updateWatchedWallets();
            updateStats();
            
            showApiStatus('üêã Ready! Click "Scan Whales" to track large traders on Hyperliquid', 'success');
        }

        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
