<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" type="image/png" href="../img/favicon.png">
  
  <!-- Barlow Font -->
  <link href="https://fonts.googleapis.com/css2?family=Barlow:wght@400;600;700;800&display=swap" rel="stylesheet">
  
<title>Gobbles ‚Äî Cope Harder!</title>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- Chart Data Labels Plugin -->
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
<!-- Solana Web3 -->
<script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.js"></script>
<!-- Supabase -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
  :root{
    --bg:#0b0f14; --panel:#0f1622; --ink:#e9fbff; --muted:#9ed9e6; --accent:#00eaff;
    --good:#14F195; --bad:#ff6b6b; --purple:#9945FF; --blue:#00eaff;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:
    radial-gradient(1200px 800px at 70% -10%,rgba(0,234,255,.08),transparent 60%),
    linear-gradient(180deg,#05080c,#0a0f16 40%,#05080c);
    color:var(--ink);font-family:"Barlow", system-ui, -apple-system, Segoe UI, Roboto, Arial}
  a{color:var(--accent)}
  
  /* Barlow Font f√ºr Headlines */
  h1, h2, h3, .brand-wrap b {
    font-family:"Barlow", sans-serif;
    font-weight:800; /* ExtraBold like X headlines */
  }

  body {
    font-family:"Barlow", sans-serif;
    font-weight:400; /* regular for posts */
  }
  
  /* ‚≠ê Partikel/Sterne Hintergrund */
  #particles {
    position: fixed;
    top: 0; left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 0;
  }

  .container{max-width:1200px;margin:0 auto;padding:16px 16px 80px 16px;position:relative;z-index:1}
  header{position:sticky;top:0;z-index:10;backdrop-filter:saturate(140%) blur(6px);
    background:linear-gradient(180deg,rgba(10,15,22,.94),rgba(10,15,22,.6));border-bottom:1px solid rgba(255,255,255,.06)}
  .h-wrap{max-width:1200px;margin:0 auto;padding:12px 16px;display:flex;align-items:center;gap:12px}
  .brand-wrap{display:flex;align-items:center;gap:10px}
  
  /* Logo Animation - komplett √ºberarbeitet */
  .logo-anim {
    width: 52px;
    height: 52px;
    border-radius: 10px;
    border: 3px solid #00eaff77;
    object-fit: cover;
    box-shadow: 0 0 12px rgba(0,234,255,0.35);
    animation: wobble 3s ease-in-out infinite, spinPulse 9s linear infinite;
    cursor: pointer; /* F√ºr Easter Egg */
    transition: opacity 0.4s ease;
  }

  /* Nur das 'G' hat spezielle Animation */
 .g-wobble {
  display: inline-block;
  transform-origin: center;
  animation: wobble 3s ease-in-out infinite, spinPulse 9s linear infinite;
  background: linear-gradient(90deg,#00eaff,#9945FF,#14f195);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}
  
  @keyframes wobble {
    0%, 100% { transform: rotate(0deg) scale(1); }
    25% { transform: rotate(-5deg) scale(1.10); }
    50% { transform: rotate(5deg) scale(1.10); }
    75% { transform: rotate(-3deg) scale(1.05); }
  }
  
  @keyframes spinPulse {
    0%, 90% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  .brand-main {
    font-weight:800;
    font-size: 26px;
    background:linear-gradient(90deg,#00eaff,#9945FF,#14f195);
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent
  }

  /* üîπ Cobie Home Button */
  .home-link {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-left: 40px;
    text-decoration: none;
    background: rgba(255,255,255,0.03);
    padding: 6px 12px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.08);
    transition: all 0.3s ease;
  }
  .home-link:hover {
    background: rgba(0,234,255,0.08);
    border-color: rgba(0,234,255,0.4);
    box-shadow: 0 0 12px rgba(0,234,255,0.3);
    transform: translateY(-1px);
  }

  .cobie-gif {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    object-fit: cover;
    box-shadow: 0 0 12px rgba(0,234,255,0.4);
    animation: pulseCobie 3s ease-in-out infinite;
  }

  .home-text {
    color: #9ed9e6;
    font-weight: 600;
    font-size: 14px;
    letter-spacing: 0.4px;
  }

  @keyframes pulseCobie {
    0%,100% { box-shadow: 0 0 6px rgba(0,234,255,0.3); }
    50% { box-shadow: 0 0 18px rgba(0,234,255,0.6); }
  }

  /* Wallet + Profile Bereich */
  .header-right-wrap {
    display: flex;
    align-items: center;
    gap: 14px;
    margin-left: auto;
  }
  .profile-link {
  position: relative;
  font-weight: 700;
  font-size: 14px;
  color: #fff;
  padding: 8px 16px;
    border-radius: 12px;
    cursor: pointer;
    background: linear-gradient(135deg,#00eaff,#9945FF,#14f195);
    box-shadow: 0 0 18px rgba(0,234,255,0.4);
    overflow: hidden;
    transition: all 0.4s ease;
  }

  /* Glitzer-Rand Animation */
  .profile-link::before {
    content: "";
    position: absolute;
    top: -2px;
    left: -2px;
    right: -2px;
    bottom: -2px;
    border-radius: 14px;
    background: linear-gradient(
      90deg,
      #00eaff,
      #9945FF,
      #14f195,
      #00eaff
    );
    background-size: 300%;
    z-index: -1;
    filter: blur(6px);
    animation: borderFlow 6s linear infinite;
    opacity: 0.9;
  }

  @keyframes borderFlow {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }

  .profile-link:hover {
    transform: translateY(-1px) scale(1.05);
    box-shadow: 0 0 25px rgba(0,234,255,0.7);
  }

  .status{font-size:12px;color:var(--muted);padding:6px 10px;border:1px solid rgba(255,255,255,.08);border-radius:999px}
  .btn{appearance:none;border:none;background:linear-gradient(135deg,var(--blue),var(--purple));color:var(--ink);
    border:1px solid rgba(255,255,255,.3);padding:10px 14px;border-radius:12px;font-weight:700;cursor:pointer;
    box-shadow:0 0 20px rgba(0,234,255,0.3);transition:all 0.3s ease;}
  .btn:hover{box-shadow:0 0 30px rgba(0,234,255,0.5);transform:translateY(-1px)}
  .connect-btn { margin-left: 10px; }
  .grid{display:grid;grid-template-columns:1.2fr .8fr;gap:16px;margin-top:16px}
  @media (max-width:980px){.grid{grid-template-columns:1fr}}
  .card{background:linear-gradient(180deg,rgba(17,24,39,.6),rgba(7,10,16,.7));
    border:1px solid rgba(255,255,255,.1);border-radius:16px;box-shadow:0 8px 32px rgba(0,0,0,0.3)}
  .card .body{padding:14px}
  .post {
    padding:12px;
    display:grid;
    grid-template-columns:48px 1fr;
    gap:12px;
    border-bottom:1px solid rgba(255,255,255,.04);
    opacity:0;
    animation:fadeUp .35s ease forwards;
    transition:0.25s ease;
  }
  .post:hover {
    background:rgba(0,255,180,0.05);
    box-shadow:0 0 12px rgba(0,255,180,0.15);
    transform:translateY(-2px);
  }
  
  /* Boom-Post Animation */
  .post-boom {
    animation: dropBoom 0.55s cubic-bezier(.17,.67,.45,1.32) forwards;
    opacity: 0;
  }

  @keyframes dropBoom {
    0% {
      transform: translateY(-120px) scale(0.8) rotate(-3deg);
      opacity: 0;
      box-shadow: none;
    }
    80% {
      transform: translateY(8px) scale(1.03);
      opacity: 1;
    }
    100% {
      transform: translateY(0) scale(1);
      box-shadow: 0 0 18px rgba(0,255,150,.4);
    }
  }

  .avatar {
    width:48px;height:48px;border-radius:12px;
    background:conic-gradient(from 120deg,#9945FF,#14F195,#00FFA3);
    overflow:hidden;display:block;
    animation:pulseGlow 3s infinite ease-in-out;
    box-shadow:0 0 8px rgba(0,255,180,0.3);
  }
  .avatar img{width:100%;height:100%;object-fit:cover;display:block}
  .muted{color:var(--muted);font-size:12px}
  textarea{background:#09101a;border:2px solid rgba(0,234,255,0.3);color:var(--ink);border-radius:12px;padding:14px;
    font:inherit;width:100%;height:120px;resize:vertical;box-shadow:0 0 15px rgba(0,234,255,0.1);transition:all 0.3s ease;}
  textarea:focus{outline:none;border-color:var(--blue);box-shadow:0 0 20px rgba(0,234,255,0.3)}
  .small{font-size:12px;color:var(--muted)}
  
  /* Post Actions */
  .post-actions{display:flex;gap:18px;margin-top:6px;align-items:center}
  .icon-btn{cursor:pointer;font-size:14px;color:var(--muted);transition:all 0.2s ease;padding:4px 8px;border-radius:6px}
  .icon-btn:hover{color:var(--accent);background:rgba(0,234,255,0.1)}
  
  .tip-btn{background:linear-gradient(135deg,#062018,#0a2a22);border:1px solid #00ffa388;color:#00ffa3;
    margin-top:4px;padding:6px 12px;font-size:12px;border-radius:8px;cursor:pointer;box-shadow:0 0 10px rgba(0,255,163,0.2)}
  .tip-btn:hover{box-shadow:0 0 15px rgba(0,255,163,0.4)}
  
  .input-group{margin-bottom:12px}
  .input-label{display:block;margin-bottom:6px;color:var(--muted);font-size:14px}
  .text-input{background:#09101a;border:2px solid rgba(255,255,255,.1);color:var(--ink);border-radius:10px;padding:10px 12px;
    width:100%;font:inherit;transition:all 0.3s ease;box-shadow:0 0 10px rgba(0,0,0,0.2)}
  .text-input:focus{outline:none;border-color:var(--blue);box-shadow:0 0 15px rgba(0,234,255,0.2)}

  .sol-icon{
    width:20px;
    height:20px;
    border-radius:6px;
  }
  
  .vote-btn{
    cursor:pointer;
    display:flex;
    align-items:center;
    gap:4px;
    font-size:14px;
    color:#7b8ca4; /* muted gray */
    transition:0.2s;
    padding:4px 8px;
    border-radius:6px;
  }

  .vote-btn.active-up{
    color:#14F195; 
    text-shadow:0 0 6px rgba(20,241,149,.7);
    font-weight:700;
  }

  .vote-btn.active-down{
    color:#9945FF;
    text-shadow:0 0 6px rgba(153,69,255,.7);
    font-weight:700;
  }

  .vote-btn:hover{opacity:0.8;}

  /* Fade animation */
  @keyframes fadeUp {
    from { opacity:0;transform:translateY(6px);}
    to   { opacity:1;transform:translateY(0);}
  }

  /* Avatar breathing glow */
  @keyframes pulseGlow {
    0%   { box-shadow:0 0 6px rgba(0,255,180,0.25); }
    50%  { box-shadow:0 0 14px rgba(0,255,180,0.55); }
    100% { box-shadow:0 0 6px rgba(0,255,180,0.25); }
  }

  /* ‚úÖ Verified NFT Halo */
  .nft-halo {
    position: relative;
    border-radius: 12px;
    animation: nftGlow 2.5s ease-in-out infinite;
    box-shadow: 0 0 12px rgba(20,241,149,0.6), 0 0 24px rgba(0,234,255,0.4);
  }

  @keyframes nftGlow {
    0% { box-shadow: 0 0 8px rgba(0,234,255,0.35), 0 0 14px rgba(20,241,149,0.3); }
    50% { box-shadow: 0 0 18px rgba(0,234,255,0.7), 0 0 32px rgba(20,241,149,0.55); }
    100% { box-shadow: 0 0 8px rgba(0,234,255,0.35), 0 0 14px rgba(20,241,149,0.3); }
  }

  /* ‚úÖ Hashtag Styles */
  .hashtag {
    color:#00eaff;
    cursor:pointer;
    font-weight:600;
    transition:all 0.2s ease;
  }
  .hashtag:hover {
    text-shadow:0 0 8px #00eaff;
    background:rgba(0,234,255,0.1);
    padding:2px 4px;
    border-radius:4px;
  }

  /* ‚úÖ Trending Styles */
  .trend-item {
    padding:8px 12px;
    margin-bottom:6px;
    background:rgba(255,255,255,0.03);
    border-radius:8px;
    cursor:pointer;
    transition:all 0.2s ease;
    border:1px solid rgba(255,255,255,0.05);
  }
  .trend-item:hover {
    background:rgba(0,234,255,0.1);
    border-color:rgba(0,234,255,0.3);
    transform:translateX(4px);
  }
  .trend-count {
    color:var(--muted);
    font-size:11px;
    float:right;
  }

  /* ‚úÖ Active Filter Badge */
  .active-filter {
    background:linear-gradient(135deg,var(--blue),var(--purple));
    color:white;
    padding:4px 8px;
    border-radius:6px;
    font-size:12px;
    margin-left:8px;
    animation:pulseGlow 2s infinite;
  }

  /* === Modal Core === */
  .modal {
    display: none;
    position: fixed;
    z-index: 999;
    inset: 0;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(4px);
  }

  .modal-content {
    width: 75%;
    max-width: 1000px;
    margin: 5% auto;
    background: linear-gradient(180deg, rgba(17,24,39,.9), rgba(7,10,16,.95));
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 20px;
    padding: 30px;
    color: var(--ink);
    box-shadow: 0 0 60px rgba(0,234,255,0.25);
    position: relative;
  }

  .close-btn {
    position: absolute;
    top: 14px;
    right: 18px;
    font-size: 28px;
    cursor: pointer;
    color: var(--muted);
    transition: .2s;
  }
  .close-btn:hover { color: var(--accent); }

  /* === Layout === */
  .profile-body {
    display: flex;
    gap: 40px;
    align-items: flex-start;
  }

  .profile-left {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .profile-right {
    flex: 1;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  /* === Inputs === */
  .input-pair {
    display: flex;
    gap: 10px;
  }
  .file-input, textarea {
    width: 100%;
    border: 2px solid rgba(255,255,255,0.08);
    background: #09101a;
    border-radius: 10px;
    color: var(--ink);
    padding: 10px;
    font-family: inherit;
    transition: 0.25s;
  }
  .text-input:focus, textarea:focus {
    border-color: var(--accent);
    box-shadow: 0 0 10px rgba(0,234,255,0.3);
  }

  /* Container f√ºr beide Buttons */
.profile-image-buttons {
  display: flex;
  gap: 10px;
  align-items: center;
  margin-top: 10px;
}

  /* Gleiche Breite f√ºr beide Buttons */
.upload-btn, .reset-btn {
  flex: 1; /* Beide Buttons nehmen gleichen Platz ein */
  min-width: 0; /* Verhindert √úberlauf */
  text-align: center;
}
  
/* Upload-Button */
.upload-btn {
  background: linear-gradient(90deg,#00eaff,#9945FF,#14f195);
  color: #fff;
  font-weight: 600;
  border: none;
  padding: 10px 18px;
  border-radius: 10px;
  cursor: pointer;
  box-shadow: 0 0 10px rgba(0,234,255,0.3);
  transition: all .3s ease;
  display: inline-block;
  text-align: center;
}
.upload-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 0 18px rgba(0,234,255,0.5);
}
  .file-hidden {
    display: none;
  }

  /* === Fix Chart === */
  #portfolioChart {
    width: 100%;
    max-width: 350px;
    aspect-ratio: 1 / 1;
  }

  /* === Portfolio List === */
  .portfolio-list {
    margin: 10px 0;
    max-height: 120px;
    overflow-y: auto;
  }
  .portfolio-item {
    display: flex;
    justify-content: between;
    align-items: center;
    padding: 6px 10px;
    background: rgba(255,255,255,0.03);
    border-radius: 6px;
    margin-bottom: 4px;
    font-size: 13px;
  }
  .portfolio-item span {
    flex: 1;
  }
  .remove-asset {
    color: #ff6b6b;
    cursor: pointer;
    font-weight: bold;
    margin-left: 8px;
  }

  /* === Profile Avatar Preview === */
  .avatar-preview {
    width: 80px;
    height: 80px;
    border-radius: 16px;
    object-fit: cover;
    border: 2px solid rgba(0,234,255,0.3);
    margin-bottom: 10px;
  }

/* Reset-Button */
.reset-btn {
  background: linear-gradient(90deg,#ff5f6d,#ffc371);
  color: #fff;
  font-weight: 600;
  border: none;
  padding: 10px 18px;
  border-radius: 10px;
  cursor: pointer;
  box-shadow: 0 0 10px rgba(255,100,100,0.3);
  transition: all .3s ease;
}
.reset-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 0 18px rgba(255,120,120,0.5);
}
 #bioInput {
  background: #09101a;
  border: 2px solid rgba(0,234,255,0.3);
  color: var(--ink);
  border-radius: 12px;
  padding: 14px;
  font: inherit;
  width: 100%;
  resize: none;
  min-height: 80px;       /* ~4 Zeilen Startgr√∂√üe */
  max-height: 120px;      /* ~4 Zeilen maximale H√∂he */
  overflow-y: auto;
  box-shadow: 0 0 15px rgba(0,234,255,0.1);
  transition: all 0.3s ease;
}

#bioInput:focus {
  outline: none;
  border-color: var(--blue);
  box-shadow: 0 0 20px rgba(0,234,255,0.3);
}

  .feed-separator {
  position: relative;
  height: 2px;
  width: 100%;
  background: linear-gradient(90deg, rgba(0,234,255,0.1), rgba(153,69,255,0.2), rgba(0,234,255,0.1));
  border-radius: 2px;
  overflow: hidden;
  margin: 15px 0;
}

/* Laufender Licht-Reflex */
.feed-separator::after {
  content: "";
  position: absolute;
  top: 0;
  left: -20%;
  width: 40%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(0,234,255,0.8), transparent);
  animation: shine 2.8s linear infinite;
  filter: blur(1px);
}

@keyframes shine {
  0% {
    left: -40%;
  }
  100% {
    left: 100%;
  }
}

/* === üåÄ Rick Easter Egg Animation === */
@keyframes rickFlyAndWobble {
  0% {
    transform: translateX(-200px) rotate(0deg);
    opacity: 0;
  }
  10% {
    opacity: 1;
  }
  25% {
    transform: translateX(25vw) rotate(-5deg);
  }
  40% {
    transform: translateX(45vw) rotate(4deg);
  }
  55% {
    transform: translateX(60vw) rotate(-4deg);
  }
  70% {
    transform: translateX(80vw) rotate(3deg);
  }
  85% {
    transform: translateX(100vw) rotate(-3deg);
  }
  100% {
    transform: translateX(120vw) rotate(0deg);
    opacity: 0;
  }
}

/* === üåÄ Rick Portal Effect === */
#portal {
  position: fixed;
  bottom: 50%;
  left: -200px;
  width: 200px;
  height: 200px;
  border-radius: 50%;
  background: radial-gradient(circle at 30% 30%, #14f195 0%, #00ffa3 25%, transparent 70%);
  filter: blur(8px) brightness(1.3);
  opacity: 0;
  pointer-events: none;
  z-index: 999;
  transform: scale(0.3);
  animation: none;
}

/* Portal √∂ffnet sich, pulsiert & verschwindet */
@keyframes portalOpen {
  0%   { transform: scale(0.3); opacity: 0; filter: blur(8px); }
  20%  { transform: scale(1); opacity: 1; filter: blur(3px); }
  60%  { transform: scale(1.1); opacity: 1; filter: blur(6px); }
  100% { transform: scale(0.4); opacity: 0; filter: blur(8px); }
}

/* Portal Glow-Loop */
@keyframes portalGlow {
  0%,100% { box-shadow: 0 0 25px rgba(20,241,149,0.5), inset 0 0 25px rgba(0,234,255,0.4); }
  50% { box-shadow: 0 0 45px rgba(20,241,149,0.8), inset 0 0 35px rgba(0,234,255,0.7); }
}

/* Rick mit Wobble-Effect */
#rick {
  position: fixed;
  bottom: 50%;
  left: -200px;
  width: 180px;
  opacity: 0;
  pointer-events: none;
  z-index: 1000;
  transition: opacity 0.6s ease;
  filter: drop-shadow(0 0 12px rgba(0,234,255,0.5));
}

/* Text-Popup */
#rick-text {
  position: fixed;
  bottom: 60%;
  left: 50%;
  transform: translateX(-50%);
  background: white;
  color: black;
  font-weight: 700;
  font-family: "Barlow", sans-serif;
  padding: 10px 20px;
  border-radius: 10px;
  box-shadow: 0 0 20px rgba(255,255,255,0.3);
  opacity: 0;
  z-index: 1100;
  transition: opacity 0.4s ease;
}

</style>
</head>
<body>
<!-- ‚≠ê Partikel/Sterne Canvas -->
<canvas id="particles"></canvas>

<header>
  <div class="h-wrap">
    <div class="brand-wrap">
      <img id="logoImg" src="../img/1boss.png" class="logo-anim" alt="Gobbles">
      <div>
        <div class="brand-main"><span class="g-wobble">G</span>obbles</div>
        <div class="small">Cope Harder!</div>
      </div>

      <!-- üîπ Cobie Home Button -->
      <a href="https://www.cobie.uk/" target="_blank" class="home-link">
        <img src="../img/cobieGif.gif" alt="Cobie" class="cobie-gif">
        <span class="home-text">Cobie Main</span>
      </a>
    </div>

    <div class="header-right-wrap">
      <span class="profile-link">Profile</span>
      <span id="wallet-status" class="status">Not connected</span>
      <button id="connectBtn" class="btn connect-btn">Connect Wallet</button>
    </div>
  </div>
</header>

<!-- Sound for posts -->
<audio id="postSound">
  <source src="../sounds/mgs2.mp3" type="audio/mpeg">
</audio>

<!-- Boom Sound for new posts -->
<audio id="boomSound">
  <source src="../sounds/coin.mp3" type="audio/mpeg">
</audio>

<!-- Rick Easter Egg Sound -->
<audio id="rickSound">
  <source src="../sounds/portal.mp3" type="audio/mpeg">
</audio>

<!-- === Profile Modal === -->
<div id="profileModal" class="modal">
  <div class="modal-content">
    <span class="close-btn" onclick="closeProfile()">&times;</span>
    <div class="profile-body">
      <!-- Left Side -->
      <div class="profile-left">
        <h2>Your Profile</h2>

       <label class="input-label">Profile Image</label>
<img id="avatarPreview" class="avatar-preview" alt="Avatar Preview">

<div class="profile-image-buttons">
  <label for="avatarUpload" class="upload-btn">Upload Image</label>
  <button class="reset-btn" onclick="resetAvatar()">üîÅ Reset to NFT</button>
</div>
<input type="file" id="avatarUpload" accept="image/*" class="file-hidden">
        <input type="file" id="avatarUpload" accept="image/*" class="file-hidden">

        <label class="input-label">About you (max 200 chars)</label>
        <textarea id="bioInput" maxlength="200" class="text-input" placeholder="Write something about yourself..."></textarea>

        <h3 style="margin-top:20px;">Portfolio Allocation</h3>
        
        <div class="input-pair">
          <input type="text" class="text-input asset-input" placeholder="Asset (e.g. Solana)" id="assetInput">
          <input type="number" class="text-input percent-input" placeholder="%" id="percentInput">
        </div>
        
        <div class="portfolio-list" id="portfolioList"></div>
        
        <div class="small" style="color: var(--muted); margin-top: 8px;">
          Press Enter after filling both fields to add assets
        </div>

        <button class="btn" onclick="saveProfile()" style="margin-top: 15px;">üíæ Save Profile</button>
      </div>

      <!-- Right Side -->
      <div class="profile-right">
        <canvas id="portfolioChart"></canvas>
      </div>
    </div>
  </div>
</div>

<main class="container">
  <div class="grid">
    <section>
      <div class="card">
        <div class="body">
          <h3>Create Post</h3>
          <textarea id="postText" maxlength="140" placeholder="What's happening? Use #hashtags for trends!"></textarea>
          <div style="display:flex;gap:12px;align-items:center;margin-top:8px">
            <div class="small">Fee: 0.001 SOL</div>
            <div style="flex:1"></div>
            <button id="postBtn" class="btn">Post</button>
          </div>
        </div>
      </div>

      <div class="card" style="margin-top:12px">
        <div class="body">
          <h3>Community Feed <span id="filterBadge" style="display:none"></span></h3>
        </div>
        <div class="feed-separator"></div>

        <div id="feed"></div>
      </div>
    </section>

    <aside>
      <div class="card">
        <div class="body">
          <h3>Trending</h3>
          <div id="trendBox">
            <div class="small" style="text-align:center;padding:20px;color:var(--muted)">
              No trends yet. Be the first to post with #hashtags!
            </div>
          </div>
          <button id="resetFeedBtn" class="btn" style="margin-top:10px;width:100%;">
            üîÑ Show All Posts
          </button>
        </div>
      </div>

      <div class="card" style="margin-top:12px">
        <div class="body">
          <h3>Sentiment & Trends</h3>
          <div class="input-group">
            <label class="input-label">Search Posts</label>
            <input type="text" class="text-input" placeholder="Enter keyword...">
          </div>
          <div class="input-group">
            <label class="input-label">Filter by User</label>
            <input type="text" class="text-input" placeholder="Wallet address...">
          </div>
        </div>
      </div>
    </aside>
  </div>
</main>

<!-- üåÄ Rick Easter Egg -->
<div id="portal"></div>
<img id="rick" src="../img/rick.png" alt="Rick">
<div id="rick-text">Never go into Crypto, Morty!</div>

<script>
/* ---------- CONFIG ---------- */
const SUPABASE_URL  = "https://nigwdyolfgixcejslaue.supabase.co";
const SUPABASE_ANON = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5pZ3dkeW9sZmdpeGNlanNsYXVlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAwNTMzNzMsImV4cCI6MjA3NTYyOTM3M30.u3g0vzcuF6LstbnsrYyzl1TezJa-lKkd0xk55iddoyw";

const RECEIVER_WALLET = "Eamw917X8VNmH6xuD6mnR9Z5uyganASWRr4aNUU4tomt";
const RPC              = "https://mainnet.helius-rpc.com/?api-key=b5dce25c-09db-45bd-ba9b-d2e2f16fc841";
const HELIUS           = "4e2d8758-0c05-4c6f-9c1d-5a1c2c5d5c5c";

const solanaWeb3 = window.solanaWeb3;

let supabase;
let wallet;
let walletConnected = false;
let currentUser = null;

/* ---------- INIT ---------- */
document.addEventListener("DOMContentLoaded", async () => {
  // Supabase Client
  supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON);

  // Partikel
  initParticles();

  // Wallet Connection
  await checkWalletConnection();

  // Feed laden
  loadFeed();

  // Profile Modal Event
  document.querySelector(".profile-link").addEventListener("click", openProfile);

  // Post Button Event
  document.getElementById("postBtn").addEventListener("click", createPost);

  // Reset Feed Button
  document.getElementById("resetFeedBtn").addEventListener("click", () => {
    loadFeed();
    document.getElementById("filterBadge").style.display = "none";
  });

  // Enter f√ºr Portfolio Inputs
  document.getElementById("assetInput").addEventListener("keypress", (e) => {
    if (e.key === "Enter") addAsset();
  });
  document.getElementById("percentInput").addEventListener("keypress", (e) => {
    if (e.key === "Enter") addAsset();
  });

  // Easter Egg: Logo klickbar f√ºr Rick
  document.getElementById("logoImg").addEventListener("click", triggerRickEasterEgg);

  // üåÄ Dynamic Logo Switcher
  const logoImg = document.getElementById("logoImg");
  const logoImages = [
    "../img/1gobbles.png",
    "../img/1bitcoin.png",
    "../img/1YaoMing.png",
    "../img/1uuuuu.png"
  ];
  let currentLogo = 0;

  // Wir wechseln das Bild jedes Mal, wenn eine komplette Drehung vorbei ist
  // Deine Spin-Animation dauert 9s (siehe CSS)
  setInterval(() => {
    currentLogo = (currentLogo + 1) % logoImages.length;
    logoImg.style.opacity = "0";
    
    // sanfter √úbergang
    setTimeout(() => {
      logoImg.src = logoImages[currentLogo];
      logoImg.style.opacity = "1";
    }, 400);
  }, 9000); // <- gleich zur CSS-Dauer der spinPulse Animation
});

/* ---------- WALLET ---------- */
async function checkWalletConnection() {
  if (window.solana && window.solana.isPhantom) {
    wallet = window.solana;
    try {
      const response = await wallet.connect({ onlyIfTrusted: true });
      if (response.publicKey) {
        walletConnected = true;
        currentUser = response.publicKey.toString();
        document.getElementById("wallet-status").textContent = currentUser.slice(0, 4) + "..." + currentUser.slice(-4);
        document.getElementById("connectBtn").textContent = "Connected";
        document.getElementById("connectBtn").disabled = true;
        loadUserProfile();
      }
    } catch (err) {
      console.log("Not auto-connected:", err);
    }
  }
  document.getElementById("connectBtn").addEventListener("click", connectWallet);
}

async function connectWallet() {
  if (!window.solana) {
    alert("Phantom Wallet not found! Install it from phantom.app.");
    return;
  }
  try {
    const response = await window.solana.connect();
    walletConnected = true;
    currentUser = response.publicKey.toString();
    document.getElementById("wallet-status").textContent = currentUser.slice(0, 4) + "..." + currentUser.slice(-4);
    document.getElementById("connectBtn").textContent = "Connected";
    document.getElementById("connectBtn").disabled = true;
    loadUserProfile();
  } catch (err) {
    console.error("Connection failed:", err);
  }
}

/* ---------- FEED ---------- */
async function loadFeed(filter = null) {
  let query = supabase.from("posts").select("*").order("created_at", { ascending: false });
  
  if (filter && filter.type === "hashtag") {
    query = query.ilike("content", `%${filter.value}%`);
  }
  
  const { data: posts, error } = await query;
  
  if (error) {
    console.error("Error loading feed:", error);
    return;
  }
  
  const feed = document.getElementById("feed");
  feed.innerHTML = "";
  
  if (posts.length === 0) {
    feed.innerHTML = '<div class="small" style="text-align:center;padding:20px;color:var(--muted)">No posts found.</div>';
    return;
  }
  
  posts.forEach((post, index) => {
    const postEl = document.createElement("div");
    postEl.className = "post";
    postEl.style.animationDelay = `${index * 0.05}s`;
    
    // Avatar mit NFT-Halo falls verifiziert
    const avatarClass = post.nft_verified ? "avatar nft-halo" : "avatar";
    
    postEl.innerHTML = `
      <div class="${avatarClass}">
        <img src="${post.avatar_url || '../img/default-avatar.png'}" alt="Avatar">
      </div>
      <div>
        <div style="display:flex;align-items:center;gap:6px;margin-bottom:4px">
          <b>${post.user_name || "Anon"}</b>
          ${post.nft_verified ? '<span style="color:#14F195;font-size:12px">‚úÖ</span>' : ''}
          <span class="muted">${formatTime(post.created_at)}</span>
        </div>
        <div class="post-content">${formatPostContent(post.content)}</div>
        <div class="post-actions">
          <div class="vote-btn" data-post-id="${post.id}" data-vote="up">
            <img src="../img/sol-icon.png" class="sol-icon" alt="SOL"> ${post.upvotes || 0}
          </div>
          <div class="vote-btn" data-post-id="${post.id}" data-vote="down">
            üëé ${post.downvotes || 0}
          </div>
          <div class="icon-btn">üí¨</div>
          <div class="icon-btn">üîÅ</div>
          <button class="tip-btn">Tip 0.001 SOL</button>
        </div>
      </div>
    `;
    
    feed.appendChild(postEl);
    
    // Vote Buttons
    postEl.querySelectorAll(".vote-btn").forEach(btn => {
      btn.addEventListener("click", (e) => {
        e.stopPropagation();
        handleVote(btn.dataset.postId, btn.dataset.vote, btn);
      });
    });
    
    // Tip Button
    const tipBtn = postEl.querySelector(".tip-btn");
    tipBtn.addEventListener("click", (e) => {
      e.stopPropagation();
      handleTip(post.user_wallet, 0.001);
    });
    
    // Hashtag Klicks
    postEl.querySelectorAll(".hashtag").forEach(tag => {
      tag.addEventListener("click", (e) => {
        e.stopPropagation();
        const hashtag = e.target.textContent.slice(1);
        filterFeedByHashtag(hashtag);
      });
    });
  });
  
  // Update Trends
  updateTrends();
}

function formatPostContent(content) {
  // URLs verlinken
  content = content.replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank">$1</a>');
  // Hashtags formatieren
  content = content.replace(/#(\w+)/g, '<span class="hashtag">#$1</span>');
  return content;
}

function formatTime(timestamp) {
  const now = new Date();
  const postTime = new Date(timestamp);
  const diffMs = now - postTime;
  const diffMins = Math.floor(diffMs / 60000);
  const diffHours = Math.floor(diffMs / 3600000);
  
  if (diffMins < 1) return "now";
  if (diffMins < 60) return `${diffMins}m ago`;
  if (diffHours < 24) return `${diffHours}h ago`;
  return `${Math.floor(diffHours / 24)}d ago`;
}

async function handleVote(postId, voteType, button) {
  if (!walletConnected) {
    alert("Connect your wallet to vote!");
    return;
  }
  
  // UI Update
  const postEl = button.closest(".post");
  const upBtn = postEl.querySelector('[data-vote="up"]');
  const downBtn = postEl.querySelector('[data-vote="down"]');
  
  // Reset beide Buttons
  upBtn.classList.remove("active-up");
  downBtn.classList.remove("active-down");
  
  // Aktiviere den geklickten
  if (voteType === "up") {
    button.classList.add("active-up");
  } else {
    button.classList.add("active-down");
  }
  
  // Sound abspielen
  document.getElementById("postSound").play().catch(e => console.log("Sound error:", e));
  
  // In Datenbank updaten (vereinfacht)
  console.log(`Voted ${voteType} on post ${postId}`);
}

async function handleTip(recipientWallet, amount) {
  if (!walletConnected) {
    alert("Connect your wallet to tip!");
    return;
  }
  
  try {
    const connection = new solanaWeb3.Connection(RPC);
    const fromPubkey = wallet.publicKey;
    const toPubkey = new solanaWeb3.PublicKey(recipientWallet);
    const lamports = amount * solanaWeb3.LAMPORTS_PER_SOL;
    
    const transaction = new solanaWeb3.Transaction().add(
      solanaWeb3.SystemProgram.transfer({
        fromPubkey,
        toPubkey,
        lamports,
      })
    );
    
    const { blockhash } = await connection.getRecentBlockhash();
    transaction.recentBlockhash = blockhash;
    transaction.feePayer = fromPubkey;
    
    const signed = await wallet.signTransaction(transaction);
    const signature = await connection.sendRawTransaction(signed.serialize());
    
    console.log("Tip sent:", signature);
    alert(`Tip of ${amount} SOL sent! TX: ${signature}`);
  } catch (err) {
    console.error("Tip failed:", err);
    alert("Tip failed: " + err.message);
  }
}

function filterFeedByHashtag(hashtag) {
  loadFeed({ type: "hashtag", value: `#${hashtag}` });
  
  // Filter Badge anzeigen
  const badge = document.getElementById("filterBadge");
  badge.textContent = `#${hashtag}`;
  badge.className = "active-filter";
  badge.style.display = "inline-block";
}

/* ---------- POST CREATION ---------- */
async function createPost() {
  const content = document.getElementById("postText").value.trim();
  if (!content) {
    alert("Write something first!");
    return;
  }
  
  if (!walletConnected) {
    alert("Connect your wallet to post!");
    return;
  }
  
  // Bezahlung simulieren
  try {
    const connection = new solanaWeb3.Connection(RPC);
    const fromPubkey = wallet.publicKey;
    const toPubkey = new solanaWeb3.PublicKey(RECEIVER_WALLET);
    const lamports = 0.001 * solanaWeb3.LAMPORTS_PER_SOL;
    
    const transaction = new solanaWeb3.Transaction().add(
      solanaWeb3.SystemProgram.transfer({
        fromPubkey,
        toPubkey,
        lamports,
      })
    );
    
    const { blockhash } = await connection.getRecentBlockhash();
    transaction.recentBlockhash = blockhash;
    transaction.feePayer = fromPubkey;
    
    const signed = await wallet.signTransaction(transaction);
    const signature = await connection.sendRawTransaction(signed.serialize());
    
    console.log("Post fee paid:", signature);
    
    // Post in Datenbank speichern
    const { data, error } = await supabase.from("posts").insert([
      {
        user_wallet: currentUser,
        user_name: currentUser.slice(0, 4) + "..." + currentUser.slice(-4),
        content,
        avatar_url: "../img/default-avatar.png",
        nft_verified: false
      }
    ]);
    
    if (error) throw error;
    
    // UI zur√ºcksetzen
    document.getElementById("postText").value = "";
    
    // Boom Sound & Animation
    document.getElementById("boomSound").play().catch(e => console.log("Boom sound error:", e));
    
    // Feed neu laden mit neuem Post als Boom-Animation
    loadFeed();
    
  } catch (err) {
    console.error("Post creation failed:", err);
    alert("Post failed: " + err.message);
  }
}

/* ---------- TRENDS ---------- */
async function updateTrends() {
  const { data: posts, error } = await supabase
    .from("posts")
    .select("content")
    .order("created_at", { ascending: false })
    .limit(100);
  
  if (error) return;
  
  const hashtagCount = {};
  posts.forEach(post => {
    const matches = post.content.match(/#(\w+)/g);
    if (matches) {
      matches.forEach(tag => {
        const cleanTag = tag.toLowerCase();
        hashtagCount[cleanTag] = (hashtagCount[cleanTag] || 0) + 1;
      });
    }
  });
  
  const sortedTrends = Object.entries(hashtagCount)
    .sort((a, b) => b[1] - a[1])
    .slice(0, 5);
  
  const trendBox = document.getElementById("trendBox");
  
  if (sortedTrends.length === 0) {
    trendBox.innerHTML = '<div class="small" style="text-align:center;padding:20px;color:var(--muted)">No trends yet. Be the first to post with #hashtags!</div>';
    return;
  }
  
  trendBox.innerHTML = sortedTrends.map(([tag, count]) => `
    <div class="trend-item" onclick="filterFeedByHashtag('${tag.slice(1)}')">
      ${tag} <span class="trend-count">${count} posts</span>
    </div>
  `).join("");
}

/* ---------- PROFILE MODAL ---------- */
function openProfile() {
  if (!walletConnected) {
    alert("Connect your wallet first!");
    return;
  }
  document.getElementById("profileModal").style.display = "block";
  loadUserProfile();
}

function closeProfile() {
  document.getElementById("profileModal").style.display = "none";
}

async function loadUserProfile() {
  if (!currentUser) return;
  
  // Lade Profil aus localStorage oder DB
  const profile = JSON.parse(localStorage.getItem(`profile_${currentUser}`)) || {};
  
  // Avatar
  document.getElementById("avatarPreview").src = profile.avatar_url || "../img/default-avatar.png";
  
  // Bio
  document.getElementById("bioInput").value = profile.bio || "";
  
  // Portfolio
  const portfolioList = document.getElementById("portfolioList");
  portfolioList.innerHTML = "";
  
  if (profile.portfolio && profile.portfolio.length > 0) {
    profile.portfolio.forEach(asset => {
      const item = document.createElement("div");
      item.className = "portfolio-item";
      item.innerHTML = `
        <span>${asset.name}</span>
        <span>${asset.percent}%</span>
        <span class="remove-asset" onclick="removeAsset('${asset.name}')">√ó</span>
      `;
      portfolioList.appendChild(item);
    });
    
    // Chart updaten
    updatePortfolioChart(profile.portfolio);
  }
}

function addAsset() {
  const assetInput = document.getElementById("assetInput");
  const percentInput = document.getElementById("percentInput");
  
  const name = assetInput.value.trim();
  const percent = parseFloat(percentInput.value);
  
  if (!name || isNaN(percent) || percent <= 0) {
    alert("Please enter valid asset name and percentage!");
    return;
  }
  
  // Lade aktuelles Portfolio
  const profile = JSON.parse(localStorage.getItem(`profile_${currentUser}`)) || {};
  if (!profile.portfolio) profile.portfolio = [];
  
  // F√ºge neues Asset hinzu
  profile.portfolio.push({ name, percent });
  
  // Speichere zur√ºck
  localStorage.setItem(`profile_${currentUser}`, JSON.stringify(profile));
  
  // UI updaten
  loadUserProfile();
  
  // Inputs zur√ºcksetzen
  assetInput.value = "";
  percentInput.value = "";
}

function removeAsset(assetName) {
  const profile = JSON.parse(localStorage.getItem(`profile_${currentUser}`)) || {};
  if (profile.portfolio) {
    profile.portfolio = profile.portfolio.filter(a => a.name !== assetName);
    localStorage.setItem(`profile_${currentUser}`, JSON.stringify(profile));
    loadUserProfile();
  }
}

function updatePortfolioChart(portfolio) {
  const ctx = document.getElementById("portfolioChart").getContext("2d");
  
  // Altes Chart zerst√∂ren falls existiert
  if (window.portfolioChartInstance) {
    window.portfolioChartInstance.destroy();
  }
  
  const labels = portfolio.map(a => a.name);
  const data = portfolio.map(a => a.percent);
  const colors = ["#00eaff", "#9945FF", "#14F195", "#FF6B6B", "#FFD166"];
  
  window.portfolioChartInstance = new Chart(ctx, {
    type: "doughnut",
    data: {
      labels,
      datasets: [{
        data,
        backgroundColor: colors,
        borderColor: colors.map(c => c.replace("0.2", "1")),
        borderWidth: 2
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: {
          position: "bottom",
          labels: { color: "#e9fbff", font: { size: 12 } }
        },
        tooltip: {
          callbacks: {
            label: (ctx) => ` ${ctx.label}: ${ctx.raw}%`
          }
        }
      },
      cutout: "60%"
    }
  });
}

function saveProfile() {
  if (!currentUser) return;
  
  const profile = JSON.parse(localStorage.getItem(`profile_${currentUser}`)) || {};
  profile.bio = document.getElementById("bioInput").value;
  
  localStorage.setItem(`profile_${currentUser}`, JSON.stringify(profile));
  
  alert("Profile saved!");
  closeProfile();
}

// Avatar Upload
document.getElementById("avatarUpload").addEventListener("change", function(e) {
  const file = e.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function(event) {
      const profile = JSON.parse(localStorage.getItem(`profile_${currentUser}`)) || {};
      profile.avatar_url = event.target.result;
      localStorage.setItem(`profile_${currentUser}`, JSON.stringify(profile));
      document.getElementById("avatarPreview").src = event.target.result;
    };
    reader.readAsDataURL(file);
  }
});

function resetAvatar() {
  const profile = JSON.parse(localStorage.getItem(`profile_${currentUser}`)) || {};
  profile.avatar_url = "../img/default-avatar.png";
  localStorage.setItem(`profile_${currentUser}`, JSON.stringify(profile));
  document.getElementById("avatarPreview").src = "../img/default-avatar.png";
}

/* ---------- PARTIKEL-EFFECT ---------- */
function initParticles() {
  const canvas = document.getElementById("particles");
  const ctx = canvas.getContext("2d");
  
  function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }
  resize();
  window.addEventListener("resize", resize);
  
  const particles = [];
  const particleCount = 80;
  
  for (let i = 0; i < particleCount; i++) {
    particles.push({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height,
      size: Math.random() * 2 + 0.5,
      speedX: (Math.random() - 0.5) * 0.5,
      speedY: (Math.random() - 0.5) * 0.5,
      opacity: Math.random() * 0.5 + 0.1
    });
  }
  
  function animate() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    particles.forEach(p => {
      p.x += p.speedX;
      p.y += p.speedY;
      
      if (p.x < 0 || p.x > canvas.width) p.speedX *= -1;
      if (p.y < 0 || p.y > canvas.height) p.speedY *= -1;
      
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
      ctx.fillStyle = `rgba(173, 216, 230, ${p.opacity})`;
      ctx.fill();
    });
    
    requestAnimationFrame(animate);
  }
  
  animate();
}

/* ---------- üåÄ RICK EASTER EGG ---------- */
function triggerRickEasterEgg() {
  const rickSound = document.getElementById("rickSound");
  const portal = document.getElementById("portal");
  const rick = document.getElementById("rick");
  const rickText = document.getElementById("rick-text");
  
  // Sound abspielen
  rickSound.play().catch(e => console.log("Rick sound failed:", e));
  
  // Portal Animation
  portal.style.opacity = "1";
  portal.style.animation = "portalOpen 2.8s ease-out, portalGlow 3s ease-in-out infinite";

  // üåÄ Nur EINE saubere Animation!
  rick.style.opacity = "1";
  rick.style.animation = "rickFlyAndWobble 6s ease-in-out forwards";

  // Text erscheint nach 2.3s
  setTimeout(() => {
    rickText.style.opacity = "1";
  }, 2300);

  // Text verschwindet nach 5.3s
  setTimeout(() => {
    rickText.style.opacity = "0";
  }, 5300);

  // Alles zur√ºcksetzen nach 7s
  setTimeout(() => {
    portal.style.animation = "none";
    portal.style.opacity = "0";
    rick.style.animation = "none";
    rick.style.opacity = "0";
  }, 7000);
}
</script>
</body>
</html>
