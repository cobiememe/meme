<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Web3 NFT Cube Gallery</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      overflow: hidden;
      background: #000;
      color: #fff;
      font-family: 'Courier New', monospace;
    }

    canvas {
      display: block;
    }

    /* ===== TITLE SCREEN ===== */
    #title-screen {
      position: fixed;
      inset: 0;
      background: #000;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: opacity 1s;
    }

    #title-screen.hidden {
      opacity: 0;
      pointer-events: none;
    }

    #title-canvas {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
    }

    .title-content {
      position: relative;
      z-index: 10;
      text-align: center;
    }

    .main-title {
      font-size: 72px;
      font-weight: bold;
      color: #00eaff;
      text-shadow: 
        0 0 10px #00eaff,
        0 0 20px #00eaff,
        0 0 40px #00eaff,
        0 0 80px #00eaff;
      margin-bottom: 20px;
      animation: glow 2s ease-in-out infinite alternate;
      letter-spacing: 8px;
    }

    @keyframes glow {
      from {
        text-shadow: 
          0 0 10px #00eaff,
          0 0 20px #00eaff,
          0 0 40px #00eaff,
          0 0 80px #00eaff;
      }
      to {
        text-shadow: 
          0 0 20px #00eaff,
          0 0 30px #00eaff,
          0 0 60px #00eaff,
          0 0 100px #00eaff,
          0 0 140px #00eaff;
      }
    }

    .subtitle {
      font-size: 16px;
      color: #00eaff;
      opacity: 0.7;
      animation: pulse 2s ease-in-out infinite;
      letter-spacing: 3px;
      text-transform: uppercase;
    }

    @keyframes pulse {
      0%, 100% { opacity: 0.5; }
      50% { opacity: 1; }
    }

    /* ===== MAIN UI ===== */
    #ui {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 100;
      opacity: 0;
      transition: opacity 1s 1s;
    }

    #ui.visible {
      opacity: 1;
    }

    #wallet-btn {
      padding: 12px 24px;
      background: rgba(0, 234, 255, 0.2);
      border: 2px solid #00eaff;
      color: #00eaff;
      font-weight: bold;
      cursor: pointer;
      border-radius: 8px;
      font-size: 14px;
      transition: all 0.3s;
      text-shadow: 0 0 10px #00eaff;
    }

    #wallet-btn:hover {
      background: #00eaff;
      color: #000;
      box-shadow: 0 0 20px #00eaff;
    }

    #info {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background: rgba(0, 0, 0, 0.7);
      padding: 15px;
      border-radius: 8px;
      border: 1px solid #00eaff;
      font-size: 12px;
      color: #00eaff;
      opacity: 0;
      transition: opacity 1s 1s;
    }

    #info.visible {
      opacity: 1;
    }

    #info h3 {
      margin: 0 0 10px 0;
      font-size: 14px;
    }

    .cube-label {
      position: fixed;
      background: rgba(0, 234, 255, 0.9);
      color: #000;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: bold;
      pointer-events: none;
      display: none;
    }
  </style>

  <script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three@0.161.0/build/three.module.min.js",
        "three/addons/": "https://unpkg.com/three@0.161.0/examples/jsm/"
      }
    }
  </script>
</head>

<body>
  <!-- TITLE SCREEN -->
  <div id="title-screen">
    <canvas id="title-canvas"></canvas>
    <div class="title-content">
      <h1 class="main-title">COBIE'S NFT SPACE</h1>
      <p class="subtitle">Click to continue</p>
    </div>
  </div>

  <!-- MAIN UI -->
  <div id="ui">
    <button id="wallet-btn">Connect Phantom Wallet</button>
  </div>

  <div id="info">
    <h3>🎨 NFT Cube Gallery</h3>
    <p>Click on a cube to mint NFT</p>
    <p>Cost: 0.001 SOL</p>
  </div>

  <div id="cube-label" class="cube-label"></div>

  <!-- AUDIO -->
  <audio id="background-music" loop>
    <source src="https://raw.githubusercontent.com/cobiememe/meme/main/sounds/Mystic7.mp3" type="audio/mpeg">
  </audio>

  <script type="module">
    import * as THREE from "three";
    import { OrbitControls } from "three/addons/controls/OrbitControls.js";

    // ===== TITLE SCREEN LASER ANIMATION =====
    const titleCanvas = document.getElementById('title-canvas');
    const titleCtx = titleCanvas.getContext('2d');
    
    // IMPORTANT: Define this FIRST before using it
    let titleScreenHidden = false;
    let animationStarted = false;
    
    function resizeTitleCanvas() {
      titleCanvas.width = window.innerWidth;
      titleCanvas.height = window.innerHeight;
    }
    resizeTitleCanvas();
    window.addEventListener('resize', resizeTitleCanvas);

    // Laser particles
    const lasers = [];
    for (let i = 0; i < 100; i++) {
      lasers.push({
        x: Math.random() * titleCanvas.width,
        y: Math.random() * titleCanvas.height,
        vx: (Math.random() - 0.5) * 2,
        vy: (Math.random() - 0.5) * 2,
        size: Math.random() * 2 + 1,
        color: Math.random() > 0.5 ? '#00eaff' : '#ff00ff'
      });
    }

    function animateTitleScreen() {
      if (!titleScreenHidden) {
        titleCtx.fillStyle = 'rgba(0, 0, 0, 0.05)';
        titleCtx.fillRect(0, 0, titleCanvas.width, titleCanvas.height);

        lasers.forEach(laser => {
          laser.x += laser.vx;
          laser.y += laser.vy;

          if (laser.x < 0 || laser.x > titleCanvas.width) laser.vx *= -1;
          if (laser.y < 0 || laser.y > titleCanvas.height) laser.vy *= -1;

          titleCtx.beginPath();
          titleCtx.arc(laser.x, laser.y, laser.size, 0, Math.PI * 2);
          titleCtx.fillStyle = laser.color;
          titleCtx.shadowBlur = 20;
          titleCtx.shadowColor = laser.color;
          titleCtx.fill();
        });

        // Draw laser lines between close particles
        for (let i = 0; i < lasers.length; i++) {
          for (let j = i + 1; j < lasers.length; j++) {
            const dx = lasers[i].x - lasers[j].x;
            const dy = lasers[i].y - lasers[j].y;
            const dist = Math.sqrt(dx * dx + dy * dy);

            if (dist < 150) {
              titleCtx.beginPath();
              titleCtx.strokeStyle = `rgba(0, 234, 255, ${1 - dist / 150})`;
              titleCtx.lineWidth = 0.5;
              titleCtx.moveTo(lasers[i].x, lasers[i].y);
              titleCtx.lineTo(lasers[j].x, lasers[j].y);
              titleCtx.stroke();
            }
          }
        }
        
        requestAnimationFrame(animateTitleScreen);
      }
    }
    animateTitleScreen();

    // ===== TITLE SCREEN CLICK =====
    const titleScreen = document.getElementById('title-screen');
    const bgMusic = document.getElementById('background-music');

    titleScreen.addEventListener('click', () => {
      console.log('Title screen clicked!'); // Debug
      titleScreenHidden = true;
      titleScreen.classList.add('hidden');
      document.getElementById('ui').classList.add('visible');
      document.getElementById('info').classList.add('visible');
      
      // Start music
      bgMusic.play().catch(e => console.log('Music autoplay blocked:', e));
      
      setTimeout(() => {
        titleScreen.style.display = 'none';
      }, 1000);
      
      // Start 3D animation
      if (!animationStarted) {
        animationStarted = true;
        animate();
      }
    });

    // ===== SCENE SETUP =====
    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(window.devicePixelRatio);
    renderer.shadowMap.enabled = true;
    document.body.appendChild(renderer.domElement);

    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x0a0a0f);
    scene.fog = new THREE.Fog(0x0a0a0f, 10, 50);

    const camera = new THREE.PerspectiveCamera(
      75,
      window.innerWidth / window.innerHeight,
      0.1,
      1000
    );
    camera.position.set(8, 6, 8);

    // ===== CONTROLS =====
    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.05;
    controls.minDistance = 5;
    controls.maxDistance = 30;

    // ===== LIGHTS =====
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.3);
    scene.add(ambientLight);

    const mainLight = new THREE.DirectionalLight(0x00eaff, 1);
    mainLight.position.set(5, 10, 5);
    mainLight.castShadow = true;
    scene.add(mainLight);

    const pointLight1 = new THREE.PointLight(0xff00ff, 0.5, 20);
    pointLight1.position.set(-5, 3, -5);
    scene.add(pointLight1);

    const pointLight2 = new THREE.PointLight(0x00ff88, 0.5, 20);
    pointLight2.position.set(5, 3, 5);
    scene.add(pointLight2);

    // ===== GRID FLOOR =====
    const gridHelper = new THREE.GridHelper(30, 30, 0x00eaff, 0x004466);
    scene.add(gridHelper);

    // ===== CREATE FLOATING CUBES =====
    const cubes = [];
    const cubeGeometry = new THREE.BoxGeometry(1, 1, 1);

    // Create 12 cubes in a circular pattern
    const numCubes = 12;
    const radius = 6;

    for (let i = 0; i < numCubes; i++) {
      const angle = (i / numCubes) * Math.PI * 2;
      const x = Math.cos(angle) * radius;
      const z = Math.sin(angle) * radius;
      const y = Math.sin(i * 0.5) * 2 + 2;

      // Random vibrant colors
      const colors = [0x00eaff, 0xff00ff, 0x00ff88, 0xffaa00, 0xff0066, 0x00ffff];
      const color = colors[i % colors.length];

      const material = new THREE.MeshStandardMaterial({
        color: color,
        emissive: color,
        emissiveIntensity: 0.3,
        metalness: 0.7,
        roughness: 0.3
      });

      const cube = new THREE.Mesh(cubeGeometry, material);
      cube.position.set(x, y, z);
      cube.castShadow = true;
      cube.userData = {
        id: i,
        originalY: y,
        speed: 0.3 + Math.random() * 0.5,
        rotSpeed: 0.01 + Math.random() * 0.02,
        isMinted: false
      };

      scene.add(cube);
      cubes.push(cube);
    }

    // ===== RAYCASTER FOR CLICKING =====
    const raycaster = new THREE.Raycaster();
    const mouse = new THREE.Vector2();
    let hoveredCube = null;

    // ===== WALLET STATE =====
    let walletConnected = false;
    let walletAddress = null;

    // ===== WALLET FUNCTIONS =====
    function getProvider() {
      return window.phantom?.solana || window.solana || null;
    }

    async function connectWallet() {
      const provider = getProvider();
      if (!provider) {
        alert('⚠️ Phantom Wallet not found! Please install it.');
        return;
      }

      try {
        const response = await provider.connect();
        walletAddress = response.publicKey.toString();
        walletConnected = true;
        
        document.getElementById('wallet-btn').textContent = 
          `✅ ${walletAddress.slice(0, 4)}...${walletAddress.slice(-4)}`;
        
        console.log('✅ Wallet connected:', walletAddress);
      } catch (err) {
        console.error('❌ Connection failed:', err);
      }
    }

    document.getElementById('wallet-btn').addEventListener('click', connectWallet);

    // ===== MOUSE EVENTS =====
    function onMouseMove(event) {
      if (titleScreenHidden) {
        mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
        mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

        raycaster.setFromCamera(mouse, camera);
        const intersects = raycaster.intersectObjects(cubes);

        // Reset previous hover
        if (hoveredCube) {
          hoveredCube.material.emissiveIntensity = 0.3;
          document.getElementById('cube-label').style.display = 'none';
        }

        if (intersects.length > 0) {
          hoveredCube = intersects[0].object;
          hoveredCube.material.emissiveIntensity = 0.8;
          
          // Show label
          const label = document.getElementById('cube-label');
          label.textContent = hoveredCube.userData.isMinted 
            ? `Cube #${hoveredCube.userData.id} - MINTED ✅` 
            : `Cube #${hoveredCube.userData.id} - Click to Mint`;
          label.style.display = 'block';
          label.style.left = event.clientX + 15 + 'px';
          label.style.top = event.clientY + 15 + 'px';
          
          renderer.domElement.style.cursor = 'pointer';
        } else {
          hoveredCube = null;
          renderer.domElement.style.cursor = 'default';
        }
      }
    }

    function onMouseClick(event) {
      if (!titleScreenHidden || !hoveredCube) return;

      if (!walletConnected) {
        alert('⚠️ Please connect your wallet first!');
        return;
      }

      if (hoveredCube.userData.isMinted) {
        alert('❌ This cube is already minted!');
        return;
      }

      // Simulate minting
      const cubeId = hoveredCube.userData.id;
      console.log(`🎨 Minting Cube #${cubeId}...`);
      
      // Mark as minted
      hoveredCube.userData.isMinted = true;
      hoveredCube.material.emissive = new THREE.Color(0xffd700);
      
      alert(`✅ Successfully minted Cube #${cubeId}!\n(Payment logic will be added)`);
    }

    window.addEventListener('mousemove', onMouseMove);
    window.addEventListener('click', onMouseClick);

    // ===== RESPONSIVE =====
    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });

    // ===== ANIMATION LOOP =====
    function animate() {
      requestAnimationFrame(animate);

      // Animate cubes - floating motion
      cubes.forEach((cube) => {
        cube.position.y = 
          cube.userData.originalY + 
          Math.sin(Date.now() * 0.001 * cube.userData.speed) * 0.5;
        
        cube.rotation.x += cube.userData.rotSpeed;
        cube.rotation.y += cube.userData.rotSpeed * 0.7;
      });

      // Animate lights
      pointLight1.position.x = Math.sin(Date.now() * 0.001) * 8;
      pointLight1.position.z = Math.cos(Date.now() * 0.001) * 8;
      
      pointLight2.position.x = Math.cos(Date.now() * 0.0015) * 8;
      pointLight2.position.z = Math.sin(Date.now() * 0.0015) * 8;

      controls.update();
      renderer.render(scene, camera);
    }
    
    // Animation will be started by title screen click
  </script>
</body>
</html>