<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Cobie's MemeMarket ‚Äî KITTY Boost</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root{
    --neon:#00eaff; --neon2:#00bfff; --panel:#0a0f16cc;
    --ink:#d7faff; --accent:#7bffb9;
    --solana1:#9945FF; --solana2:#14F195; --solana3:#00FFA3;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:#000;color:var(--ink);
    font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,"Helvetica Neue",Arial;overflow:hidden;}
  #bg{position:fixed;inset:0;z-index:0;pointer-events:none;}
  .header{position:fixed;top:24px;left:32px;z-index:2;}
  .brand{font-family:'Orbitron',ui-monospace,monospace;font-size:28px;letter-spacing:2px;color:var(--neon);
    text-shadow:0 0 6px var(--neon),0 0 16px var(--neon2),0 0 28px var(--neon2);
    animation:breathe 3.2s ease-in-out infinite,flicker 4s infinite;user-select:none;}
  @keyframes breathe{0%{transform:scale(1)}50%{transform:scale(1.06)}100%{transform:scale(1)}}
  @keyframes flicker{0%,18%,22%,25%,53%,57%,100%{opacity:1}20%,24%,55%{opacity:.7}}
  .laser{position:relative;height:3px;margin-top:6px;width:280px;
    background:linear-gradient(90deg,rgba(0,234,255,.2),rgba(0,234,255,.05));
    overflow:hidden;border-radius:2px;box-shadow:0 0 10px rgba(0,234,255,.3);}
  .laser::before{content:"";position:absolute;top:0;left:-110%;height:100%;width:110%;
    background:linear-gradient(90deg,transparent,var(--neon),transparent);
    animation:laser 3.2s linear infinite;}
  @keyframes laser{0%{left:-110%}50%{left:0}100%{left:110%}}
  .wallet-btn{position:fixed;top:24px;right:32px;z-index:3;padding:10px 18px;border-radius:10px;
    cursor:pointer;font-weight:700;letter-spacing:.4px;color:var(--neon);border:2px solid var(--neon);
    background:transparent;text-shadow:0 0 6px var(--neon);transition:all .25s;}
  .wallet-btn:hover{background:var(--neon);color:#000;box-shadow:0 0 16px var(--neon);}
  .wrap{position:relative;z-index:1;height:100%;width:100%;display:flex;align-items:center;justify-content:center;
    padding:96px 24px 24px;}
  .panel{width:min(980px,92vw);background:linear-gradient(180deg,rgba(17,24,39,.65),rgba(7,10,16,.75));
    border:1px solid rgba(255,255,255,.08);border-radius:16px;
    box-shadow:0 0 0 1px rgba(0,0,0,.3) inset,0 0 32px rgba(153,69,255,.25),0 0 64px rgba(0,255,163,.12);
    backdrop-filter:blur(6px);padding:18px;}
  .panel-head{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:6px 6px 12px 6px;}
  .badge{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;
    background:linear-gradient(90deg,rgba(153,69,255,.25),rgba(0,255,163,.12));
    border:1px solid rgba(255,255,255,.08);font-weight:600;font-size:13px;letter-spacing:.5px;color:#e6fffb;
    text-shadow:0 0 6px rgba(0,255,163,.4);}
  .actions{display:flex;gap:10px}
  .btn{appearance:none;border:none;cursor:pointer;padding:10px 14px;border-radius:10px;
    background:linear-gradient(135deg,rgba(0,255,163,.15),rgba(153,69,255,.15));color:#dff;font-weight:700;
    letter-spacing:.3px;box-shadow:0 0 0 1px rgba(255,255,255,.08) inset,0 6px 20px rgba(0,255,163,.15);
    transition:transform .15s ease,filter .2s ease;}
  .btn:hover{transform:translateY(-1px);filter:brightness(1.1)}
  .btn:disabled{opacity:0.5;cursor:not-allowed;transform:none;}
  .head,.row{display:grid;grid-template-columns:50px 1fr 150px 120px;align-items:center;gap:12px;}
  .head{font-size:12px;text-transform:uppercase;letter-spacing:.8px;color:#9fe;opacity:.8;padding:6px 10px;
    border-bottom:1px solid rgba(255,255,255,.08);font-weight:600;}
  .list{display:flex;flex-direction:column;gap:8px;padding:8px}
  .row{padding:10px 12px;border-radius:12px;
    background:linear-gradient(90deg,rgba(255,255,255,.02),rgba(255,255,255,.03));
    border:1px solid rgba(255,255,255,.06);transition:transform .25s,box-shadow .25s,background .25s;}
  .row:hover{transform:translateY(-2px);
    box-shadow:0 10px 30px rgba(0,255,163,.12),0 0 30px rgba(153,69,255,.15);
    background:linear-gradient(90deg,rgba(20,255,195,.06),rgba(153,69,255,.05));}
  .rank{font-weight:800;font-size:18px;color:#bff;text-shadow:0 0 8px rgba(0,255,163,.4)}
  .coin{display:flex;align-items:center;gap:12px;font-weight:700;color:#eaffff}
  .icon{width:34px;height:34px;border-radius:50%;background:conic-gradient(from 120deg,var(--solana1),var(--solana2),var(--solana3),var(--solana1));
    box-shadow:0 0 16px rgba(0,255,163,.35);display:grid;place-items:center;color:#001510;font-weight:900;font-size:13px;}
  .name{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .score{font-variant-numeric:tabular-nums;color:#cffff8;font-weight:800}
  .boost{justify-self:end}.boost .btn{padding:9px 12px}
  .gold{color:gold}.silver{color:silver}.bronze{color:#cd7f32}
</style>
</head>
<body>
  <canvas id="bg"></canvas>

  <div class="header"><div class="brand">Cobie's MemeWorld</div><div class="laser"></div></div>
  <button class="wallet-btn" id="connectBtn">Connect Wallet</button>

  <div class="wrap">
    <div class="panel">
      <div class="panel-head">
        <div class="badge" id="wallet-status">Not connected</div>
        <div class="actions">
          <button class="btn" id="addCoinBtn">‚ûï Add Coin (0.01 KITTY)</button>
        </div>
      </div>
      <div class="head"><div>#</div><div>Coin</div><div>Score</div><div></div></div>
      <div class="list" id="list"></div>
    </div>
  </div>

<script type="importmap">
{
  "imports": {
    "@solana/web3.js": "https://esm.sh/@solana/web3.js@1.87.6",
    "@solana/spl-token": "https://esm.sh/@solana/spl-token@0.3.11"
  }
}
</script>

<script type="module">
/* ---------------- Particles BG ---------------- */
const bg=document.getElementById('bg');
const bctx=bg.getContext('2d');
let P=[];
function resizeBG(){bg.width=innerWidth;bg.height=innerHeight}
addEventListener('resize',resizeBG);resizeBG();
for(let i=0;i<120;i++){
  P.push({x:Math.random()*bg.width,y:Math.random()*bg.height,r:Math.random()*2+0.5,
  vx:(Math.random()-.5)*.35,vy:(Math.random()-.5)*.35,a:Math.random()*.9+.1});
}
(function tick(){bctx.clearRect(0,0,bg.width,bg.height);
  P.forEach(p=>{p.x+=p.vx;p.y+=p.vy;
  if(p.x<0)p.x=bg.width;if(p.x>bg.width)p.x=0;
  if(p.y<0)p.y=bg.height;if(p.y>bg.height)p.y=0;
  bctx.fillStyle=`rgba(0,234,255,${p.a})`;bctx.beginPath();
  bctx.arc(p.x,p.y,p.r,0,Math.PI*2);bctx.fill();});
  requestAnimationFrame(tick);
})();

/* ---------------- UI + Daten ---------------- */
const list=document.getElementById('list');
const addCoinBtn=document.getElementById('addCoinBtn');
const connectBtn=document.getElementById('connectBtn');
const statusBadge=document.getElementById('wallet-status');

let coins=[];

function rowTemplate(c, idx){
  return `
  <div class="row" data-sym="${c.sym}">
    <div class="rank">${idx+1}</div>
    <div class="coin">
      <div class="icon">${c.sym.slice(0,3)}</div>
      <div class="name">${c.name}</div>
    </div>
    <div class="score">${c.score} COT</div>
    <div class="boost"><button class="btn" data-boost="${idx}">Boost +0.001</button></div>
  </div>`;
}
function render(){
  coins.sort((a,b)=>b.score-a.score);
  list.innerHTML = coins.map((c,i)=>rowTemplate(c,i)).join('');
}

/* ---------------- Phantom Wallet ---------------- */
function getProvider(){
  const w=window;
  return w.phantom?.solana || w.solana || null;
}
function setUIConnected(keyStr){
  statusBadge.textContent = "‚úÖ " + keyStr.slice(0,6) + "..." + keyStr.slice(-4);
  connectBtn.textContent = "Disconnect";
}
function setUIDisconnected(msg="Not connected"){
  statusBadge.textContent = msg;
  connectBtn.textContent = "Connect Wallet";
}
async function connectWallet(){
  const p=getProvider();
  if(!p){ alert("‚ö†Ô∏è Phantom Wallet nicht gefunden."); return; }
  try{
    const { publicKey } = await p.connect({ onlyIfTrusted:false });
    setUIConnected(publicKey.toString());
    if(!p.__bound){
      p.on("disconnect", ()=> setUIDisconnected("üîå Disconnected"));
      p.__bound=true;
    }
  }catch(e){
    console.error("Connect fail:", e);
    setUIDisconnected("‚ùå Connection failed");
  }
}
async function disconnectWallet(){
  const p=getProvider(); if(!p) return;
  try{ await p.disconnect(); setUIDisconnected("üîå Disconnected"); }catch(e){ console.error(e); }
}
connectBtn.addEventListener("click", async ()=>{
  const p=getProvider();
  if(p?.isConnected){ await disconnectWallet(); } else { await connectWallet(); }
});
window.addEventListener("load", ()=>{
  const p=getProvider();
  if(p?.isConnected){ setUIConnected(p.publicKey.toString()); } else { setUIDisconnected(); }
});

/* ---------------- Solana Tx: KITTY senden (Mainnet mit Helius) ---------------- */
import { Connection, PublicKey, Transaction } from '@solana/web3.js';
import { 
  getAssociatedTokenAddress, 
  createAssociatedTokenAccountInstruction, 
  getMint, 
  createTransferCheckedInstruction 
} from '@solana/spl-token';

// üîß RPC Konfiguration
const USE_MAINNET = true; // Setze auf true f√ºr Mainnet
const HELIUS_API_KEY = 'b5dce25c-09db-45bd-ba9b-d2e2f16fc841';

const RPC_URL = USE_MAINNET 
  ? `https://mainnet.helius-rpc.com/?api-key=${HELIUS_API_KEY}`
  : 'https://api.devnet.solana.com';

const KITTY_MINT_STR = 'DFfPq2hHbJeunp1F6eNyuyvBHcPpnTqaawn2tAFUpump';
const RECEIVER_STR = 'VAFSijooNotLkH6i6Exzw7HcsHGz7ZFjgLZLqpiDBEu';

console.log('üåê Using RPC:', RPC_URL);
console.log('üîó Network:', USE_MAINNET ? 'MAINNET' : 'DEVNET');

async function sendKITTY(amount){
  const p=getProvider();
  if(!p?.isConnected){ 
    alert("Bitte zuerst Wallet verbinden."); 
    return false; 
  }

  addCoinBtn?.setAttribute('disabled','disabled');
  list.querySelectorAll('button').forEach(b=>b.setAttribute('disabled','disabled'));
  statusBadge.textContent = '‚è≥ Sending ' + amount + ' KITTY...';

  try{
    console.log('üöÄ Starting transaction...');
    
    const conn = new Connection(RPC_URL, 'confirmed');
    const MINT = new PublicKey(KITTY_MINT_STR);
    const RECEIVER = new PublicKey(RECEIVER_STR);
    const SENDER = p.publicKey;

    if (!SENDER) {
      throw new Error('Sender-PublicKey nicht verf√ºgbar.');
    }

    console.log('üìç SENDER:', SENDER.toString());
    console.log('üìç RECEIVER:', RECEIVER.toString());
    console.log('üìç MINT:', MINT.toString());

    // Token Accounts
    const sATA = await getAssociatedTokenAddress(MINT, SENDER);
    const rATA = await getAssociatedTokenAddress(MINT, RECEIVER);
    
    console.log('üîë Sender ATA:', sATA.toString());
    console.log('üîë Receiver ATA:', rATA.toString());

    const ixs = [];

    // Check if ATAs exist
    const sInfo = await conn.getAccountInfo(sATA);
    if(!sInfo){
      console.log('‚ö†Ô∏è Creating sender ATA...');
      ixs.push(createAssociatedTokenAccountInstruction(
        SENDER, sATA, SENDER, MINT
      ));
    }
    
    const rInfo = await conn.getAccountInfo(rATA);
    if(!rInfo){
      console.log('‚ö†Ô∏è Creating receiver ATA...');
      ixs.push(createAssociatedTokenAccountInstruction(
        SENDER, rATA, RECEIVER, MINT
      ));
    }

    // Get decimals
    const mintInfo = await getMint(conn, MINT);
    const dec = mintInfo.decimals;
    console.log('üí∞ Token decimals:', dec);

    // Calculate amount
    const amt = BigInt(Math.floor(amount * (10 ** dec)));
    console.log('üí∏ Sending amount:', amt.toString(), 'base units');

    // Create transfer instruction
    ixs.push(createTransferCheckedInstruction(
      sATA, MINT, rATA, SENDER, amt, dec
    ));

    console.log('üì¶ Instructions:', ixs.length);

    // Build transaction
    const tx = new Transaction().add(...ixs);
    tx.feePayer = SENDER;
    
    const { blockhash } = await conn.getLatestBlockhash();
    tx.recentBlockhash = blockhash;

    console.log('‚úçÔ∏è Signing transaction...');
    const signed = await p.signTransaction(tx);
    
    if (!signed) {
      throw new Error('Transaction signing failed');
    }

    console.log('üì§ Sending transaction...');
    const sig = await conn.sendRawTransaction(signed.serialize(), {
      skipPreflight: false,
      preflightCommitment: 'confirmed'
    });
    
    console.log('‚è≥ Confirming transaction:', sig);
    await conn.confirmTransaction(sig, 'confirmed');

    console.log('‚úÖ Transaction confirmed!');
    console.log('üîó Signature:', sig);
    console.log('üîó Explorer:', `https://solscan.io/tx/${sig}`);
    statusBadge.textContent = '‚úÖ Tx confirmed!';
    return true;
    
  }catch(e){
    console.error('‚ùå Transfer failed:', e);
    alert('Transfer failed: ' + (e?.message || String(e)));
    statusBadge.textContent = '‚ùå Transfer failed';
    return false;
  }finally{
    addCoinBtn?.removeAttribute('disabled');
    list.querySelectorAll('button').forEach(b=>b.removeAttribute('disabled'));
  }
}

/* ---------------- Add Coin / Boost ---------------- */
if(addCoinBtn){
  addCoinBtn.addEventListener('click', async ()=>{
    const ok = await sendKITTY(0.01);
    if(!ok) return;
    const name = prompt('Name deines Coins?');
    if(!name) return;
    coins.push({ sym: name.slice(0,3).toUpperCase(), name, score: 0 });
    render();
  });
}

list.addEventListener('click', async (e)=>{
  const idx = e.target?.dataset?.boost;
  if(idx === undefined) return;
  const ok = await sendKITTY(0.001);
  if(!ok) return;
  coins[idx].score += 10;
  render();
});

/* initial */
render();
</script>
</body>
</html>