<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Cobie's MemeMarket ‚Äî Token Boost</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="icon" href="data:;base64,iVBORwKGgo="> <!-- Leeres Favicon, um 404 zu vermeiden -->
<style>
  /* [Vorheriger CSS bleibt unver√§ndert] */
</style>
</head>
<body>
  <canvas id="bg"></canvas>
  <div class="header"><div class="brand">Cobie's MemeWorld</div><div class="laser"></div></div>
  <button class="wallet-btn" id="connectBtn">Connect Wallet</button>
  <div class="wrap">
    <div class="panel">
      <div class="panel-head">
        <div class="badge" id="wallet-status">Not connected</div>
        <div class="actions"><button class="btn" id="addCoinBtn">‚ûï Add Token</button></div>
      </div>
      <div class="head"><div>#</div><div>Token</div><div>Score (COT)</div><div></div></div>
      <div class="list" id="list"></div>
    </div>
  </div>
  <div class="modal" id="addModal">
    <div class="modal-content">
      <h2>üöÄ Add Solana Token</h2>
      <div class="cost-info">üí∞ Cost: 0.001 SOL to list a token</div>
      <label>Token Mint Address (44 characters)</label>
      <input type="text" id="tokenMint" placeholder="e.g. DFfPq2hHbJeunp1F6eNyuyvBHcPpnTqaawn2tAFUpump" maxlength="44" />
      <button class="btn" id="fetchTokenInfo" style="margin-bottom:16px;width:100%;">üîç Fetch Token Info</button>
      <div id="tokenInfoDisplay" class="token-info" style="display:none;">
        <strong>Token found!</strong><br>Symbol: <span id="displaySymbol">-</span><br>
        Name: <span id="displayName">-</span><br>Decimals: <span id="displayDecimals">-</span>
      </div>
      <label>Description (max 200 chars)</label>
      <textarea id="tokenDesc" placeholder="Tell us about your token..." maxlength="200" rows="3"></textarea>
      <div class="char-count"><span id="charCount">0</span>/200 characters</div>
      <label>Initial Score (COT)</label>
      <input type="number" id="coinScore" value="10" min="0" />
      <div class="modal-actions">
        <button class="btn" id="modalClose">Cancel</button>
        <button class="btn btn-primary" id="modalConfirm" disabled>Add Token (Pay 0.001 SOL)</button>
      </div>
    </div>
  </div>
  <div class="modal" id="boostModal">
    <div class="modal-content">
      <h2>‚ö° Boost Token</h2>
      <div class="cost-info">üí∞ Cost: 0.001 SOL for +10 boost</div>
      <label>Token</label>
      <input type="text" id="boostCoinName" readonly style="background:rgba(0,0,0,.3);" />
      <label>Boost Amount (COT)</label>
      <input type="number" id="boostAmount" value="10" min="1" />
      <div class="modal-actions">
        <button class="btn" id="boostModalClose">Cancel</button>
        <button class="btn btn-primary" id="boostModalConfirm">Boost (Pay 0.001 SOL)</button>
      </div>
    </div>
  </div>
  <div class="modal detail-modal" id="detailModal">
    <div class="modal-content">
      <div class="detail-header">
        <div class="detail-icon" id="detailIcon">?</div>
        <div class="detail-title"><h3 id="detailName">Token</h3><p id="detailSymbol">SYM</p></div>
      </div>
      <div class="detail-stats">
        <div class="stat-box"><div class="stat-label">Rank</div><div class="stat-value" id="detailRank">#1</div></div>
        <div class="stat-box"><div class="stat-label">Score</div><div class="stat-value" id="detailScore">0 COT</div></div>
      </div>
      <div class="detail-section"><h4>üìù Description</h4><p id="detailDesc">No description.</p></div>
      <div class="detail-section"><h4>üîó Mint Address</h4><p id="detailMint" style="word-break:break-all;font-size:12px;font-family:monospace;">-</p></div>
      <div class="modal-actions">
        <button class="btn" id="detailClose">Close</button>
        <button class="btn btn-primary" id="detailBoost">‚ö° Boost This Token</button>
      </div>
    </div>
  </div>
<script type="importmap">
{"imports":{"@solana/web3.js":"https://esm.sh/@solana/web3.js@1.87.6","@solana/spl-token":"https://esm.sh/@solana/spl-token@0.3.11"}}
</script>
<script type="module">
const bg = document.getElementById('bg'), bctx = bg.getContext('2d');
let P = [];
function resizeBG() { bg.width = innerWidth; bg.height = innerHeight }
addEventListener('resize', resizeBG); resizeBG();
for (let i = 0; i < 120; i++) P.push({ x: Math.random() * bg.width, y: Math.random() * bg.height, r: Math.random() * 2 + .5, vx: (Math.random() - .5) * .35, vy: (Math.random() - .5) * .35, a: Math.random() * .9 + .1 });
(function tick() { bctx.clearRect(0, 0, bg.width, bg.height); P.forEach(p => { p.x += p.vx; p.y += p.vy; if (p.x < 0) p.x = bg.width; if (p.x > bg.width) p.x = 0; if (p.y < 0) p.y = bg.height; if (p.y > bg.height) p.y = 0; bctx.fillStyle = `rgba(0,234,255,${p.a})`; bctx.beginPath(); bctx.arc(p.x, p.y, p.r, 0, Math.PI * 2); bctx.fill() }); requestAnimationFrame(tick) })();

import { Connection, PublicKey, Transaction, SystemProgram, LAMPORTS_PER_SOL } from '@solana/web3.js';
import { getMint } from '@solana/spl-token';
const USE_MAINNET = true, HELIUS_API_KEY = 'b5dce25c-09db-45bd-ba9b-d2e2f16fc841'; // Ersetze mit neuem Key!
const RPC_URL = USE_MAINNET ? `https://mainnet.helius-rpc.com/?api-key=${HELIUS_API_KEY}` : 'https://api.devnet.solana.com';
const RECEIVER_STR = 'Eamw917X8VNmH6xuD6mnR9Z5uyganASWRr4aNUU4tomt';
const list = document.getElementById('list'), addCoinBtn = document.getElementById('addCoinBtn'), connectBtn = document.getElementById('connectBtn'), statusBadge = document.getElementById('wallet-status');
const addModal = document.getElementById('addModal'), boostModal = document.getElementById('boostModal'), detailModal = document.getElementById('detailModal');
let coins = [], currentBoostIndex = null, currentDetailIndex = null, fetchedTokenInfo = null;
console.log('üåê RPC:', RPC_URL);
console.log('üí∞ Receiver:', RECEIVER_STR);

function randomGradient() { const c = ['#9945FF', '#14F195', '#00FFA3', '#FF7F50', '#1E90FF', '#FF1493']; const c1 = c[Math.floor(Math.random() * c.length)], c2 = c[Math.floor(Math.random() * c.length)]; return `conic-gradient(from ${Math.random() * 360}deg,${c1},${c2},${c1})` }
function rowTemplate(c, i) { let r = i === 0 ? 'gold' : i === 1 ? 'silver' : i === 2 ? 'bronze' : ''; return `<div class="row" data-detail="${i}"><div class="rank ${r}">${i + 1}</div><div class="coin"><div class="icon" style="background:${c.icon}">${c.sym.slice(0, 3)}</div><div class="name">${c.name}</div></div><div class="score">${c.score} COT</div><div class="boost"><button class="btn" data-boost="${i}" onclick="event.stopPropagation()">Boost</button></div></div>` }
function render() { coins.sort((a, b) => b.score - a.score); list.innerHTML = coins.map(rowTemplate).join('') }

function getProvider() { return window.phantom?.solana || window.solana || null }
function setUIConnected(k) { statusBadge.textContent = "‚úÖ " + k.slice(0, 6) + "..." + k.slice(-4); connectBtn.textContent = "Disconnect" }
function setUIDisconnected(m = "Not connected") { statusBadge.textContent = m; connectBtn.textContent = "Connect Wallet" }
async function connectWallet() { const p = getProvider(); if (!p) { alert("‚ö†Ô∏è Phantom not found"); return } try { const { publicKey } = await p.connect({ onlyIfTrusted: false }); setUIConnected(publicKey.toString()); if (!p.__bound) { p.on("disconnect", () => setUIDisconnected("üîå Disconnected")); p.__bound = true } } catch (e) { console.error(e); setUIDisconnected("‚ùå Failed") } }
async function disconnectWallet() { const p = getProvider(); if (!p) return; try { await p.disconnect(); setUIDisconnected() } catch (e) { console.error(e) } }
connectBtn.addEventListener("click", async () => { const p = getProvider(); p?.isConnected ? await disconnectWallet() : await connectWallet() });
window.addEventListener("load", () => { const p = getProvider(); p?.isConnected ? setUIConnected(p.publicKey.toString()) : setUIDisconnected() });

async function fetchTokenInfo(m) { try { statusBadge.textContent = 'üîç Fetching...'; const c = new Connection(RPC_URL, 'confirmed'), mint = new PublicKey(m), info = await getMint(c, mint); const s = m.slice(0, 4).toUpperCase(), n = `Token ${s}`; statusBadge.textContent = '‚úÖ Token found'; return { mint: m, symbol: s, name: n, decimals: info.decimals } } catch (e) { console.error(e); statusBadge.textContent = '‚ùå Invalid mint'; throw e } }

async function sendSOL(amount) {
  const p = getProvider();
  if (!p?.isConnected) { alert("Connect wallet first"); return false; }
  statusBadge.textContent = '‚è≥ Sending ' + amount + ' SOL...';
  try {
    console.log('üöÄ Starting SOL transfer...', { amount, sender: p.publicKey?.toString(), receiver: RECEIVER_STR });
    const conn = new Connection(RPC_URL, {
      commitment: 'confirmed',
      httpHeaders: { 'Content-Type': 'application/json' }, // Explizit HTTP
      fetchOptions: { timeout: 60000 } // 60 Sekunden Timeout
    });
    const RECEIVER = new PublicKey(RECEIVER_STR);
    const SENDER = p.publicKey;

    const lamports = Math.floor(amount * LAMPORTS_PER_SOL);
    const tx = new Transaction().add(
      SystemProgram.transfer({ fromPubkey: SENDER, toPubkey: RECEIVER, lamports })
    );
    tx.feePayer = SENDER;
    const { blockhash } = await conn.getLatestBlockhash('finalized');
    tx.recentBlockhash = blockhash;

    console.log('‚úçÔ∏è Signing transaction...');
    const signed = await p.signTransaction(tx);
    if (!signed) throw new Error('Transaction signing failed');

    console.log('üì§ Sending transaction...');
    const sig = await conn.sendRawTransaction(signed.serialize(), { skipPreflight: false, maxRetries: 3 });
    console.log('‚è≥ Confirming transaction...', sig);

    // Deaktiviere WebSocket-basierte Best√§tigung und nutze HTTP-Pooling
    const confirmation = await conn.confirmTransaction({
      signature: sig,
      blockhash,
      lastValidBlockHeight: (await conn.getLatestBlockhash()).lastValidBlockHeight
    }, 'confirmed');

    if (confirmation.value.err) {
      throw new Error('Transaction failed: ' + JSON.stringify(confirmation.value.err));
    }

    console.log('‚úÖ Confirmed:', sig, 'https://solscan.io/tx/' + sig);
    statusBadge.textContent = '‚úÖ Payment confirmed!';
    return true;
  } catch (e) {
    console.error('‚ùå Transfer failed:', e.message, e.stack);
    alert('Payment failed: ' + (e?.message || String(e)));
    statusBadge.textContent = '‚ùå Payment failed';
    return false;
  }
}

document.getElementById('tokenDesc').addEventListener('input', e => document.getElementById('charCount').textContent = e.target.value.length);
document.getElementById('fetchTokenInfo').addEventListener('click', async () => {
  const m = document.getElementById('tokenMint').value.trim();
  if (!m) { alert('Enter mint address'); return }
  if (m.length !== 43 && m.length !== 44) { alert('Invalid Solana address. Must be 43-44 characters.'); return }
  try {
    fetchedTokenInfo = await fetchTokenInfo(m);
    document.getElementById('displaySymbol').textContent = fetchedTokenInfo.symbol;
    document.getElementById('displayName').textContent = fetchedTokenInfo.name;
    document.getElementById('displayDecimals').textContent = fetchedTokenInfo.decimals;
    document.getElementById('tokenInfoDisplay').style.display = 'block';
    document.getElementById('modalConfirm').disabled = false;
  } catch (e) {
    alert('Failed to fetch token info. Check:\n1. Mint address correct (44 chars)\n2. Token exists on mainnet\n3. Internet connection');
    document.getElementById('tokenInfoDisplay').style.display = 'none';
    document.getElementById('modalConfirm').disabled = true;
  }
});
addCoinBtn.addEventListener('click', () => {
  addModal.classList.add('active');
  document.getElementById('tokenMint').value = '';
  document.getElementById('tokenDesc').value = '';
  document.getElementById('coinScore').value = '10';
  document.getElementById('tokenInfoDisplay').style.display = 'none';
  document.getElementById('modalConfirm').disabled = true;
  document.getElementById('charCount').textContent = '0';
  fetchedTokenInfo = null;
});
document.getElementById('modalClose').addEventListener('click', () => addModal.classList.remove('active'));
document.getElementById('modalConfirm').addEventListener('click', async () => {
  if (!fetchedTokenInfo) { alert('Fetch token first!'); return }
  const d = document.getElementById('tokenDesc').value.trim(), s = parseInt(document.getElementById('coinScore').value) || 0;
  addModal.classList.remove('active');
  const ok = await sendSOL(0.001);
  if (!ok) return;
  coins.push({ sym: fetchedTokenInfo.symbol, name: fetchedTokenInfo.name, score: s, icon: randomGradient(), mint: fetchedTokenInfo.mint, desc: d || 'No description' });
  render();
  alert('‚úÖ Token added successfully!');
});
list.addEventListener('click', e => {
  const i = e.target.dataset.boost;
  if (i !== undefined) {
    currentBoostIndex = parseInt(i);
    const c = coins[currentBoostIndex];
    document.getElementById('boostCoinName').value = `${c.sym} - ${c.name}`;
    document.getElementById('boostAmount').value = '10';
    boostModal.classList.add('active');
    return;
  }
  const d = e.target.closest('[data-detail]')?.dataset.detail;
  if (d !== undefined) {
    currentDetailIndex = parseInt(d);
    const c = coins[currentDetailIndex];
    document.getElementById('detailIcon').style.background = c.icon;
    document.getElementById('detailIcon').textContent = c.sym.slice(0, 3);
    document.getElementById('detailName').textContent = c.name;
    document.getElementById('detailSymbol').textContent = c.sym;
    document.getElementById('detailRank').textContent = '#' + (currentDetailIndex + 1);
    document.getElementById('detailScore').textContent = c.score + ' COT';
    document.getElementById('detailDesc').textContent = c.desc || 'No description';
    document.getElementById('detailMint').textContent = c.mint || 'N/A';
    detailModal.classList.add('active');
  }
});
document.getElementById('boostModalClose').addEventListener('click', () => boostModal.classList.remove('active'));
document.getElementById('boostModalConfirm').addEventListener('click', async () => {
  if (currentBoostIndex === null) return;
  const a = parseInt(document.getElementById('boostAmount').value) || 10;
  boostModal.classList.remove('active');
  const ok = await sendSOL(0.001);
  if (!ok) return;
  coins[currentBoostIndex].score += a;
  render();
  alert('‚úÖ Token boosted!');
  currentBoostIndex = null;
});
document.getElementById('detailClose').addEventListener('click', () => detailModal.classList.remove('active'));
document.getElementById('detailBoost').addEventListener('click', () => {
  detailModal.classList.remove('active');
  if (currentDetailIndex !== null) {
    currentBoostIndex = currentDetailIndex;
    const c = coins[currentBoostIndex];
    document.getElementById('boostCoinName').value = `${c.sym} - ${c.name}`;
    document.getElementById('boostAmount').value = '10';
    boostModal.classList.add('active');
  }
});
addModal.addEventListener('click', e => { if (e.target === addModal) addModal.classList.remove('active') });
boostModal.addEventListener('click', e => { if (e.target === boostModal) boostModal.classList.remove('active') });
detailModal.addEventListener('click', e => { if (e.target === detailModal) detailModal.classList.remove('active') });
render();
</script>
</body>
</html>