<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Cobie's MemeMarket â€” KITTY Boost</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root{
    --neon:#00eaff; --neon2:#00bfff; --panel:#0a0f16cc;
    --ink:#d7faff; --accent:#7bffb9;
    --solana1:#9945FF; --solana2:#14F195; --solana3:#00FFA3;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:#000;color:var(--ink);
    font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,"Helvetica Neue",Arial;overflow:hidden;}
  #bg{position:fixed;inset:0;z-index:0;pointer-events:none;}
  .header{position:fixed;top:24px;left:32px;z-index:2;}
  .brand{font-family:'Orbitron',ui-monospace,monospace;font-size:28px;letter-spacing:2px;color:var(--neon);
    text-shadow:0 0 6px var(--neon),0 0 16px var(--neon2),0 0 28px var(--neon2);
    animation:breathe 3.2s ease-in-out infinite,flicker 4s infinite;user-select:none;}
  @keyframes breathe{0%{transform:scale(1)}50%{transform:scale(1.06)}100%{transform:scale(1)}}
  @keyframes flicker{0%,18%,22%,25%,53%,57%,100%{opacity:1}20%,24%,55%{opacity:.7}}
  .laser{position:relative;height:3px;margin-top:6px;width:280px;
    background:linear-gradient(90deg,rgba(0,234,255,.2),rgba(0,234,255,.05));
    overflow:hidden;border-radius:2px;box-shadow:0 0 10px rgba(0,234,255,.3);}
  .laser::before{content:"";position:absolute;top:0;left:-110%;height:100%;width:110%;
    background:linear-gradient(90deg,transparent,var(--neon),transparent);
    animation:laser 3.2s linear infinite;}
  @keyframes laser{0%{left:-110%}50%{left:0}100%{left:110%}}
  .wallet-btn{position:fixed;top:24px;right:32px;z-index:3;padding:10px 18px;border-radius:10px;
    cursor:pointer;font-weight:700;letter-spacing:.4px;color:var(--neon);border:2px solid var(--neon);
    background:transparent;text-shadow:0 0 6px var(--neon);transition:all .25s;}
  .wallet-btn:hover{background:var(--neon);color:#000;box-shadow:0 0 16px var(--neon);}
  .wrap{position:relative;z-index:1;height:100%;width:100%;display:flex;align-items:center;justify-content:center;
    padding:96px 24px 24px;}
  .panel{width:min(980px,92vw);background:linear-gradient(180deg,rgba(17,24,39,.65),rgba(7,10,16,.75));
    border:1px solid rgba(255,255,255,.08);border-radius:16px;
    box-shadow:0 0 0 1px rgba(0,0,0,.3) inset,0 0 32px rgba(153,69,255,.25),0 0 64px rgba(0,255,163,.12);
    backdrop-filter:blur(6px);padding:18px;}
  .panel-head{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:6px 6px 12px 6px;}
  .badge{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;
    background:linear-gradient(90deg,rgba(153,69,255,.25),rgba(0,255,163,.12));
    border:1px solid rgba(255,255,255,.08);font-weight:600;font-size:13px;letter-spacing:.5px;color:#e6fffb;
    text-shadow:0 0 6px rgba(0,255,163,.4);}
  .actions{display:flex;gap:10px}
  .btn{appearance:none;border:none;cursor:pointer;padding:10px 14px;border-radius:10px;
    background:linear-gradient(135deg,rgba(0,255,163,.15),rgba(153,69,255,.15));color:#dff;font-weight:700;
    letter-spacing:.3px;box-shadow:0 0 0 1px rgba(255,255,255,.08) inset,0 6px 20px rgba(0,255,163,.15);
    transition:transform .15s ease,filter .2s ease;}
  .btn:hover{transform:translateY(-1px);filter:brightness(1.1)}
  .btn:disabled{opacity:0.5;cursor:not-allowed;transform:none;}
  .head,.row{display:grid;grid-template-columns:50px 1fr 150px 120px;align-items:center;gap:12px;}
  .head{font-size:12px;text-transform:uppercase;letter-spacing:.8px;color:#9fe;opacity:.8;padding:6px 10px;
    border-bottom:1px solid rgba(255,255,255,.08);font-weight:600;}
  .list{display:flex;flex-direction:column;gap:8px;padding:8px}
  .row{padding:10px 12px;border-radius:12px;
    background:linear-gradient(90deg,rgba(255,255,255,.02),rgba(255,255,255,.03));
    border:1px solid rgba(255,255,255,.06);transition:transform .25s,box-shadow .25s,background .25s;}
  .row:hover{transform:translateY(-2px);
    box-shadow:0 10px 30px rgba(0,255,163,.12),0 0 30px rgba(153,69,255,.15);
    background:linear-gradient(90deg,rgba(20,255,195,.06),rgba(153,69,255,.05));}
  .rank{font-weight:800;font-size:18px;color:#bff;text-shadow:0 0 8px rgba(0,255,163,.4)}
  .coin{display:flex;align-items:center;gap:12px;font-weight:700;color:#eaffff}
  .icon{width:34px;height:34px;border-radius:50%;background:conic-gradient(from 120deg,var(--solana1),var(--solana2),var(--solana3),var(--solana1));
    box-shadow:0 0 16px rgba(0,255,163,.35);display:grid;place-items:center;color:#001510;font-weight:900;font-size:13px;}
  .name{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .score{font-variant-numeric:tabular-nums;color:#cffff8;font-weight:800}
  .boost{justify-self:end}.boost .btn{padding:9px 12px}
  .gold{color:gold}.silver{color:silver}.bronze{color:#cd7f32}

  /* Modal Styles */
  .modal{position:fixed;inset:0;background:rgba(0,0,0,.85);display:none;align-items:center;justify-content:center;z-index:100;backdrop-filter:blur(4px);}
  .modal.active{display:flex;}
  .modal-content{background:linear-gradient(180deg,rgba(17,24,39,.95),rgba(7,10,16,.95));padding:32px;border-radius:16px;width:min(420px,90vw);
    box-shadow:0 0 40px rgba(0,234,255,.3),0 0 80px rgba(153,69,255,.2);border:1px solid rgba(0,234,255,.3);animation:modalIn .3s ease;}
  @keyframes modalIn{from{opacity:0;transform:scale(.9)}to{opacity:1;transform:scale(1)}}
  .modal-content h2{margin:0 0 24px 0;color:var(--neon);font-size:24px;text-shadow:0 0 10px var(--neon);text-align:center;}
  .modal-content label{display:block;font-size:13px;color:#9fe;margin-bottom:6px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;}
  .modal-content input{width:100%;margin-bottom:16px;padding:12px 14px;border-radius:10px;border:1px solid rgba(0,234,255,.3);
    background:rgba(0,0,0,.5);color:#fff;font-size:15px;transition:.2s;}
  .modal-content input:focus{outline:none;border-color:var(--neon);box-shadow:0 0 12px rgba(0,234,255,.3);}
  .modal-actions{display:flex;gap:10px;margin-top:24px;}
  .modal-actions .btn{flex:1;padding:12px;}
  .btn-primary{background:linear-gradient(135deg,var(--neon),var(--neon2));color:#000;font-weight:800;}
  .cost-info{text-align:center;padding:12px;background:rgba(153,69,255,.1);border-radius:8px;margin-bottom:16px;font-size:13px;color:#9fe;}
</style>
</head>
<body>
  <canvas id="bg"></canvas>

  <div class="header"><div class="brand">Cobie's MemeWorld</div><div class="laser"></div></div>
  <button class="wallet-btn" id="connectBtn">Connect Wallet</button>

  <div class="wrap">
    <div class="panel">
      <div class="panel-head">
        <div class="badge" id="wallet-status">Not connected</div>
        <div class="actions">
          <button class="btn" id="addCoinBtn">âž• Add Coin</button>
        </div>
      </div>
      <div class="head"><div>#</div><div>Coin</div><div>Score (COT)</div><div></div></div>
      <div class="list" id="list"></div>
    </div>
  </div>

  <!-- Add Coin Modal -->
  <div class="modal" id="addModal">
    <div class="modal-content">
      <h2>ðŸš€ Add New Coin</h2>
      <div class="cost-info">ðŸ’° Cost: 0.01 KITTY to add a coin</div>
      
      <label>Coin Symbol (max 4 chars)</label>
      <input type="text" id="coinSymbol" maxlength="4" placeholder="e.g. DOGE" />
      
      <label>Coin Name</label>
      <input type="text" id="coinName" placeholder="e.g. Doge Coin" />
      
      <label>Initial Score (COT)</label>
      <input type="number" id="coinScore" value="10" min="0" />
      
      <div class="modal-actions">
        <button class="btn" id="modalClose">Cancel</button>
        <button class="btn btn-primary" id="modalConfirm">Add Coin (Pay 0.01 KITTY)</button>
      </div>
    </div>
  </div>

  <!-- Boost Modal -->
  <div class="modal" id="boostModal">
    <div class="modal-content">
      <h2>âš¡ Boost Coin</h2>
      <div class="cost-info">ðŸ’° Cost: 0.001 KITTY per boost</div>
      
      <label>Coin</label>
      <input type="text" id="boostCoinName" readonly style="background:rgba(0,0,0,.3);" />
      
      <label>Boost Amount (COT)</label>
      <input type="number" id="boostAmount" value="10" min="1" />
      
      <div class="modal-actions">
        <button class="btn" id="boostModalClose">Cancel</button>
        <button class="btn btn-primary" id="boostModalConfirm">Boost (Pay 0.001 KITTY)</button>
      </div>
    </div>
  </div>

<script type="importmap">
{
  "imports": {
    "@solana/web3.js": "https://esm.sh/@solana/web3.js@1.87.6",
    "@solana/spl-token": "https://esm.sh/@solana/spl-token@0.3.11"
  }
}
</script>

<script type="module">
/* ---------------- Particles BG ---------------- */
const bg=document.getElementById('bg');
const bctx=bg.getContext('2d');
let P=[];
function resizeBG(){bg.width=innerWidth;bg.height=innerHeight}
addEventListener('resize',resizeBG);resizeBG();
for(let i=0;i<120;i++){
  P.push({x:Math.random()*bg.width,y:Math.random()*bg.height,r:Math.random()*2+0.5,
  vx:(Math.random()-.5)*.35,vy:(Math.random()-.5)*.35,a:Math.random()*.9+.1});
}
(function tick(){bctx.clearRect(0,0,bg.width,bg.height);
  P.forEach(p=>{p.x+=p.vx;p.y+=p.vy;
  if(p.x<0)p.x=bg.width;if(p.x>bg.width)p.x=0;
  if(p.y<0)p.y=bg.height;if(p.y>bg.height)p.y=0;
  bctx.fillStyle=`rgba(0,234,255,${p.a})`;bctx.beginPath();
  bctx.arc(p.x,p.y,p.r,0,Math.PI*2);bctx.fill();});
  requestAnimationFrame(tick);
})();

/* ---------------- UI + Daten ---------------- */
const list=document.getElementById('list');
const addCoinBtn=document.getElementById('addCoinBtn');
const connectBtn=document.getElementById('connectBtn');
const statusBadge=document.getElementById('wallet-status');

// Modals
const addModal = document.getElementById('addModal');
const boostModal = document.getElementById('boostModal');
let currentBoostIndex = null;

let coins=[];

function randomGradient(){
  const colors=['#9945FF','#14F195','#00FFA3','#FF7F50','#1E90FF','#FF1493'];
  const c1=colors[Math.floor(Math.random()*colors.length)];
  const c2=colors[Math.floor(Math.random()*colors.length)];
  return `conic-gradient(from ${Math.random()*360}deg,${c1},${c2},${c1})`;
}

function rowTemplate(c, idx){
  let rankClass = idx===0?'gold':idx===1?'silver':idx===2?'bronze':'';
  return `
  <div class="row" data-sym="${c.sym}">
    <div class="rank ${rankClass}">${idx+1}</div>
    <div class="coin">
      <div class="icon" style="background:${c.icon}">${c.sym.slice(0,3)}</div>
      <div class="name">${c.name}</div>
    </div>
    <div class="score">${c.score} COT</div>
    <div class="boost"><button class="btn" data-boost="${idx}">Boost</button></div>
  </div>`;
}

function render(){
  coins.sort((a,b)=>b.score-a.score);
  list.innerHTML = coins.map((c,i)=>rowTemplate(c,i)).join('');
}

/* ---------------- Phantom Wallet ---------------- */
function getProvider(){
  const w=window;
  return w.phantom?.solana || w.solana || null;
}
function setUIConnected(keyStr){
  statusBadge.textContent = "âœ… " + keyStr.slice(0,6) + "..." + keyStr.slice(-4);
  connectBtn.textContent = "Disconnect";
}
function setUIDisconnected(msg="Not connected"){
  statusBadge.textContent = msg;
  connectBtn.textContent = "Connect Wallet";
}
async function connectWallet(){
  const p=getProvider();
  if(!p){ alert("âš ï¸ Phantom Wallet nicht gefunden."); return; }
  try{
    const { publicKey } = await p.connect({ onlyIfTrusted:false });
    setUIConnected(publicKey.toString());
    if(!p.__bound){
      p.on("disconnect", ()=> setUIDisconnected("ðŸ”Œ Disconnected"));
      p.__bound=true;
    }
  }catch(e){
    console.error("Connect fail:", e);
    setUIDisconnected("âŒ Connection failed");
  }
}
async function disconnectWallet(){
  const p=getProvider(); if(!p) return;
  try{ await p.disconnect(); setUIDisconnected("ðŸ”Œ Disconnected"); }catch(e){ console.error(e); }
}
connectBtn.addEventListener("click", async ()=>{
  const p=getProvider();
  if(p?.isConnected){ await disconnectWallet(); } else { await connectWallet(); }
});
window.addEventListener("load", ()=>{
  const p=getProvider();
  if(p?.isConnected){ setUIConnected(p.publicKey.toString()); } else { setUIDisconnected(); }
});

/* ---------------- Solana Tx: KITTY senden (Mainnet mit Helius) ---------------- */
import { Connection, PublicKey, Transaction } from '@solana/web3.js';
import { 
  getAssociatedTokenAddress, 
  createAssociatedTokenAccountInstruction, 
  getMint, 
  createTransferCheckedInstruction 
} from '@solana/spl-token';

// ðŸ”§ RPC Konfiguration
const USE_MAINNET = true;
const HELIUS_API_KEY = 'b5dce25c-09db-45bd-ba9b-d2e2f16fc841';

const RPC_URL = USE_MAINNET 
  ? `https://mainnet.helius-rpc.com/?api-key=${HELIUS_API_KEY}`
  : 'https://api.devnet.solana.com';

const KITTY_MINT_STR = 'DFfPq2hHbJeunp1F6eNyuyvBHcPpnTqaawn2tAFUpump';
const RECEIVER_STR = 'VAFSijooNotLkH6i6Exzw7HcsHGz7ZFjgLZLqpiDBEu';

console.log('ðŸŒ Using RPC:', RPC_URL);
console.log('ðŸ”— Network:', USE_MAINNET ? 'MAINNET' : 'DEVNET');

async function sendKITTY(amount){
  const p=getProvider();
  if(!p?.isConnected){ 
    alert("Bitte zuerst Wallet verbinden."); 
    return false; 
  }

  statusBadge.textContent = 'â³ Sending ' + amount + ' KITTY...';

  try{
    console.log('ðŸš€ Starting transaction...');
    
    const conn = new Connection(RPC_URL, 'confirmed');
    const MINT = new PublicKey(KITTY_MINT_STR);
    const RECEIVER = new PublicKey(RECEIVER_STR);
    const SENDER = p.publicKey;

    if (!SENDER) {
      throw new Error('Sender-PublicKey nicht verfÃ¼gbar.');
    }

    console.log('ðŸ“ SENDER:', SENDER.toString());
    console.log('ðŸ“ RECEIVER:', RECEIVER.toString());
    console.log('ðŸ“ MINT:', MINT.toString());

    const sATA = await getAssociatedTokenAddress(MINT, SENDER);
    const rATA = await getAssociatedTokenAddress(MINT, RECEIVER);
    
    console.log('ðŸ”‘ Sender ATA:', sATA.toString());
    console.log('ðŸ”‘ Receiver ATA:', rATA.toString());

    const ixs = [];

    const sInfo = await conn.getAccountInfo(sATA);
    if(!sInfo){
      console.log('âš ï¸ Creating sender ATA...');
      ixs.push(createAssociatedTokenAccountInstruction(
        SENDER, sATA, SENDER, MINT
      ));
    }
    
    const rInfo = await conn.getAccountInfo(rATA);
    if(!rInfo){
      console.log('âš ï¸ Creating receiver ATA...');
      ixs.push(createAssociatedTokenAccountInstruction(
        SENDER, rATA, RECEIVER, MINT
      ));
    }

    const mintInfo = await getMint(conn, MINT);
    const dec = mintInfo.decimals;
    console.log('ðŸ’° Token decimals:', dec);

    const amt = BigInt(Math.floor(amount * (10 ** dec)));
    console.log('ðŸ’¸ Sending amount:', amt.toString(), 'base units');

    ixs.push(createTransferCheckedInstruction(
      sATA, MINT, rATA, SENDER, amt, dec
    ));

    console.log('ðŸ“¦ Instructions:', ixs.length);

    const tx = new Transaction().add(...ixs);
    tx.feePayer = SENDER;
    
    const { blockhash } = await conn.getLatestBlockhash();
    tx.recentBlockhash = blockhash;

    console.log('âœï¸ Signing transaction...');
    const signed = await p.signTransaction(tx);
    
    if (!signed) {
      throw new Error('Transaction signing failed');
    }

    console.log('ðŸ“¤ Sending transaction...');
    const sig = await conn.sendRawTransaction(signed.serialize(), {
      skipPreflight: false,
      preflightCommitment: 'confirmed'
    });
    
    console.log('â³ Confirming transaction:', sig);
    await conn.confirmTransaction(sig, 'confirmed');

    console.log('âœ… Transaction confirmed!');
    console.log('ðŸ”— Signature:', sig);
    console.log('ðŸ”— Explorer:', `https://solscan.io/tx/${sig}`);
    statusBadge.textContent = 'âœ… Tx confirmed!';
    return true;
    
  }catch(e){
    console.error('âŒ Transfer failed:', e);
    alert('Transfer failed: ' + (e?.message || String(e)));
    statusBadge.textContent = 'âŒ Transfer failed';
    return false;
  }
}

/* ---------------- Modal Logic ---------------- */

// Add Coin Modal
addCoinBtn.addEventListener('click', () => {
  addModal.classList.add('active');
  document.getElementById('coinSymbol').value = '';
  document.getElementById('coinName').value = '';
  document.getElementById('coinScore').value = '10';
});

document.getElementById('modalClose').addEventListener('click', () => {
  addModal.classList.remove('active');
});

document.getElementById('modalConfirm').addEventListener('click', async () => {
  const sym = document.getElementById('coinSymbol').value.toUpperCase().slice(0,4) || 'NEW';
  const name = document.getElementById('coinName').value || 'Unnamed Coin';
  const score = parseInt(document.getElementById('coinScore').value) || 0;
  
  if(!sym || !name){
    alert('Bitte Symbol und Name eingeben!');
    return;
  }
  
  // Close modal first
  addModal.classList.remove('active');
  
  // Send KITTY
  const ok = await sendKITTY(0.01);
  if(!ok) return;
  
  // Add coin to list
  coins.push({ 
    sym, 
    name, 
    score,
    icon: randomGradient()
  });
  render();
});

// Boost Modal
list.addEventListener('click', (e) => {
  const idx = e.target.dataset.boost;
  if(idx === undefined) return;
  
  currentBoostIndex = parseInt(idx);
  const coin = coins[currentBoostIndex];
  
  document.getElementById('boostCoinName').value = `${coin.sym} - ${coin.name}`;
  document.getElementById('boostAmount').value = '10';
  boostModal.classList.add('active');
});

document.getElementById('boostModalClose').addEventListener('click', () => {
  boostModal.classList.remove('active');
});

document.getElementById('boostModalConfirm').addEventListener('click', async () => {
  if(currentBoostIndex === null) return;
  
  const amount = parseInt(document.getElementById('boostAmount').value) || 10;
  
  // Close modal
  boostModal.classList.remove('active');
  
  // Send KITTY
  const ok = await sendKITTY(0.001);
  if(!ok) return;
  
  // Boost the coin
  coins[currentBoostIndex].score += amount;
  render();
  currentBoostIndex = null;
});

// Close modals on outside click
addModal.addEventListener('click', (e) => {
  if(e.target === addModal) addModal.classList.remove('active');
});
boostModal.addEventListener('click', (e) => {
  if(e.target === boostModal) boostModal.classList.remove('active');
});

/* initial */
render();
</script>
</body>
</html>